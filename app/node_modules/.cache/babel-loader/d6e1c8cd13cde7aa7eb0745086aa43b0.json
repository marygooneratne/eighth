{"ast":null,"code":"function $(expr, con) {\n  return typeof expr === \"string\" ? (con || document).querySelector(expr) : expr || null;\n}\n\n$.create = (tag, o) => {\n  var element = document.createElement(tag);\n\n  for (var i in o) {\n    var val = o[i];\n\n    if (i === \"inside\") {\n      $(val).appendChild(element);\n    } else if (i === \"around\") {\n      var ref = $(val);\n      ref.parentNode.insertBefore(element, ref);\n      element.appendChild(ref);\n    } else if (i === \"styles\") {\n      if (typeof val === \"object\") {\n        Object.keys(val).map(prop => {\n          element.style[prop] = val[prop];\n        });\n      }\n    } else if (i in element) {\n      element[i] = val;\n    } else {\n      element.setAttribute(i, val);\n    }\n  }\n\n  return element;\n};\n\nfunction getOffset(element) {\n  let rect = element.getBoundingClientRect();\n  return {\n    // https://stackoverflow.com/a/7436602/6495043\n    // rect.top varies with scroll, so we add whatever has been\n    // scrolled to it to get absolute distance from actual page top\n    top: rect.top + (document.documentElement.scrollTop || document.body.scrollTop),\n    left: rect.left + (document.documentElement.scrollLeft || document.body.scrollLeft)\n  };\n} // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetParent\n// an element's offsetParent property will return null whenever it, or any of its parents,\n// is hidden via the display style property.\n\n\nfunction isHidden(el) {\n  return el.offsetParent === null;\n}\n\nfunction isElementInViewport(el) {\n  // Although straightforward: https://stackoverflow.com/a/7557433/6495043\n  var rect = el.getBoundingClientRect();\n  return rect.top >= 0 && rect.left >= 0 && rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&\n  /*or $(window).height() */\n  rect.right <= (window.innerWidth || document.documentElement.clientWidth)\n  /*or $(window).width() */\n  ;\n}\n\nfunction getElementContentWidth(element) {\n  var styles = window.getComputedStyle(element);\n  var padding = parseFloat(styles.paddingLeft) + parseFloat(styles.paddingRight);\n  return element.clientWidth - padding;\n}\n\nfunction fire(target, type, properties) {\n  var evt = document.createEvent(\"HTMLEvents\");\n  evt.initEvent(type, true, true);\n\n  for (var j in properties) {\n    evt[j] = properties[j];\n  }\n\n  return target.dispatchEvent(evt);\n} // https://css-tricks.com/snippets/javascript/loop-queryselectorall-matches/\n\n\nconst BASE_MEASURES = {\n  margins: {\n    top: 10,\n    bottom: 10,\n    left: 20,\n    right: 20\n  },\n  paddings: {\n    top: 20,\n    bottom: 40,\n    left: 30,\n    right: 10\n  },\n  baseHeight: 240,\n  titleHeight: 20,\n  legendHeight: 30,\n  titleFontSize: 12\n};\n\nfunction getTopOffset(m) {\n  return m.titleHeight + m.margins.top + m.paddings.top;\n}\n\nfunction getLeftOffset(m) {\n  return m.margins.left + m.paddings.left;\n}\n\nfunction getExtraHeight(m) {\n  let totalExtraHeight = m.margins.top + m.margins.bottom + m.paddings.top + m.paddings.bottom + m.titleHeight + m.legendHeight;\n  return totalExtraHeight;\n}\n\nfunction getExtraWidth(m) {\n  let totalExtraWidth = m.margins.left + m.margins.right + m.paddings.left + m.paddings.right;\n  return totalExtraWidth;\n}\n\nconst INIT_CHART_UPDATE_TIMEOUT = 700;\nconst CHART_POST_ANIMATE_TIMEOUT = 400;\nconst DEFAULT_AXIS_CHART_TYPE = 'line';\nconst AXIS_DATASET_CHART_TYPES = ['line', 'bar'];\nconst AXIS_LEGEND_BAR_SIZE = 100;\nconst BAR_CHART_SPACE_RATIO = 0.5;\nconst MIN_BAR_PERCENT_HEIGHT = 0.00;\nconst LINE_CHART_DOT_SIZE = 4;\nconst DOT_OVERLAY_SIZE_INCR = 4;\nconst PERCENTAGE_BAR_DEFAULT_HEIGHT = 20;\nconst PERCENTAGE_BAR_DEFAULT_DEPTH = 2; // Fixed 5-color theme,\n// More colors are difficult to parse visually\n\nconst HEATMAP_DISTRIBUTION_SIZE = 5;\nconst HEATMAP_SQUARE_SIZE = 10;\nconst HEATMAP_GUTTER_SIZE = 2;\nconst DEFAULT_CHAR_WIDTH = 7;\nconst TOOLTIP_POINTER_TRIANGLE_HEIGHT = 5;\nconst DEFAULT_CHART_COLORS = ['light-blue', 'blue', 'violet', 'red', 'orange', 'yellow', 'green', 'light-green', 'purple', 'magenta', 'light-grey', 'dark-grey'];\nconst HEATMAP_COLORS_GREEN = ['#ebedf0', '#c6e48b', '#7bc96f', '#239a3b', '#196127'];\nconst DEFAULT_COLORS = {\n  bar: DEFAULT_CHART_COLORS,\n  line: DEFAULT_CHART_COLORS,\n  pie: DEFAULT_CHART_COLORS,\n  percentage: DEFAULT_CHART_COLORS,\n  heatmap: HEATMAP_COLORS_GREEN,\n  donut: DEFAULT_CHART_COLORS\n}; // Universal constants\n\nconst ANGLE_RATIO = Math.PI / 180;\nconst FULL_ANGLE = 360;\n\nclass SvgTip {\n  constructor({\n    parent = null,\n    colors = []\n  }) {\n    this.parent = parent;\n    this.colors = colors;\n    this.titleName = '';\n    this.titleValue = '';\n    this.listValues = [];\n    this.titleValueFirst = 0;\n    this.x = 0;\n    this.y = 0;\n    this.top = 0;\n    this.left = 0;\n    this.setup();\n  }\n\n  setup() {\n    this.makeTooltip();\n  }\n\n  refresh() {\n    this.fill();\n    this.calcPosition();\n  }\n\n  makeTooltip() {\n    this.container = $.create('div', {\n      inside: this.parent,\n      className: 'graph-svg-tip comparison',\n      innerHTML: `<span class=\"title\"></span>\n\t\t\t\t<ul class=\"data-point-list\"></ul>\n\t\t\t\t<div class=\"svg-pointer\"></div>`\n    });\n    this.hideTip();\n    this.title = this.container.querySelector('.title');\n    this.dataPointList = this.container.querySelector('.data-point-list');\n    this.parent.addEventListener('mouseleave', () => {\n      this.hideTip();\n    });\n  }\n\n  fill() {\n    let title;\n\n    if (this.index) {\n      this.container.setAttribute('data-point-index', this.index);\n    }\n\n    if (this.titleValueFirst) {\n      title = `<strong>${this.titleValue}</strong>${this.titleName}`;\n    } else {\n      title = `${this.titleName}<strong>${this.titleValue}</strong>`;\n    }\n\n    this.title.innerHTML = title;\n    this.dataPointList.innerHTML = '';\n    this.listValues.map((set, i) => {\n      const color = this.colors[i] || 'black';\n      let value = set.formatted === 0 || set.formatted ? set.formatted : set.value;\n      let li = $.create('li', {\n        styles: {\n          'border-top': `3px solid ${color}`\n        },\n        innerHTML: `<strong style=\"display: block;\">${value === 0 || value ? value : ''}</strong>\n\t\t\t\t\t${set.title ? set.title : ''}`\n      });\n      this.dataPointList.appendChild(li);\n    });\n  }\n\n  calcPosition() {\n    let width = this.container.offsetWidth;\n    this.top = this.y - this.container.offsetHeight - TOOLTIP_POINTER_TRIANGLE_HEIGHT;\n    this.left = this.x - width / 2;\n    let maxLeft = this.parent.offsetWidth - width;\n    let pointer = this.container.querySelector('.svg-pointer');\n\n    if (this.left < 0) {\n      pointer.style.left = `calc(50% - ${-1 * this.left}px)`;\n      this.left = 0;\n    } else if (this.left > maxLeft) {\n      let delta = this.left - maxLeft;\n      let pointerOffset = `calc(50% + ${delta}px)`;\n      pointer.style.left = pointerOffset;\n      this.left = maxLeft;\n    } else {\n      pointer.style.left = `50%`;\n    }\n  }\n\n  setValues(x, y, title = {}, listValues = [], index = -1) {\n    this.titleName = title.name;\n    this.titleValue = title.value;\n    this.listValues = listValues;\n    this.x = x;\n    this.y = y;\n    this.titleValueFirst = title.valueFirst || 0;\n    this.index = index;\n    this.refresh();\n  }\n\n  hideTip() {\n    this.container.style.top = '0px';\n    this.container.style.left = '0px';\n    this.container.style.opacity = '0';\n  }\n\n  showTip() {\n    this.container.style.top = this.top + 'px';\n    this.container.style.left = this.left + 'px';\n    this.container.style.opacity = '1';\n  }\n\n}\n/**\n * Returns the value of a number upto 2 decimal places.\n * @param {Number} d Any number\n */\n\n\nfunction floatTwo(d) {\n  return parseFloat(d.toFixed(2));\n}\n/**\n * Returns whether or not two given arrays are equal.\n * @param {Array} arr1 First array\n * @param {Array} arr2 Second array\n */\n\n/**\n * Shuffles array in place. ES6 version\n * @param {Array} array An array containing the items.\n */\n\n/**\n * Fill an array with extra points\n * @param {Array} array Array\n * @param {Number} count number of filler elements\n * @param {Object} element element to fill with\n * @param {Boolean} start fill at start?\n */\n\n\nfunction fillArray(array, count, element, start = false) {\n  if (!element) {\n    element = start ? array[0] : array[array.length - 1];\n  }\n\n  let fillerArray = new Array(Math.abs(count)).fill(element);\n  array = start ? fillerArray.concat(array) : array.concat(fillerArray);\n  return array;\n}\n/**\n * Returns pixel width of string.\n * @param {String} string\n * @param {Number} charWidth Width of single char in pixels\n */\n\n\nfunction getStringWidth(string, charWidth) {\n  return (string + \"\").length * charWidth;\n} // https://stackoverflow.com/a/29325222\n\n\nfunction getPositionByAngle(angle, radius) {\n  return {\n    x: Math.sin(angle * ANGLE_RATIO) * radius,\n    y: Math.cos(angle * ANGLE_RATIO) * radius\n  };\n}\n/**\n * Check if a number is valid for svg attributes\n * @param {object} candidate Candidate to test\n * @param {Boolean} nonNegative flag to treat negative number as invalid\n */\n\n\nfunction isValidNumber(candidate, nonNegative = false) {\n  if (Number.isNaN(candidate)) return false;else if (candidate === undefined) return false;else if (!Number.isFinite(candidate)) return false;else if (nonNegative && candidate < 0) return false;else return true;\n}\n\nfunction getBarHeightAndYAttr(yTop, zeroLine) {\n  let height, y;\n\n  if (yTop <= zeroLine) {\n    height = zeroLine - yTop;\n    y = yTop;\n  } else {\n    height = yTop - zeroLine;\n    y = zeroLine;\n  }\n\n  return [height, y];\n}\n\nfunction equilizeNoOfElements(array1, array2, extraCount = array2.length - array1.length) {\n  // Doesn't work if either has zero elements.\n  if (extraCount > 0) {\n    array1 = fillArray(array1, extraCount);\n  } else {\n    array2 = fillArray(array2, extraCount);\n  }\n\n  return [array1, array2];\n}\n\nfunction truncateString(txt, len) {\n  if (!txt) {\n    return;\n  }\n\n  if (txt.length > len) {\n    return txt.slice(0, len - 3) + '...';\n  } else {\n    return txt;\n  }\n}\n\nfunction shortenLargeNumber(label) {\n  let number;\n  if (typeof label === 'number') number = label;else if (typeof label === 'string') {\n    number = Number(label);\n    if (Number.isNaN(number)) return label;\n  } // Using absolute since log wont work for negative numbers\n\n  let p = Math.floor(Math.log10(Math.abs(number)));\n  if (p <= 2) return number; // Return as is for a 3 digit number of less\n\n  let l = Math.floor(p / 3);\n  let shortened = Math.pow(10, p - l * 3) * +(number / Math.pow(10, p)).toFixed(1); // Correct for floating point error upto 2 decimal places\n\n  return Math.round(shortened * 100) / 100 + ' ' + ['', 'K', 'M', 'B', 'T'][l];\n} // cubic bezier curve calculation (from example by FranÃ§ois Romain)\n\n\nfunction getSplineCurvePointsStr(xList, yList) {\n  let points = [];\n\n  for (let i = 0; i < xList.length; i++) {\n    points.push([xList[i], yList[i]]);\n  }\n\n  let smoothing = 0.2;\n\n  let line = (pointA, pointB) => {\n    let lengthX = pointB[0] - pointA[0];\n    let lengthY = pointB[1] - pointA[1];\n    return {\n      length: Math.sqrt(Math.pow(lengthX, 2) + Math.pow(lengthY, 2)),\n      angle: Math.atan2(lengthY, lengthX)\n    };\n  };\n\n  let controlPoint = (current, previous, next, reverse) => {\n    let p = previous || current;\n    let n = next || current;\n    let o = line(p, n);\n    let angle = o.angle + (reverse ? Math.PI : 0);\n    let length = o.length * smoothing;\n    let x = current[0] + Math.cos(angle) * length;\n    let y = current[1] + Math.sin(angle) * length;\n    return [x, y];\n  };\n\n  let bezierCommand = (point, i, a) => {\n    let cps = controlPoint(a[i - 1], a[i - 2], point);\n    let cpe = controlPoint(point, a[i - 1], a[i + 1], true);\n    return `C ${cps[0]},${cps[1]} ${cpe[0]},${cpe[1]} ${point[0]},${point[1]}`;\n  };\n\n  let pointStr = (points, command) => {\n    return points.reduce((acc, point, i, a) => i === 0 ? `${point[0]},${point[1]}` : `${acc} ${command(point, i, a)}`, '');\n  };\n\n  return pointStr(points, bezierCommand);\n}\n\nconst PRESET_COLOR_MAP = {\n  'light-blue': '#7cd6fd',\n  'blue': '#5e64ff',\n  'violet': '#743ee2',\n  'red': '#ff5858',\n  'orange': '#ffa00a',\n  'yellow': '#feef72',\n  'green': '#28a745',\n  'light-green': '#98d85b',\n  'purple': '#b554ff',\n  'magenta': '#ffa3ef',\n  'black': '#36114C',\n  'grey': '#bdd3e6',\n  'light-grey': '#f0f4f7',\n  'dark-grey': '#b8c2cc'\n};\n\nfunction limitColor(r) {\n  if (r > 255) return 255;else if (r < 0) return 0;\n  return r;\n}\n\nfunction lightenDarkenColor(color, amt) {\n  let col = getColor(color);\n  let usePound = false;\n\n  if (col[0] == \"#\") {\n    col = col.slice(1);\n    usePound = true;\n  }\n\n  let num = parseInt(col, 16);\n  let r = limitColor((num >> 16) + amt);\n  let b = limitColor((num >> 8 & 0x00FF) + amt);\n  let g = limitColor((num & 0x0000FF) + amt);\n  return (usePound ? \"#\" : \"\") + (g | b << 8 | r << 16).toString(16);\n}\n\nfunction isValidColor(string) {\n  // https://stackoverflow.com/a/32685393\n  let HEX_RE = /(^\\s*)(#)((?:[A-Fa-f0-9]{3}){1,2})$/i;\n  let RGB_RE = /(^\\s*)(rgb|hsl)(a?)[(]\\s*([\\d.]+\\s*%?)\\s*,\\s*([\\d.]+\\s*%?)\\s*,\\s*([\\d.]+\\s*%?)\\s*(?:,\\s*([\\d.]+)\\s*)?[)]$/i;\n  return HEX_RE.test(string) || RGB_RE.test(string);\n}\n\nconst getColor = color => {\n  return PRESET_COLOR_MAP[color] || color;\n};\n\nconst AXIS_TICK_LENGTH = 6;\nconst LABEL_MARGIN = 4;\nconst LABEL_MAX_CHARS = 15;\nconst FONT_SIZE = 10;\nconst BASE_LINE_COLOR = '#dadada';\nconst FONT_FILL = '#555b51';\n\nfunction $$1(expr, con) {\n  return typeof expr === \"string\" ? (con || document).querySelector(expr) : expr || null;\n}\n\nfunction createSVG(tag, o) {\n  var element = document.createElementNS(\"http://www.w3.org/2000/svg\", tag);\n\n  for (var i in o) {\n    var val = o[i];\n\n    if (i === \"inside\") {\n      $$1(val).appendChild(element);\n    } else if (i === \"around\") {\n      var ref = $$1(val);\n      ref.parentNode.insertBefore(element, ref);\n      element.appendChild(ref);\n    } else if (i === \"styles\") {\n      if (typeof val === \"object\") {\n        Object.keys(val).map(prop => {\n          element.style[prop] = val[prop];\n        });\n      }\n    } else {\n      if (i === \"className\") {\n        i = \"class\";\n      }\n\n      if (i === \"innerHTML\") {\n        element['textContent'] = val;\n      } else {\n        element.setAttribute(i, val);\n      }\n    }\n  }\n\n  return element;\n}\n\nfunction renderVerticalGradient(svgDefElem, gradientId) {\n  return createSVG('linearGradient', {\n    inside: svgDefElem,\n    id: gradientId,\n    x1: 0,\n    x2: 0,\n    y1: 0,\n    y2: 1\n  });\n}\n\nfunction setGradientStop(gradElem, offset, color, opacity) {\n  return createSVG('stop', {\n    'inside': gradElem,\n    'style': `stop-color: ${color}`,\n    'offset': offset,\n    'stop-opacity': opacity\n  });\n}\n\nfunction makeSVGContainer(parent, className, width, height) {\n  return createSVG('svg', {\n    className: className,\n    inside: parent,\n    width: width,\n    height: height\n  });\n}\n\nfunction makeSVGDefs(svgContainer) {\n  return createSVG('defs', {\n    inside: svgContainer\n  });\n}\n\nfunction makeSVGGroup(className, transform = '', parent = undefined) {\n  let args = {\n    className: className,\n    transform: transform\n  };\n  if (parent) args.inside = parent;\n  return createSVG('g', args);\n}\n\nfunction makePath(pathStr, className = '', stroke = 'none', fill = 'none', strokeWidth = 2) {\n  return createSVG('path', {\n    className: className,\n    d: pathStr,\n    styles: {\n      stroke: stroke,\n      fill: fill,\n      'stroke-width': strokeWidth\n    }\n  });\n}\n\nfunction makeArcPathStr(startPosition, endPosition, center, radius, clockWise = 1, largeArc = 0) {\n  let [arcStartX, arcStartY] = [center.x + startPosition.x, center.y + startPosition.y];\n  let [arcEndX, arcEndY] = [center.x + endPosition.x, center.y + endPosition.y];\n  return `M${center.x} ${center.y}\n\t\tL${arcStartX} ${arcStartY}\n\t\tA ${radius} ${radius} 0 ${largeArc} ${clockWise ? 1 : 0}\n\t\t${arcEndX} ${arcEndY} z`;\n}\n\nfunction makeCircleStr(startPosition, endPosition, center, radius, clockWise = 1, largeArc = 0) {\n  let [arcStartX, arcStartY] = [center.x + startPosition.x, center.y + startPosition.y];\n  let [arcEndX, midArc, arcEndY] = [center.x + endPosition.x, center.y * 2, center.y + endPosition.y];\n  return `M${center.x} ${center.y}\n\t\tL${arcStartX} ${arcStartY}\n\t\tA ${radius} ${radius} 0 ${largeArc} ${clockWise ? 1 : 0}\n\t\t${arcEndX} ${midArc} z\n\t\tL${arcStartX} ${midArc}\n\t\tA ${radius} ${radius} 0 ${largeArc} ${clockWise ? 1 : 0}\n\t\t${arcEndX} ${arcEndY} z`;\n}\n\nfunction makeArcStrokePathStr(startPosition, endPosition, center, radius, clockWise = 1, largeArc = 0) {\n  let [arcStartX, arcStartY] = [center.x + startPosition.x, center.y + startPosition.y];\n  let [arcEndX, arcEndY] = [center.x + endPosition.x, center.y + endPosition.y];\n  return `M${arcStartX} ${arcStartY}\n\t\tA ${radius} ${radius} 0 ${largeArc} ${clockWise ? 1 : 0}\n\t\t${arcEndX} ${arcEndY}`;\n}\n\nfunction makeStrokeCircleStr(startPosition, endPosition, center, radius, clockWise = 1, largeArc = 0) {\n  let [arcStartX, arcStartY] = [center.x + startPosition.x, center.y + startPosition.y];\n  let [arcEndX, midArc, arcEndY] = [center.x + endPosition.x, radius * 2 + arcStartY, center.y + startPosition.y];\n  return `M${arcStartX} ${arcStartY}\n\t\tA ${radius} ${radius} 0 ${largeArc} ${clockWise ? 1 : 0}\n\t\t${arcEndX} ${midArc}\n\t\tM${arcStartX} ${midArc}\n\t\tA ${radius} ${radius} 0 ${largeArc} ${clockWise ? 1 : 0}\n\t\t${arcEndX} ${arcEndY}`;\n}\n\nfunction makeGradient(svgDefElem, color, lighter = false) {\n  let gradientId = 'path-fill-gradient' + '-' + color + '-' + (lighter ? 'lighter' : 'default');\n  let gradientDef = renderVerticalGradient(svgDefElem, gradientId);\n  let opacities = [1, 0.6, 0.2];\n\n  if (lighter) {\n    opacities = [0.4, 0.2, 0];\n  }\n\n  setGradientStop(gradientDef, \"0%\", color, opacities[0]);\n  setGradientStop(gradientDef, \"50%\", color, opacities[1]);\n  setGradientStop(gradientDef, \"100%\", color, opacities[2]);\n  return gradientId;\n}\n\nfunction percentageBar(x, y, width, height, depth = PERCENTAGE_BAR_DEFAULT_DEPTH, fill = 'none') {\n  let args = {\n    className: 'percentage-bar',\n    x: x,\n    y: y,\n    width: width,\n    height: height,\n    fill: fill,\n    styles: {\n      'stroke': lightenDarkenColor(fill, -25),\n      // Diabolically good: https://stackoverflow.com/a/9000859\n      // https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/stroke-dasharray\n      'stroke-dasharray': `0, ${height + width}, ${width}, ${height}`,\n      'stroke-width': depth\n    }\n  };\n  return createSVG(\"rect\", args);\n}\n\nfunction heatSquare(className, x, y, size, radius, fill = 'none', data = {}) {\n  let args = {\n    className: className,\n    x: x,\n    y: y,\n    width: size,\n    height: size,\n    rx: radius,\n    fill: fill\n  };\n  Object.keys(data).map(key => {\n    args[key] = data[key];\n  });\n  return createSVG(\"rect\", args);\n}\n\nfunction legendBar(x, y, size, fill = 'none', label, truncate = false) {\n  label = truncate ? truncateString(label, LABEL_MAX_CHARS) : label;\n  let args = {\n    className: 'legend-bar',\n    x: 0,\n    y: 0,\n    width: size,\n    height: '2px',\n    fill: fill\n  };\n  let text = createSVG('text', {\n    className: 'legend-dataset-text',\n    x: 0,\n    y: 0,\n    dy: FONT_SIZE * 2 + 'px',\n    'font-size': FONT_SIZE * 1.2 + 'px',\n    'text-anchor': 'start',\n    fill: FONT_FILL,\n    innerHTML: label\n  });\n  let group = createSVG('g', {\n    transform: `translate(${x}, ${y})`\n  });\n  group.appendChild(createSVG(\"rect\", args));\n  group.appendChild(text);\n  return group;\n}\n\nfunction legendDot(x, y, size, fill = 'none', label, truncate = false) {\n  label = truncate ? truncateString(label, LABEL_MAX_CHARS) : label;\n  let args = {\n    className: 'legend-dot',\n    cx: 0,\n    cy: 0,\n    r: size,\n    fill: fill\n  };\n  let text = createSVG('text', {\n    className: 'legend-dataset-text',\n    x: 0,\n    y: 0,\n    dx: FONT_SIZE + 'px',\n    dy: FONT_SIZE / 3 + 'px',\n    'font-size': FONT_SIZE * 1.2 + 'px',\n    'text-anchor': 'start',\n    fill: FONT_FILL,\n    innerHTML: label\n  });\n  let group = createSVG('g', {\n    transform: `translate(${x}, ${y})`\n  });\n  group.appendChild(createSVG(\"circle\", args));\n  group.appendChild(text);\n  return group;\n}\n\nfunction makeText(className, x, y, content, options = {}) {\n  let fontSize = options.fontSize || FONT_SIZE;\n  let dy = options.dy !== undefined ? options.dy : fontSize / 2;\n  let fill = options.fill || FONT_FILL;\n  let textAnchor = options.textAnchor || 'start';\n  return createSVG('text', {\n    className: className,\n    x: x,\n    y: y,\n    dy: dy + 'px',\n    'font-size': fontSize + 'px',\n    fill: fill,\n    'text-anchor': textAnchor,\n    innerHTML: content\n  });\n}\n\nfunction makeVertLine(x, label, y1, y2, options = {}) {\n  if (!options.stroke) options.stroke = BASE_LINE_COLOR;\n  let l = createSVG('line', {\n    className: 'line-vertical ' + options.className,\n    x1: 0,\n    x2: 0,\n    y1: y1,\n    y2: y2,\n    styles: {\n      stroke: options.stroke\n    }\n  });\n  let text = createSVG('text', {\n    x: 0,\n    y: y1 > y2 ? y1 + LABEL_MARGIN : y1 - LABEL_MARGIN - FONT_SIZE,\n    dy: FONT_SIZE + 'px',\n    'font-size': FONT_SIZE + 'px',\n    'text-anchor': 'middle',\n    innerHTML: label + \"\"\n  });\n  let line = createSVG('g', {\n    transform: `translate(${x}, 0)`\n  });\n  line.appendChild(l);\n  line.appendChild(text);\n  return line;\n}\n\nfunction makeHoriLine(y, label, x1, x2, options = {}) {\n  if (!options.stroke) options.stroke = BASE_LINE_COLOR;\n  if (!options.lineType) options.lineType = '';\n  if (options.shortenNumbers) label = shortenLargeNumber(label);\n  let className = 'line-horizontal ' + options.className + (options.lineType === \"dashed\" ? \"dashed\" : \"\");\n  let l = createSVG('line', {\n    className: className,\n    x1: x1,\n    x2: x2,\n    y1: 0,\n    y2: 0,\n    styles: {\n      stroke: options.stroke\n    }\n  });\n  let text = createSVG('text', {\n    x: x1 < x2 ? x1 - LABEL_MARGIN : x1 + LABEL_MARGIN,\n    y: 0,\n    dy: FONT_SIZE / 2 - 2 + 'px',\n    'font-size': FONT_SIZE + 'px',\n    'text-anchor': x1 < x2 ? 'end' : 'start',\n    innerHTML: label + \"\"\n  });\n  let line = createSVG('g', {\n    transform: `translate(0, ${y})`,\n    'stroke-opacity': 1\n  });\n\n  if (text === 0 || text === '0') {\n    line.style.stroke = \"rgba(27, 31, 35, 0.6)\";\n  }\n\n  line.appendChild(l);\n  line.appendChild(text);\n  return line;\n}\n\nfunction yLine(y, label, width, options = {}) {\n  if (!isValidNumber(y)) y = 0;\n  if (!options.pos) options.pos = 'left';\n  if (!options.offset) options.offset = 0;\n  if (!options.mode) options.mode = 'span';\n  if (!options.stroke) options.stroke = BASE_LINE_COLOR;\n  if (!options.className) options.className = '';\n  let x1 = -1 * AXIS_TICK_LENGTH;\n  let x2 = options.mode === 'span' ? width + AXIS_TICK_LENGTH : 0;\n\n  if (options.mode === 'tick' && options.pos === 'right') {\n    x1 = width + AXIS_TICK_LENGTH;\n    x2 = width;\n  } // let offset = options.pos === 'left' ? -1 * options.offset : options.offset;\n\n\n  x1 += options.offset;\n  x2 += options.offset;\n  return makeHoriLine(y, label, x1, x2, {\n    stroke: options.stroke,\n    className: options.className,\n    lineType: options.lineType,\n    shortenNumbers: options.shortenNumbers\n  });\n}\n\nfunction xLine(x, label, height, options = {}) {\n  if (!isValidNumber(x)) x = 0;\n  if (!options.pos) options.pos = 'bottom';\n  if (!options.offset) options.offset = 0;\n  if (!options.mode) options.mode = 'span';\n  if (!options.stroke) options.stroke = BASE_LINE_COLOR;\n  if (!options.className) options.className = ''; // Draw X axis line in span/tick mode with optional label\n  //                        \ty2(span)\n  // \t\t\t\t\t\t|\n  // \t\t\t\t\t\t|\n  //\t\t\t\tx line\t|\n  //\t\t\t\t\t\t|\n  // \t\t\t\t\t   \t|\n  // ---------------------+-- y2(tick)\n  //\t\t\t\t\t\t|\n  //\t\t\t\t\t\t\ty1\n\n  let y1 = height + AXIS_TICK_LENGTH;\n  let y2 = options.mode === 'span' ? -1 * AXIS_TICK_LENGTH : height;\n\n  if (options.mode === 'tick' && options.pos === 'top') {\n    // top axis ticks\n    y1 = -1 * AXIS_TICK_LENGTH;\n    y2 = 0;\n  }\n\n  return makeVertLine(x, label, y1, y2, {\n    stroke: options.stroke,\n    className: options.className,\n    lineType: options.lineType\n  });\n}\n\nfunction yMarker(y, label, width, options = {}) {\n  if (!options.labelPos) options.labelPos = 'right';\n  let x = options.labelPos === 'left' ? LABEL_MARGIN : width - getStringWidth(label, 5) - LABEL_MARGIN;\n  let labelSvg = createSVG('text', {\n    className: 'chart-label',\n    x: x,\n    y: 0,\n    dy: FONT_SIZE / -2 + 'px',\n    'font-size': FONT_SIZE + 'px',\n    'text-anchor': 'start',\n    innerHTML: label + \"\"\n  });\n  let line = makeHoriLine(y, '', 0, width, {\n    stroke: options.stroke || BASE_LINE_COLOR,\n    className: options.className || '',\n    lineType: options.lineType\n  });\n  line.appendChild(labelSvg);\n  return line;\n}\n\nfunction yRegion(y1, y2, width, label, options = {}) {\n  // return a group\n  let height = y1 - y2;\n  let rect = createSVG('rect', {\n    className: `bar mini`,\n    // remove class\n    styles: {\n      fill: `rgba(228, 234, 239, 0.49)`,\n      stroke: BASE_LINE_COLOR,\n      'stroke-dasharray': `${width}, ${height}`\n    },\n    // 'data-point-index': index,\n    x: 0,\n    y: 0,\n    width: width,\n    height: height\n  });\n  if (!options.labelPos) options.labelPos = 'right';\n  let x = options.labelPos === 'left' ? LABEL_MARGIN : width - getStringWidth(label + \"\", 4.5) - LABEL_MARGIN;\n  let labelSvg = createSVG('text', {\n    className: 'chart-label',\n    x: x,\n    y: 0,\n    dy: FONT_SIZE / -2 + 'px',\n    'font-size': FONT_SIZE + 'px',\n    'text-anchor': 'start',\n    innerHTML: label + \"\"\n  });\n  let region = createSVG('g', {\n    transform: `translate(0, ${y2})`\n  });\n  region.appendChild(rect);\n  region.appendChild(labelSvg);\n  return region;\n}\n\nfunction datasetBar(x, yTop, width, color, label = '', index = 0, offset = 0, meta = {}) {\n  let [height, y] = getBarHeightAndYAttr(yTop, meta.zeroLine);\n  y -= offset;\n\n  if (height === 0) {\n    height = meta.minHeight;\n    y -= meta.minHeight;\n  } // Preprocess numbers to avoid svg building errors\n\n\n  if (!isValidNumber(x)) x = 0;\n  if (!isValidNumber(y)) y = 0;\n  if (!isValidNumber(height, true)) height = 0;\n  if (!isValidNumber(width, true)) width = 0;\n  let rect = createSVG('rect', {\n    className: `bar mini`,\n    style: `fill: ${color}`,\n    'data-point-index': index,\n    x: x,\n    y: y,\n    width: width,\n    height: height\n  });\n  label += \"\";\n\n  if (!label && !label.length) {\n    return rect;\n  } else {\n    rect.setAttribute('y', 0);\n    rect.setAttribute('x', 0);\n    let text = createSVG('text', {\n      className: 'data-point-value',\n      x: width / 2,\n      y: 0,\n      dy: FONT_SIZE / 2 * -1 + 'px',\n      'font-size': FONT_SIZE + 'px',\n      'text-anchor': 'middle',\n      innerHTML: label\n    });\n    let group = createSVG('g', {\n      'data-point-index': index,\n      transform: `translate(${x}, ${y})`\n    });\n    group.appendChild(rect);\n    group.appendChild(text);\n    return group;\n  }\n}\n\nfunction datasetDot(x, y, radius, color, label = '', index = 0) {\n  let dot = createSVG('circle', {\n    style: `fill: ${color}`,\n    'data-point-index': index,\n    cx: x,\n    cy: y,\n    r: radius\n  });\n  label += \"\";\n\n  if (!label && !label.length) {\n    return dot;\n  } else {\n    dot.setAttribute('cy', 0);\n    dot.setAttribute('cx', 0);\n    let text = createSVG('text', {\n      className: 'data-point-value',\n      x: 0,\n      y: 0,\n      dy: FONT_SIZE / 2 * -1 - radius + 'px',\n      'font-size': FONT_SIZE + 'px',\n      'text-anchor': 'middle',\n      innerHTML: label\n    });\n    let group = createSVG('g', {\n      'data-point-index': index,\n      transform: `translate(${x}, ${y})`\n    });\n    group.appendChild(dot);\n    group.appendChild(text);\n    return group;\n  }\n}\n\nfunction getPaths(xList, yList, color, options = {}, meta = {}) {\n  let pointsList = yList.map((y, i) => xList[i] + ',' + y);\n  let pointsStr = pointsList.join(\"L\"); // Spline\n\n  if (options.spline) pointsStr = getSplineCurvePointsStr(xList, yList);\n  let path = makePath(\"M\" + pointsStr, 'line-graph-path', color); // HeatLine\n\n  if (options.heatline) {\n    let gradient_id = makeGradient(meta.svgDefs, color);\n    path.style.stroke = `url(#${gradient_id})`;\n  }\n\n  let paths = {\n    path: path\n  }; // Region\n\n  if (options.regionFill) {\n    let gradient_id_region = makeGradient(meta.svgDefs, color, true);\n    let pathStr = \"M\" + `${xList[0]},${meta.zeroLine}L` + pointsStr + `L${xList.slice(-1)[0]},${meta.zeroLine}`;\n    paths.region = makePath(pathStr, `region-fill`, 'none', `url(#${gradient_id_region})`);\n  }\n\n  return paths;\n}\n\nlet makeOverlay = {\n  'bar': unit => {\n    let transformValue;\n\n    if (unit.nodeName !== 'rect') {\n      transformValue = unit.getAttribute('transform');\n      unit = unit.childNodes[0];\n    }\n\n    let overlay = unit.cloneNode();\n    overlay.style.fill = '#000000';\n    overlay.style.opacity = '0.4';\n\n    if (transformValue) {\n      overlay.setAttribute('transform', transformValue);\n    }\n\n    return overlay;\n  },\n  'dot': unit => {\n    let transformValue;\n\n    if (unit.nodeName !== 'circle') {\n      transformValue = unit.getAttribute('transform');\n      unit = unit.childNodes[0];\n    }\n\n    let overlay = unit.cloneNode();\n    let radius = unit.getAttribute('r');\n    let fill = unit.getAttribute('fill');\n    overlay.setAttribute('r', parseInt(radius) + DOT_OVERLAY_SIZE_INCR);\n    overlay.setAttribute('fill', fill);\n    overlay.style.opacity = '0.6';\n\n    if (transformValue) {\n      overlay.setAttribute('transform', transformValue);\n    }\n\n    return overlay;\n  },\n  'heat_square': unit => {\n    let transformValue;\n\n    if (unit.nodeName !== 'circle') {\n      transformValue = unit.getAttribute('transform');\n      unit = unit.childNodes[0];\n    }\n\n    let overlay = unit.cloneNode();\n    let radius = unit.getAttribute('r');\n    let fill = unit.getAttribute('fill');\n    overlay.setAttribute('r', parseInt(radius) + DOT_OVERLAY_SIZE_INCR);\n    overlay.setAttribute('fill', fill);\n    overlay.style.opacity = '0.6';\n\n    if (transformValue) {\n      overlay.setAttribute('transform', transformValue);\n    }\n\n    return overlay;\n  }\n};\nlet updateOverlay = {\n  'bar': (unit, overlay) => {\n    let transformValue;\n\n    if (unit.nodeName !== 'rect') {\n      transformValue = unit.getAttribute('transform');\n      unit = unit.childNodes[0];\n    }\n\n    let attributes = ['x', 'y', 'width', 'height'];\n    Object.values(unit.attributes).filter(attr => attributes.includes(attr.name) && attr.specified).map(attr => {\n      overlay.setAttribute(attr.name, attr.nodeValue);\n    });\n\n    if (transformValue) {\n      overlay.setAttribute('transform', transformValue);\n    }\n  },\n  'dot': (unit, overlay) => {\n    let transformValue;\n\n    if (unit.nodeName !== 'circle') {\n      transformValue = unit.getAttribute('transform');\n      unit = unit.childNodes[0];\n    }\n\n    let attributes = ['cx', 'cy'];\n    Object.values(unit.attributes).filter(attr => attributes.includes(attr.name) && attr.specified).map(attr => {\n      overlay.setAttribute(attr.name, attr.nodeValue);\n    });\n\n    if (transformValue) {\n      overlay.setAttribute('transform', transformValue);\n    }\n  },\n  'heat_square': (unit, overlay) => {\n    let transformValue;\n\n    if (unit.nodeName !== 'circle') {\n      transformValue = unit.getAttribute('transform');\n      unit = unit.childNodes[0];\n    }\n\n    let attributes = ['cx', 'cy'];\n    Object.values(unit.attributes).filter(attr => attributes.includes(attr.name) && attr.specified).map(attr => {\n      overlay.setAttribute(attr.name, attr.nodeValue);\n    });\n\n    if (transformValue) {\n      overlay.setAttribute('transform', transformValue);\n    }\n  }\n};\nconst UNIT_ANIM_DUR = 350;\nconst PATH_ANIM_DUR = 350;\nconst MARKER_LINE_ANIM_DUR = UNIT_ANIM_DUR;\nconst REPLACE_ALL_NEW_DUR = 250;\nconst STD_EASING = 'easein';\n\nfunction translate(unit, oldCoord, newCoord, duration) {\n  let old = typeof oldCoord === 'string' ? oldCoord : oldCoord.join(', ');\n  return [unit, {\n    transform: newCoord.join(', ')\n  }, duration, STD_EASING, \"translate\", {\n    transform: old\n  }];\n}\n\nfunction translateVertLine(xLine, newX, oldX) {\n  return translate(xLine, [oldX, 0], [newX, 0], MARKER_LINE_ANIM_DUR);\n}\n\nfunction translateHoriLine(yLine, newY, oldY) {\n  return translate(yLine, [0, oldY], [0, newY], MARKER_LINE_ANIM_DUR);\n}\n\nfunction animateRegion(rectGroup, newY1, newY2, oldY2) {\n  let newHeight = newY1 - newY2;\n  let rect = rectGroup.childNodes[0];\n  let width = rect.getAttribute(\"width\");\n  let rectAnim = [rect, {\n    height: newHeight,\n    'stroke-dasharray': `${width}, ${newHeight}`\n  }, MARKER_LINE_ANIM_DUR, STD_EASING];\n  let groupAnim = translate(rectGroup, [0, oldY2], [0, newY2], MARKER_LINE_ANIM_DUR);\n  return [rectAnim, groupAnim];\n}\n\nfunction animateBar(bar, x, yTop, width, offset = 0, meta = {}) {\n  let [height, y] = getBarHeightAndYAttr(yTop, meta.zeroLine);\n  y -= offset;\n\n  if (bar.nodeName !== 'rect') {\n    let rect = bar.childNodes[0];\n    let rectAnim = [rect, {\n      width: width,\n      height: height\n    }, UNIT_ANIM_DUR, STD_EASING];\n    let oldCoordStr = bar.getAttribute(\"transform\").split(\"(\")[1].slice(0, -1);\n    let groupAnim = translate(bar, oldCoordStr, [x, y], MARKER_LINE_ANIM_DUR);\n    return [rectAnim, groupAnim];\n  } else {\n    return [[bar, {\n      width: width,\n      height: height,\n      x: x,\n      y: y\n    }, UNIT_ANIM_DUR, STD_EASING]];\n  } // bar.animate({height: args.newHeight, y: yTop}, UNIT_ANIM_DUR, mina.easein);\n\n}\n\nfunction animateDot(dot, x, y) {\n  if (dot.nodeName !== 'circle') {\n    let oldCoordStr = dot.getAttribute(\"transform\").split(\"(\")[1].slice(0, -1);\n    let groupAnim = translate(dot, oldCoordStr, [x, y], MARKER_LINE_ANIM_DUR);\n    return [groupAnim];\n  } else {\n    return [[dot, {\n      cx: x,\n      cy: y\n    }, UNIT_ANIM_DUR, STD_EASING]];\n  } // dot.animate({cy: yTop}, UNIT_ANIM_DUR, mina.easein);\n\n}\n\nfunction animatePath(paths, newXList, newYList, zeroLine, spline) {\n  let pathComponents = [];\n  let pointsStr = newYList.map((y, i) => newXList[i] + ',' + y).join(\"L\");\n  if (spline) pointsStr = getSplineCurvePointsStr(newXList, newYList);\n  const animPath = [paths.path, {\n    d: \"M\" + pointsStr\n  }, PATH_ANIM_DUR, STD_EASING];\n  pathComponents.push(animPath);\n\n  if (paths.region) {\n    let regStartPt = `${newXList[0]},${zeroLine}L`;\n    let regEndPt = `L${newXList.slice(-1)[0]}, ${zeroLine}`;\n    const animRegion = [paths.region, {\n      d: \"M\" + regStartPt + pointsStr + regEndPt\n    }, PATH_ANIM_DUR, STD_EASING];\n    pathComponents.push(animRegion);\n  }\n\n  return pathComponents;\n}\n\nfunction animatePathStr(oldPath, pathStr) {\n  return [oldPath, {\n    d: pathStr\n  }, UNIT_ANIM_DUR, STD_EASING];\n} // Leveraging SMIL Animations\n\n\nconst EASING = {\n  ease: \"0.25 0.1 0.25 1\",\n  linear: \"0 0 1 1\",\n  // easein: \"0.42 0 1 1\",\n  easein: \"0.1 0.8 0.2 1\",\n  easeout: \"0 0 0.58 1\",\n  easeinout: \"0.42 0 0.58 1\"\n};\n\nfunction animateSVGElement(element, props, dur, easingType = \"linear\", type = undefined, oldValues = {}) {\n  let animElement = element.cloneNode(true);\n  let newElement = element.cloneNode(true);\n\n  for (var attributeName in props) {\n    let animateElement;\n\n    if (attributeName === 'transform') {\n      animateElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"animateTransform\");\n    } else {\n      animateElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"animate\");\n    }\n\n    let currentValue = oldValues[attributeName] || element.getAttribute(attributeName);\n    let value = props[attributeName];\n    let animAttr = {\n      attributeName: attributeName,\n      from: currentValue,\n      to: value,\n      begin: \"0s\",\n      dur: dur / 1000 + \"s\",\n      values: currentValue + \";\" + value,\n      keySplines: EASING[easingType],\n      keyTimes: \"0;1\",\n      calcMode: \"spline\",\n      fill: 'freeze'\n    };\n\n    if (type) {\n      animAttr[\"type\"] = type;\n    }\n\n    for (var i in animAttr) {\n      animateElement.setAttribute(i, animAttr[i]);\n    }\n\n    animElement.appendChild(animateElement);\n\n    if (type) {\n      newElement.setAttribute(attributeName, `translate(${value})`);\n    } else {\n      newElement.setAttribute(attributeName, value);\n    }\n  }\n\n  return [animElement, newElement];\n}\n\nfunction transform(element, style) {\n  // eslint-disable-line no-unused-vars\n  element.style.transform = style;\n  element.style.webkitTransform = style;\n  element.style.msTransform = style;\n  element.style.mozTransform = style;\n  element.style.oTransform = style;\n}\n\nfunction animateSVG(svgContainer, elements) {\n  let newElements = [];\n  let animElements = [];\n  elements.map(element => {\n    let unit = element[0];\n    let parent = unit.parentNode;\n    let animElement, newElement;\n    element[0] = unit;\n    [animElement, newElement] = animateSVGElement(...element);\n    newElements.push(newElement);\n    animElements.push([animElement, parent]);\n    parent.replaceChild(animElement, unit);\n  });\n  let animSvg = svgContainer.cloneNode(true);\n  animElements.map((animElement, i) => {\n    animElement[1].replaceChild(newElements[i], animElement[0]);\n    elements[i][0] = newElements[i];\n  });\n  return animSvg;\n}\n\nfunction runSMILAnimation(parent, svgElement, elementsToAnimate) {\n  if (elementsToAnimate.length === 0) return;\n  let animSvgElement = animateSVG(svgElement, elementsToAnimate);\n\n  if (svgElement.parentNode == parent) {\n    parent.removeChild(svgElement);\n    parent.appendChild(animSvgElement);\n  } // Replace the new svgElement (data has already been replaced)\n\n\n  setTimeout(() => {\n    if (animSvgElement.parentNode == parent) {\n      parent.removeChild(animSvgElement);\n      parent.appendChild(svgElement);\n    }\n  }, REPLACE_ALL_NEW_DUR);\n}\n\nconst CSSTEXT = \".chart-container{position:relative;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif}.chart-container .axis,.chart-container .chart-label{fill:#555b51}.chart-container .axis line,.chart-container .chart-label line{stroke:#dadada}.chart-container .dataset-units circle{stroke:#fff;stroke-width:2}.chart-container .dataset-units path{fill:none;stroke-opacity:1;stroke-width:2px}.chart-container .dataset-path{stroke-width:2px}.chart-container .path-group path{fill:none;stroke-opacity:1;stroke-width:2px}.chart-container line.dashed{stroke-dasharray:5,3}.chart-container .axis-line .specific-value{text-anchor:start}.chart-container .axis-line .y-line{text-anchor:end}.chart-container .axis-line .x-line{text-anchor:middle}.chart-container .legend-dataset-text{fill:#6c7680;font-weight:600}.graph-svg-tip{position:absolute;z-index:99999;padding:10px;font-size:12px;color:#959da5;text-align:center;background:rgba(0,0,0,.8);border-radius:3px}.graph-svg-tip ul{padding-left:0;display:flex}.graph-svg-tip ol{padding-left:0;display:flex}.graph-svg-tip ul.data-point-list li{min-width:90px;flex:1;font-weight:600}.graph-svg-tip strong{color:#dfe2e5;font-weight:600}.graph-svg-tip .svg-pointer{position:absolute;height:5px;margin:0 0 0 -5px;content:' ';border:5px solid transparent;border-top-color:rgba(0,0,0,.8)}.graph-svg-tip.comparison{padding:0;text-align:left;pointer-events:none}.graph-svg-tip.comparison .title{display:block;padding:10px;margin:0;font-weight:600;line-height:1;pointer-events:none}.graph-svg-tip.comparison ul{margin:0;white-space:nowrap;list-style:none}.graph-svg-tip.comparison li{display:inline-block;padding:5px 10px}\";\n\nfunction downloadFile(filename, data) {\n  var a = document.createElement('a');\n  a.style = \"display: none\";\n  var blob = new Blob(data, {\n    type: \"image/svg+xml; charset=utf-8\"\n  });\n  var url = window.URL.createObjectURL(blob);\n  a.href = url;\n  a.download = filename;\n  document.body.appendChild(a);\n  a.click();\n  setTimeout(function () {\n    document.body.removeChild(a);\n    window.URL.revokeObjectURL(url);\n  }, 300);\n}\n\nfunction prepareForExport(svg) {\n  let clone = svg.cloneNode(true);\n  clone.classList.add('chart-container');\n  clone.setAttribute('xmlns', \"http://www.w3.org/2000/svg\");\n  clone.setAttribute('xmlns:xlink', \"http://www.w3.org/1999/xlink\");\n  let styleEl = $.create('style', {\n    'innerHTML': CSSTEXT\n  });\n  clone.insertBefore(styleEl, clone.firstChild);\n  let container = $.create('div');\n  container.appendChild(clone);\n  return container.innerHTML;\n}\n\nclass BaseChart {\n  constructor(parent, options) {\n    this.parent = typeof parent === 'string' ? document.querySelector(parent) : parent;\n\n    if (!(this.parent instanceof HTMLElement)) {\n      throw new Error('No `parent` element to render on was provided.');\n    }\n\n    this.rawChartArgs = options;\n    this.title = options.title || '';\n    this.type = options.type || '';\n    this.realData = this.prepareData(options.data);\n    this.data = this.prepareFirstData(this.realData);\n    this.colors = this.validateColors(options.colors, this.type);\n    this.config = {\n      showTooltip: 1,\n      // calculate\n      showLegend: 1,\n      // calculate\n      isNavigable: options.isNavigable || 0,\n      animate: typeof options.animate !== 'undefined' ? options.animate : 1,\n      truncateLegends: options.truncateLegends || 1\n    };\n    this.measures = JSON.parse(JSON.stringify(BASE_MEASURES));\n    let m = this.measures;\n    this.setMeasures(options);\n\n    if (!this.title.length) {\n      m.titleHeight = 0;\n    }\n\n    if (!this.config.showLegend) m.legendHeight = 0;\n    this.argHeight = options.height || m.baseHeight;\n    this.state = {};\n    this.options = {};\n    this.initTimeout = INIT_CHART_UPDATE_TIMEOUT;\n\n    if (this.config.isNavigable) {\n      this.overlays = [];\n    }\n\n    this.configure(options);\n  }\n\n  prepareData(data) {\n    return data;\n  }\n\n  prepareFirstData(data) {\n    return data;\n  }\n\n  validateColors(colors, type) {\n    const validColors = [];\n    colors = (colors || []).concat(DEFAULT_COLORS[type]);\n    colors.forEach(string => {\n      const color = getColor(string);\n\n      if (!isValidColor(color)) {\n        console.warn('\"' + string + '\" is not a valid color.');\n      } else {\n        validColors.push(color);\n      }\n    });\n    return validColors;\n  }\n\n  setMeasures() {// Override measures, including those for title and legend\n    // set config for legend and title\n  }\n\n  configure() {\n    let height = this.argHeight;\n    this.baseHeight = height;\n    this.height = height - getExtraHeight(this.measures); // Bind window events\n\n    this.boundDrawFn = () => this.draw(true);\n\n    window.addEventListener('resize', this.boundDrawFn);\n    window.addEventListener('orientationchange', this.boundDrawFn);\n  }\n\n  destroy() {\n    window.removeEventListener('resize', this.boundDrawFn);\n    window.removeEventListener('orientationchange', this.boundDrawFn);\n  } // Has to be called manually\n\n\n  setup() {\n    this.makeContainer();\n    this.updateWidth();\n    this.makeTooltip();\n    this.draw(false, true);\n  }\n\n  makeContainer() {\n    // Chart needs a dedicated parent element\n    this.parent.innerHTML = '';\n    let args = {\n      inside: this.parent,\n      className: 'chart-container'\n    };\n\n    if (this.independentWidth) {\n      args.styles = {\n        width: this.independentWidth + 'px'\n      };\n    }\n\n    this.container = $.create('div', args);\n  }\n\n  makeTooltip() {\n    this.tip = new SvgTip({\n      parent: this.container,\n      colors: this.colors\n    });\n    this.bindTooltip();\n  }\n\n  bindTooltip() {}\n\n  draw(onlyWidthChange = false, init = false) {\n    if (onlyWidthChange && isHidden(this.parent)) {\n      // Don't update anything if the chart is hidden\n      return;\n    }\n\n    this.updateWidth();\n    this.calc(onlyWidthChange);\n    this.makeChartArea();\n    this.setupComponents();\n    this.components.forEach(c => c.setup(this.drawArea)); // this.components.forEach(c => c.make());\n\n    this.render(this.components, false);\n\n    if (init) {\n      this.data = this.realData;\n      setTimeout(() => {\n        this.update(this.data);\n      }, this.initTimeout);\n    }\n\n    this.renderLegend();\n    this.setupNavigation(init);\n  }\n\n  calc() {} // builds state\n\n\n  updateWidth() {\n    this.baseWidth = getElementContentWidth(this.parent);\n    this.width = this.baseWidth - getExtraWidth(this.measures);\n  }\n\n  makeChartArea() {\n    if (this.svg) {\n      this.container.removeChild(this.svg);\n    }\n\n    let m = this.measures;\n    this.svg = makeSVGContainer(this.container, 'frappe-chart chart', this.baseWidth, this.baseHeight);\n    this.svgDefs = makeSVGDefs(this.svg);\n\n    if (this.title.length) {\n      this.titleEL = makeText('title', m.margins.left, m.margins.top, this.title, {\n        fontSize: m.titleFontSize,\n        fill: '#666666',\n        dy: m.titleFontSize\n      });\n    }\n\n    let top = getTopOffset(m);\n    this.drawArea = makeSVGGroup(this.type + '-chart chart-draw-area', `translate(${getLeftOffset(m)}, ${top})`);\n\n    if (this.config.showLegend) {\n      top += this.height + m.paddings.bottom;\n      this.legendArea = makeSVGGroup('chart-legend', `translate(${getLeftOffset(m)}, ${top})`);\n    }\n\n    if (this.title.length) {\n      this.svg.appendChild(this.titleEL);\n    }\n\n    this.svg.appendChild(this.drawArea);\n\n    if (this.config.showLegend) {\n      this.svg.appendChild(this.legendArea);\n    }\n\n    this.updateTipOffset(getLeftOffset(m), getTopOffset(m));\n  }\n\n  updateTipOffset(x, y) {\n    this.tip.offset = {\n      x: x,\n      y: y\n    };\n  }\n\n  setupComponents() {\n    this.components = new Map();\n  }\n\n  update(data) {\n    if (!data) {\n      console.error('No data to update.');\n    }\n\n    this.data = this.prepareData(data);\n    this.calc(); // builds state\n\n    this.render(this.components, this.config.animate);\n  }\n\n  render(components = this.components, animate = true) {\n    if (this.config.isNavigable) {\n      // Remove all existing overlays\n      this.overlays.map(o => o.parentNode.removeChild(o)); // ref.parentNode.insertBefore(element, ref);\n    }\n\n    let elementsToAnimate = []; // Can decouple to this.refreshComponents() first to save animation timeout\n\n    components.forEach(c => {\n      elementsToAnimate = elementsToAnimate.concat(c.update(animate));\n    });\n\n    if (elementsToAnimate.length > 0) {\n      runSMILAnimation(this.container, this.svg, elementsToAnimate);\n      setTimeout(() => {\n        components.forEach(c => c.make());\n        this.updateNav();\n      }, CHART_POST_ANIMATE_TIMEOUT);\n    } else {\n      components.forEach(c => c.make());\n      this.updateNav();\n    }\n  }\n\n  updateNav() {\n    if (this.config.isNavigable) {\n      this.makeOverlay();\n      this.bindUnits();\n    }\n  }\n\n  renderLegend() {}\n\n  setupNavigation(init = false) {\n    if (!this.config.isNavigable) return;\n\n    if (init) {\n      this.bindOverlay();\n      this.keyActions = {\n        '13': this.onEnterKey.bind(this),\n        '37': this.onLeftArrow.bind(this),\n        '38': this.onUpArrow.bind(this),\n        '39': this.onRightArrow.bind(this),\n        '40': this.onDownArrow.bind(this)\n      };\n      document.addEventListener('keydown', e => {\n        if (isElementInViewport(this.container)) {\n          e = e || window.event;\n\n          if (this.keyActions[e.keyCode]) {\n            this.keyActions[e.keyCode]();\n          }\n        }\n      });\n    }\n  }\n\n  makeOverlay() {}\n\n  updateOverlay() {}\n\n  bindOverlay() {}\n\n  bindUnits() {}\n\n  onLeftArrow() {}\n\n  onRightArrow() {}\n\n  onUpArrow() {}\n\n  onDownArrow() {}\n\n  onEnterKey() {}\n\n  addDataPoint() {}\n\n  removeDataPoint() {}\n\n  getDataPoint() {}\n\n  setCurrentDataPoint() {}\n\n  updateDataset() {}\n\n  export() {\n    let chartSvg = prepareForExport(this.svg);\n    downloadFile(this.title || 'Chart', [chartSvg]);\n  }\n\n}\n\nclass AggregationChart extends BaseChart {\n  constructor(parent, args) {\n    super(parent, args);\n  }\n\n  configure(args) {\n    super.configure(args);\n    this.config.maxSlices = args.maxSlices || 20;\n    this.config.maxLegendPoints = args.maxLegendPoints || 20;\n  }\n\n  calc() {\n    let s = this.state;\n    let maxSlices = this.config.maxSlices;\n    s.sliceTotals = [];\n    let allTotals = this.data.labels.map((label, i) => {\n      let total = 0;\n      this.data.datasets.map(e => {\n        total += e.values[i];\n      });\n      return [total, label];\n    }).filter(d => {\n      return d[0] >= 0;\n    }); // keep only positive results\n\n    let totals = allTotals;\n\n    if (allTotals.length > maxSlices) {\n      // Prune and keep a grey area for rest as per maxSlices\n      allTotals.sort((a, b) => {\n        return b[0] - a[0];\n      });\n      totals = allTotals.slice(0, maxSlices - 1);\n      let remaining = allTotals.slice(maxSlices - 1);\n      let sumOfRemaining = 0;\n      remaining.map(d => {\n        sumOfRemaining += d[0];\n      });\n      totals.push([sumOfRemaining, 'Rest']);\n      this.colors[maxSlices - 1] = 'grey';\n    }\n\n    s.labels = [];\n    totals.map(d => {\n      s.sliceTotals.push(d[0]);\n      s.labels.push(d[1]);\n    });\n    s.grandTotal = s.sliceTotals.reduce((a, b) => a + b, 0);\n    this.center = {\n      x: this.width / 2,\n      y: this.height / 2\n    };\n  }\n\n  renderLegend() {\n    let s = this.state;\n    this.legendArea.textContent = '';\n    this.legendTotals = s.sliceTotals.slice(0, this.config.maxLegendPoints);\n    let count = 0;\n    let y = 0;\n    this.legendTotals.map((d, i) => {\n      let barWidth = 150;\n      let divisor = Math.floor((this.width - getExtraWidth(this.measures)) / barWidth);\n\n      if (this.legendTotals.length < divisor) {\n        barWidth = this.width / this.legendTotals.length;\n      }\n\n      if (count > divisor) {\n        count = 0;\n        y += 20;\n      }\n\n      let x = barWidth * count + 5;\n      let label = this.config.truncateLegends ? truncateString(s.labels[i], barWidth / 10) : s.labels[i];\n      let dot = legendDot(x, y, 5, this.colors[i], `${label}: ${d}`, false);\n      this.legendArea.appendChild(dot);\n      count++;\n    });\n  }\n\n} // Playing around with dates\n\n\nconst NO_OF_YEAR_MONTHS = 12;\nconst NO_OF_DAYS_IN_WEEK = 7;\nconst NO_OF_MILLIS = 1000;\nconst SEC_IN_DAY = 86400;\nconst MONTH_NAMES = [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"];\nconst DAY_NAMES_SHORT = [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"]; // https://stackoverflow.com/a/11252167/6495043\n\nfunction treatAsUtc(date) {\n  let result = new Date(date);\n  result.setMinutes(result.getMinutes() - result.getTimezoneOffset());\n  return result;\n}\n\nfunction getYyyyMmDd(date) {\n  let dd = date.getDate();\n  let mm = date.getMonth() + 1; // getMonth() is zero-based\n\n  return [date.getFullYear(), (mm > 9 ? '' : '0') + mm, (dd > 9 ? '' : '0') + dd].join('-');\n}\n\nfunction clone(date) {\n  return new Date(date.getTime());\n} // export function getMonthsBetween(startDate, endDate) {}\n\n\nfunction getWeeksBetween(startDate, endDate) {\n  let weekStartDate = setDayToSunday(startDate);\n  return Math.ceil(getDaysBetween(weekStartDate, endDate) / NO_OF_DAYS_IN_WEEK);\n}\n\nfunction getDaysBetween(startDate, endDate) {\n  let millisecondsPerDay = SEC_IN_DAY * NO_OF_MILLIS;\n  return (treatAsUtc(endDate) - treatAsUtc(startDate)) / millisecondsPerDay;\n}\n\nfunction areInSameMonth(startDate, endDate) {\n  return startDate.getMonth() === endDate.getMonth() && startDate.getFullYear() === endDate.getFullYear();\n}\n\nfunction getMonthName(i, short = false) {\n  let monthName = MONTH_NAMES[i];\n  return short ? monthName.slice(0, 3) : monthName;\n}\n\nfunction getLastDateInMonth(month, year) {\n  return new Date(year, month + 1, 0); // 0: last day in previous month\n} // mutates\n\n\nfunction setDayToSunday(date) {\n  let newDate = clone(date);\n  const day = newDate.getDay();\n\n  if (day !== 0) {\n    addDays(newDate, -1 * day);\n  }\n\n  return newDate;\n} // mutates\n\n\nfunction addDays(date, numberOfDays) {\n  date.setDate(date.getDate() + numberOfDays);\n}\n\nclass ChartComponent {\n  constructor({\n    layerClass = '',\n    layerTransform = '',\n    constants,\n    getData,\n    makeElements,\n    animateElements\n  }) {\n    this.layerTransform = layerTransform;\n    this.constants = constants;\n    this.makeElements = makeElements;\n    this.getData = getData;\n    this.animateElements = animateElements;\n    this.store = [];\n    this.labels = [];\n    this.layerClass = layerClass;\n    this.layerClass = typeof this.layerClass === 'function' ? this.layerClass() : this.layerClass;\n    this.refresh();\n  }\n\n  refresh(data) {\n    this.data = data || this.getData();\n  }\n\n  setup(parent) {\n    this.layer = makeSVGGroup(this.layerClass, this.layerTransform, parent);\n  }\n\n  make() {\n    this.render(this.data);\n    this.oldData = this.data;\n  }\n\n  render(data) {\n    this.store = this.makeElements(data);\n    this.layer.textContent = '';\n    this.store.forEach(element => {\n      this.layer.appendChild(element);\n    });\n    this.labels.forEach(element => {\n      this.layer.appendChild(element);\n    });\n  }\n\n  update(animate = true) {\n    this.refresh();\n    let animateElements = [];\n\n    if (animate) {\n      animateElements = this.animateElements(this.data) || [];\n    }\n\n    return animateElements;\n  }\n\n}\n\nlet componentConfigs = {\n  donutSlices: {\n    layerClass: 'donut-slices',\n\n    makeElements(data) {\n      return data.sliceStrings.map((s, i) => {\n        let slice = makePath(s, 'donut-path', data.colors[i], 'none', data.strokeWidth);\n        slice.style.transition = 'transform .3s;';\n        return slice;\n      });\n    },\n\n    animateElements(newData) {\n      return this.store.map((slice, i) => animatePathStr(slice, newData.sliceStrings[i]));\n    }\n\n  },\n  pieSlices: {\n    layerClass: 'pie-slices',\n\n    makeElements(data) {\n      return data.sliceStrings.map((s, i) => {\n        let slice = makePath(s, 'pie-path', 'none', data.colors[i]);\n        slice.style.transition = 'transform .3s;';\n        return slice;\n      });\n    },\n\n    animateElements(newData) {\n      return this.store.map((slice, i) => animatePathStr(slice, newData.sliceStrings[i]));\n    }\n\n  },\n  percentageBars: {\n    layerClass: 'percentage-bars',\n\n    makeElements(data) {\n      return data.xPositions.map((x, i) => {\n        let y = 0;\n        let bar = percentageBar(x, y, data.widths[i], this.constants.barHeight, this.constants.barDepth, data.colors[i]);\n        return bar;\n      });\n    },\n\n    animateElements(newData) {\n      if (newData) return [];\n    }\n\n  },\n  yAxis: {\n    layerClass: 'y axis',\n\n    makeElements(data) {\n      return data.positions.map((position, i) => yLine(position, data.labels[i], this.constants.width, {\n        mode: this.constants.mode,\n        pos: this.constants.pos,\n        shortenNumbers: this.constants.shortenNumbers\n      }));\n    },\n\n    animateElements(newData) {\n      let newPos = newData.positions;\n      let newLabels = newData.labels;\n      let oldPos = this.oldData.positions;\n      let oldLabels = this.oldData.labels;\n      [oldPos, newPos] = equilizeNoOfElements(oldPos, newPos);\n      [oldLabels, newLabels] = equilizeNoOfElements(oldLabels, newLabels);\n      this.render({\n        positions: oldPos,\n        labels: newLabels\n      });\n      return this.store.map((line, i) => {\n        return translateHoriLine(line, newPos[i], oldPos[i]);\n      });\n    }\n\n  },\n  xAxis: {\n    layerClass: 'x axis',\n\n    makeElements(data) {\n      return data.positions.map((position, i) => xLine(position, data.calcLabels[i], this.constants.height, {\n        mode: this.constants.mode,\n        pos: this.constants.pos\n      }));\n    },\n\n    animateElements(newData) {\n      let newPos = newData.positions;\n      let newLabels = newData.calcLabels;\n      let oldPos = this.oldData.positions;\n      let oldLabels = this.oldData.calcLabels;\n      [oldPos, newPos] = equilizeNoOfElements(oldPos, newPos);\n      [oldLabels, newLabels] = equilizeNoOfElements(oldLabels, newLabels);\n      this.render({\n        positions: oldPos,\n        calcLabels: newLabels\n      });\n      return this.store.map((line, i) => {\n        return translateVertLine(line, newPos[i], oldPos[i]);\n      });\n    }\n\n  },\n  yMarkers: {\n    layerClass: 'y-markers',\n\n    makeElements(data) {\n      return data.map(m => yMarker(m.position, m.label, this.constants.width, {\n        labelPos: m.options.labelPos,\n        mode: 'span',\n        lineType: 'dashed'\n      }));\n    },\n\n    animateElements(newData) {\n      [this.oldData, newData] = equilizeNoOfElements(this.oldData, newData);\n      let newPos = newData.map(d => d.position);\n      let newLabels = newData.map(d => d.label);\n      let newOptions = newData.map(d => d.options);\n      let oldPos = this.oldData.map(d => d.position);\n      this.render(oldPos.map((pos, i) => {\n        return {\n          position: oldPos[i],\n          label: newLabels[i],\n          options: newOptions[i]\n        };\n      }));\n      return this.store.map((line, i) => {\n        return translateHoriLine(line, newPos[i], oldPos[i]);\n      });\n    }\n\n  },\n  yRegions: {\n    layerClass: 'y-regions',\n\n    makeElements(data) {\n      return data.map(r => yRegion(r.startPos, r.endPos, this.constants.width, r.label, {\n        labelPos: r.options.labelPos\n      }));\n    },\n\n    animateElements(newData) {\n      [this.oldData, newData] = equilizeNoOfElements(this.oldData, newData);\n      let newPos = newData.map(d => d.endPos);\n      let newLabels = newData.map(d => d.label);\n      let newStarts = newData.map(d => d.startPos);\n      let newOptions = newData.map(d => d.options);\n      let oldPos = this.oldData.map(d => d.endPos);\n      let oldStarts = this.oldData.map(d => d.startPos);\n      this.render(oldPos.map((pos, i) => {\n        return {\n          startPos: oldStarts[i],\n          endPos: oldPos[i],\n          label: newLabels[i],\n          options: newOptions[i]\n        };\n      }));\n      let animateElements = [];\n      this.store.map((rectGroup, i) => {\n        animateElements = animateElements.concat(animateRegion(rectGroup, newStarts[i], newPos[i], oldPos[i]));\n      });\n      return animateElements;\n    }\n\n  },\n  heatDomain: {\n    layerClass: function () {\n      return 'heat-domain domain-' + this.constants.index;\n    },\n\n    makeElements(data) {\n      let {\n        index,\n        colWidth,\n        rowHeight,\n        squareSize,\n        radius,\n        xTranslate\n      } = this.constants;\n      let monthNameHeight = -12;\n      let x = xTranslate,\n          y = 0;\n      this.serializedSubDomains = [];\n      data.cols.map((week, weekNo) => {\n        if (weekNo === 1) {\n          this.labels.push(makeText('domain-name', x, monthNameHeight, getMonthName(index, true).toUpperCase(), {\n            fontSize: 9\n          }));\n        }\n\n        week.map((day, i) => {\n          if (day.fill) {\n            let data = {\n              'data-date': day.yyyyMmDd,\n              'data-value': day.dataValue,\n              'data-day': i\n            };\n            let square = heatSquare('day', x, y, squareSize, radius, day.fill, data);\n            this.serializedSubDomains.push(square);\n          }\n\n          y += rowHeight;\n        });\n        y = 0;\n        x += colWidth;\n      });\n      return this.serializedSubDomains;\n    },\n\n    animateElements(newData) {\n      if (newData) return [];\n    }\n\n  },\n  barGraph: {\n    layerClass: function () {\n      return 'dataset-units dataset-bars dataset-' + this.constants.index;\n    },\n\n    makeElements(data) {\n      let c = this.constants;\n      this.unitType = 'bar';\n      this.units = data.yPositions.map((y, j) => {\n        return datasetBar(data.xPositions[j], y, data.barWidth, c.color, data.labels[j], j, data.offsets[j], {\n          zeroLine: data.zeroLine,\n          barsWidth: data.barsWidth,\n          minHeight: c.minHeight\n        });\n      });\n      return this.units;\n    },\n\n    animateElements(newData) {\n      let newXPos = newData.xPositions;\n      let newYPos = newData.yPositions;\n      let newOffsets = newData.offsets;\n      let newLabels = newData.labels;\n      let oldXPos = this.oldData.xPositions;\n      let oldYPos = this.oldData.yPositions;\n      let oldOffsets = this.oldData.offsets;\n      let oldLabels = this.oldData.labels;\n      [oldXPos, newXPos] = equilizeNoOfElements(oldXPos, newXPos);\n      [oldYPos, newYPos] = equilizeNoOfElements(oldYPos, newYPos);\n      [oldOffsets, newOffsets] = equilizeNoOfElements(oldOffsets, newOffsets);\n      [oldLabels, newLabels] = equilizeNoOfElements(oldLabels, newLabels);\n      this.render({\n        xPositions: oldXPos,\n        yPositions: oldYPos,\n        offsets: oldOffsets,\n        labels: newLabels,\n        zeroLine: this.oldData.zeroLine,\n        barsWidth: this.oldData.barsWidth,\n        barWidth: this.oldData.barWidth\n      });\n      let animateElements = [];\n      this.store.map((bar, i) => {\n        animateElements = animateElements.concat(animateBar(bar, newXPos[i], newYPos[i], newData.barWidth, newOffsets[i], {\n          zeroLine: newData.zeroLine\n        }));\n      });\n      return animateElements;\n    }\n\n  },\n  lineGraph: {\n    layerClass: function () {\n      return 'dataset-units dataset-line dataset-' + this.constants.index;\n    },\n\n    makeElements(data) {\n      let c = this.constants;\n      this.unitType = 'dot';\n      this.paths = {};\n\n      if (!c.hideLine) {\n        this.paths = getPaths(data.xPositions, data.yPositions, c.color, {\n          heatline: c.heatline,\n          regionFill: c.regionFill,\n          spline: c.spline\n        }, {\n          svgDefs: c.svgDefs,\n          zeroLine: data.zeroLine\n        });\n      }\n\n      this.units = [];\n\n      if (!c.hideDots) {\n        this.units = data.yPositions.map((y, j) => {\n          return datasetDot(data.xPositions[j], y, data.radius, c.color, c.valuesOverPoints ? data.values[j] : '', j);\n        });\n      }\n\n      return Object.values(this.paths).concat(this.units);\n    },\n\n    animateElements(newData) {\n      let newXPos = newData.xPositions;\n      let newYPos = newData.yPositions;\n      let newValues = newData.values;\n      let oldXPos = this.oldData.xPositions;\n      let oldYPos = this.oldData.yPositions;\n      let oldValues = this.oldData.values;\n      [oldXPos, newXPos] = equilizeNoOfElements(oldXPos, newXPos);\n      [oldYPos, newYPos] = equilizeNoOfElements(oldYPos, newYPos);\n      [oldValues, newValues] = equilizeNoOfElements(oldValues, newValues);\n      this.render({\n        xPositions: oldXPos,\n        yPositions: oldYPos,\n        values: newValues,\n        zeroLine: this.oldData.zeroLine,\n        radius: this.oldData.radius\n      });\n      let animateElements = [];\n\n      if (Object.keys(this.paths).length) {\n        animateElements = animateElements.concat(animatePath(this.paths, newXPos, newYPos, newData.zeroLine, this.constants.spline));\n      }\n\n      if (this.units.length) {\n        this.units.map((dot, i) => {\n          animateElements = animateElements.concat(animateDot(dot, newXPos[i], newYPos[i]));\n        });\n      }\n\n      return animateElements;\n    }\n\n  }\n};\n\nfunction getComponent(name, constants, getData) {\n  let keys = Object.keys(componentConfigs).filter(k => name.includes(k));\n  let config = componentConfigs[keys[0]];\n  Object.assign(config, {\n    constants: constants,\n    getData: getData\n  });\n  return new ChartComponent(config);\n}\n\nclass PercentageChart extends AggregationChart {\n  constructor(parent, args) {\n    super(parent, args);\n    this.type = 'percentage';\n    this.setup();\n  }\n\n  setMeasures(options) {\n    let m = this.measures;\n    this.barOptions = options.barOptions || {};\n    let b = this.barOptions;\n    b.height = b.height || PERCENTAGE_BAR_DEFAULT_HEIGHT;\n    b.depth = b.depth || PERCENTAGE_BAR_DEFAULT_DEPTH;\n    m.paddings.right = 30;\n    m.legendHeight = 60;\n    m.baseHeight = (b.height + b.depth * 0.5) * 8;\n  }\n\n  setupComponents() {\n    let s = this.state;\n    let componentConfigs = [['percentageBars', {\n      barHeight: this.barOptions.height,\n      barDepth: this.barOptions.depth\n    }, function () {\n      return {\n        xPositions: s.xPositions,\n        widths: s.widths,\n        colors: this.colors\n      };\n    }.bind(this)]];\n    this.components = new Map(componentConfigs.map(args => {\n      let component = getComponent(...args);\n      return [args[0], component];\n    }));\n  }\n\n  calc() {\n    super.calc();\n    let s = this.state;\n    s.xPositions = [];\n    s.widths = [];\n    let xPos = 0;\n    s.sliceTotals.map(value => {\n      let width = this.width * value / s.grandTotal;\n      s.widths.push(width);\n      s.xPositions.push(xPos);\n      xPos += width;\n    });\n  }\n\n  makeDataByIndex() {}\n\n  bindTooltip() {\n    let s = this.state;\n    this.container.addEventListener('mousemove', e => {\n      let bars = this.components.get('percentageBars').store;\n      let bar = e.target;\n\n      if (bars.includes(bar)) {\n        let i = bars.indexOf(bar);\n        let gOff = getOffset(this.container),\n            pOff = getOffset(bar);\n        let x = pOff.left - gOff.left + parseInt(bar.getAttribute('width')) / 2;\n        let y = pOff.top - gOff.top;\n        let title = (this.formattedLabels && this.formattedLabels.length > 0 ? this.formattedLabels[i] : this.state.labels[i]) + ': ';\n        let fraction = s.sliceTotals[i] / s.grandTotal;\n        this.tip.setValues(x, y, {\n          name: title,\n          value: (fraction * 100).toFixed(1) + \"%\"\n        });\n        this.tip.showTip();\n      }\n    });\n  }\n\n}\n\nclass PieChart extends AggregationChart {\n  constructor(parent, args) {\n    super(parent, args);\n    this.type = 'pie';\n    this.initTimeout = 0;\n    this.init = 1;\n    this.setup();\n  }\n\n  configure(args) {\n    super.configure(args);\n    this.mouseMove = this.mouseMove.bind(this);\n    this.mouseLeave = this.mouseLeave.bind(this);\n    this.hoverRadio = args.hoverRadio || 0.1;\n    this.config.startAngle = args.startAngle || 0;\n    this.clockWise = args.clockWise || false;\n  }\n\n  calc() {\n    super.calc();\n    let s = this.state;\n    this.radius = this.height > this.width ? this.center.x : this.center.y;\n    const {\n      radius,\n      clockWise\n    } = this;\n    const prevSlicesProperties = s.slicesProperties || [];\n    s.sliceStrings = [];\n    s.slicesProperties = [];\n    let curAngle = 180 - this.config.startAngle;\n    s.sliceTotals.map((total, i) => {\n      const startAngle = curAngle;\n      const originDiffAngle = total / s.grandTotal * FULL_ANGLE;\n      const largeArc = originDiffAngle > 180 ? 1 : 0;\n      const diffAngle = clockWise ? -originDiffAngle : originDiffAngle;\n      const endAngle = curAngle = curAngle + diffAngle;\n      const startPosition = getPositionByAngle(startAngle, radius);\n      const endPosition = getPositionByAngle(endAngle, radius);\n      const prevProperty = this.init && prevSlicesProperties[i];\n      let curStart, curEnd;\n\n      if (this.init) {\n        curStart = prevProperty ? prevProperty.startPosition : startPosition;\n        curEnd = prevProperty ? prevProperty.endPosition : startPosition;\n      } else {\n        curStart = startPosition;\n        curEnd = endPosition;\n      }\n\n      const curPath = originDiffAngle === 360 ? makeCircleStr(curStart, curEnd, this.center, this.radius, clockWise, largeArc) : makeArcPathStr(curStart, curEnd, this.center, this.radius, clockWise, largeArc);\n      s.sliceStrings.push(curPath);\n      s.slicesProperties.push({\n        startPosition,\n        endPosition,\n        value: total,\n        total: s.grandTotal,\n        startAngle,\n        endAngle,\n        angle: diffAngle\n      });\n    });\n    this.init = 0;\n  }\n\n  setupComponents() {\n    let s = this.state;\n    let componentConfigs = [['pieSlices', {}, function () {\n      return {\n        sliceStrings: s.sliceStrings,\n        colors: this.colors\n      };\n    }.bind(this)]];\n    this.components = new Map(componentConfigs.map(args => {\n      let component = getComponent(...args);\n      return [args[0], component];\n    }));\n  }\n\n  calTranslateByAngle(property) {\n    const {\n      radius,\n      hoverRadio\n    } = this;\n    const position = getPositionByAngle(property.startAngle + property.angle / 2, radius);\n    return `translate3d(${position.x * hoverRadio}px,${position.y * hoverRadio}px,0)`;\n  }\n\n  hoverSlice(path, i, flag, e) {\n    if (!path) return;\n    const color = this.colors[i];\n\n    if (flag) {\n      transform(path, this.calTranslateByAngle(this.state.slicesProperties[i]));\n      path.style.fill = lightenDarkenColor(color, 50);\n      let g_off = getOffset(this.svg);\n      let x = e.pageX - g_off.left + 10;\n      let y = e.pageY - g_off.top - 10;\n      let title = (this.formatted_labels && this.formatted_labels.length > 0 ? this.formatted_labels[i] : this.state.labels[i]) + ': ';\n      let percent = (this.state.sliceTotals[i] * 100 / this.state.grandTotal).toFixed(1);\n      this.tip.setValues(x, y, {\n        name: title,\n        value: percent + \"%\"\n      });\n      this.tip.showTip();\n    } else {\n      transform(path, 'translate3d(0,0,0)');\n      this.tip.hideTip();\n      path.style.fill = color;\n    }\n  }\n\n  bindTooltip() {\n    this.container.addEventListener('mousemove', this.mouseMove);\n    this.container.addEventListener('mouseleave', this.mouseLeave);\n  }\n\n  mouseMove(e) {\n    const target = e.target;\n    let slices = this.components.get('pieSlices').store;\n    let prevIndex = this.curActiveSliceIndex;\n    let prevAcitve = this.curActiveSlice;\n\n    if (slices.includes(target)) {\n      let i = slices.indexOf(target);\n      this.hoverSlice(prevAcitve, prevIndex, false);\n      this.curActiveSlice = target;\n      this.curActiveSliceIndex = i;\n      this.hoverSlice(target, i, true, e);\n    } else {\n      this.mouseLeave();\n    }\n  }\n\n  mouseLeave() {\n    this.hoverSlice(this.curActiveSlice, this.curActiveSliceIndex, false);\n  }\n\n}\n\nfunction normalize(x) {\n  // Calculates mantissa and exponent of a number\n  // Returns normalized number and exponent\n  // https://stackoverflow.com/q/9383593/6495043\n  if (x === 0) {\n    return [0, 0];\n  }\n\n  if (isNaN(x)) {\n    return {\n      mantissa: -6755399441055744,\n      exponent: 972\n    };\n  }\n\n  var sig = x > 0 ? 1 : -1;\n\n  if (!isFinite(x)) {\n    return {\n      mantissa: sig * 4503599627370496,\n      exponent: 972\n    };\n  }\n\n  x = Math.abs(x);\n  var exp = Math.floor(Math.log10(x));\n  var man = x / Math.pow(10, exp);\n  return [sig * man, exp];\n}\n\nfunction getChartRangeIntervals(max, min = 0) {\n  let upperBound = Math.ceil(max);\n  let lowerBound = Math.floor(min);\n  let range = upperBound - lowerBound;\n  let noOfParts = range;\n  let partSize = 1; // To avoid too many partitions\n\n  if (range > 5) {\n    if (range % 2 !== 0) {\n      upperBound++; // Recalc range\n\n      range = upperBound - lowerBound;\n    }\n\n    noOfParts = range / 2;\n    partSize = 2;\n  } // Special case: 1 and 2\n\n\n  if (range <= 2) {\n    noOfParts = 4;\n    partSize = range / noOfParts;\n  } // Special case: 0\n\n\n  if (range === 0) {\n    noOfParts = 5;\n    partSize = 1;\n  }\n\n  let intervals = [];\n\n  for (var i = 0; i <= noOfParts; i++) {\n    intervals.push(lowerBound + partSize * i);\n  }\n\n  return intervals;\n}\n\nfunction getChartIntervals(maxValue, minValue = 0) {\n  let [normalMaxValue, exponent] = normalize(maxValue);\n  let normalMinValue = minValue ? minValue / Math.pow(10, exponent) : 0; // Allow only 7 significant digits\n\n  normalMaxValue = normalMaxValue.toFixed(6);\n  let intervals = getChartRangeIntervals(normalMaxValue, normalMinValue);\n  intervals = intervals.map(value => value * Math.pow(10, exponent));\n  return intervals;\n}\n\nfunction calcChartIntervals(values, withMinimum = false) {\n  //*** Where the magic happens ***\n  // Calculates best-fit y intervals from given values\n  // and returns the interval array\n  let maxValue = Math.max(...values);\n  let minValue = Math.min(...values); // Exponent to be used for pretty print\n\n  let exponent = 0,\n      intervals = []; // eslint-disable-line no-unused-vars\n\n  function getPositiveFirstIntervals(maxValue, absMinValue) {\n    let intervals = getChartIntervals(maxValue);\n    let intervalSize = intervals[1] - intervals[0]; // Then unshift the negative values\n\n    let value = 0;\n\n    for (var i = 1; value < absMinValue; i++) {\n      value += intervalSize;\n      intervals.unshift(-1 * value);\n    }\n\n    return intervals;\n  } // CASE I: Both non-negative\n\n\n  if (maxValue >= 0 && minValue >= 0) {\n    exponent = normalize(maxValue)[1];\n\n    if (!withMinimum) {\n      intervals = getChartIntervals(maxValue);\n    } else {\n      intervals = getChartIntervals(maxValue, minValue);\n    }\n  } // CASE II: Only minValue negative\n  else if (maxValue > 0 && minValue < 0) {\n      // `withMinimum` irrelevant in this case,\n      // We'll be handling both sides of zero separately\n      // (both starting from zero)\n      // Because ceil() and floor() behave differently\n      // in those two regions\n      let absMinValue = Math.abs(minValue);\n\n      if (maxValue >= absMinValue) {\n        exponent = normalize(maxValue)[1];\n        intervals = getPositiveFirstIntervals(maxValue, absMinValue);\n      } else {\n        // Mirror: maxValue => absMinValue, then change sign\n        exponent = normalize(absMinValue)[1];\n        let posIntervals = getPositiveFirstIntervals(absMinValue, maxValue);\n        intervals = posIntervals.map(d => d * -1);\n      }\n    } // CASE III: Both non-positive\n    else if (maxValue <= 0 && minValue <= 0) {\n        // Mirrored Case I:\n        // Work with positives, then reverse the sign and array\n        let pseudoMaxValue = Math.abs(minValue);\n        let pseudoMinValue = Math.abs(maxValue);\n        exponent = normalize(pseudoMaxValue)[1];\n\n        if (!withMinimum) {\n          intervals = getChartIntervals(pseudoMaxValue);\n        } else {\n          intervals = getChartIntervals(pseudoMaxValue, pseudoMinValue);\n        }\n\n        intervals = intervals.reverse().map(d => d * -1);\n      }\n\n  return intervals;\n}\n\nfunction getZeroIndex(yPts) {\n  let zeroIndex;\n  let interval = getIntervalSize(yPts);\n\n  if (yPts.indexOf(0) >= 0) {\n    // the range has a given zero\n    // zero-line on the chart\n    zeroIndex = yPts.indexOf(0);\n  } else if (yPts[0] > 0) {\n    // Minimum value is positive\n    // zero-line is off the chart: below\n    let min = yPts[0];\n    zeroIndex = -1 * min / interval;\n  } else {\n    // Maximum value is negative\n    // zero-line is off the chart: above\n    let max = yPts[yPts.length - 1];\n    zeroIndex = -1 * max / interval + (yPts.length - 1);\n  }\n\n  return zeroIndex;\n}\n\nfunction getIntervalSize(orderedArray) {\n  return orderedArray[1] - orderedArray[0];\n}\n\nfunction getValueRange(orderedArray) {\n  return orderedArray[orderedArray.length - 1] - orderedArray[0];\n}\n\nfunction scale(val, yAxis) {\n  return floatTwo(yAxis.zeroLine - val * yAxis.scaleMultiplier);\n}\n\nfunction getClosestInArray(goal, arr, index = false) {\n  let closest = arr.reduce(function (prev, curr) {\n    return Math.abs(curr - goal) < Math.abs(prev - goal) ? curr : prev;\n  }, []);\n  return index ? arr.indexOf(closest) : closest;\n}\n\nfunction calcDistribution(values, distributionSize) {\n  // Assume non-negative values,\n  // implying distribution minimum at zero\n  let dataMaxValue = Math.max(...values);\n  let distributionStep = 1 / (distributionSize - 1);\n  let distribution = [];\n\n  for (var i = 0; i < distributionSize; i++) {\n    let checkpoint = dataMaxValue * (distributionStep * i);\n    distribution.push(checkpoint);\n  }\n\n  return distribution;\n}\n\nfunction getMaxCheckpoint(value, distribution) {\n  return distribution.filter(d => d < value).length;\n}\n\nconst COL_WIDTH = HEATMAP_SQUARE_SIZE + HEATMAP_GUTTER_SIZE;\nconst ROW_HEIGHT = COL_WIDTH; // const DAY_INCR = 1;\n\nclass Heatmap extends BaseChart {\n  constructor(parent, options) {\n    super(parent, options);\n    this.type = 'heatmap';\n    this.countLabel = options.countLabel || '';\n    let validStarts = ['Sunday', 'Monday'];\n    let startSubDomain = validStarts.includes(options.startSubDomain) ? options.startSubDomain : 'Sunday';\n    this.startSubDomainIndex = validStarts.indexOf(startSubDomain);\n    this.setup();\n  }\n\n  setMeasures(options) {\n    let m = this.measures;\n    this.discreteDomains = options.discreteDomains === 0 ? 0 : 1;\n    m.paddings.top = ROW_HEIGHT * 3;\n    m.paddings.bottom = 0;\n    m.legendHeight = ROW_HEIGHT * 2;\n    m.baseHeight = ROW_HEIGHT * NO_OF_DAYS_IN_WEEK + getExtraHeight(m);\n    let d = this.data;\n    let spacing = this.discreteDomains ? NO_OF_YEAR_MONTHS : 0;\n    this.independentWidth = (getWeeksBetween(d.start, d.end) + spacing) * COL_WIDTH + getExtraWidth(m);\n  }\n\n  updateWidth() {\n    let spacing = this.discreteDomains ? NO_OF_YEAR_MONTHS : 0;\n    let noOfWeeks = this.state.noOfWeeks ? this.state.noOfWeeks : 52;\n    this.baseWidth = (noOfWeeks + spacing) * COL_WIDTH + getExtraWidth(this.measures);\n  }\n\n  prepareData(data = this.data) {\n    if (data.start && data.end && data.start > data.end) {\n      throw new Error('Start date cannot be greater than end date.');\n    }\n\n    if (!data.start) {\n      data.start = new Date();\n      data.start.setFullYear(data.start.getFullYear() - 1);\n    }\n\n    if (!data.end) {\n      data.end = new Date();\n    }\n\n    data.dataPoints = data.dataPoints || {};\n\n    if (parseInt(Object.keys(data.dataPoints)[0]) > 100000) {\n      let points = {};\n      Object.keys(data.dataPoints).forEach(timestampSec$$1 => {\n        let date = new Date(timestampSec$$1 * NO_OF_MILLIS);\n        points[getYyyyMmDd(date)] = data.dataPoints[timestampSec$$1];\n      });\n      data.dataPoints = points;\n    }\n\n    return data;\n  }\n\n  calc() {\n    let s = this.state;\n    s.start = clone(this.data.start);\n    s.end = clone(this.data.end);\n    s.firstWeekStart = clone(s.start);\n    s.noOfWeeks = getWeeksBetween(s.start, s.end);\n    s.distribution = calcDistribution(Object.values(this.data.dataPoints), HEATMAP_DISTRIBUTION_SIZE);\n    s.domainConfigs = this.getDomains();\n  }\n\n  setupComponents() {\n    let s = this.state;\n    let lessCol = this.discreteDomains ? 0 : 1;\n    let componentConfigs = s.domainConfigs.map((config, i) => ['heatDomain', {\n      index: config.index,\n      colWidth: COL_WIDTH,\n      rowHeight: ROW_HEIGHT,\n      squareSize: HEATMAP_SQUARE_SIZE,\n      radius: this.rawChartArgs.radius || 0,\n      xTranslate: s.domainConfigs.filter((config, j) => j < i).map(config => config.cols.length - lessCol).reduce((a, b) => a + b, 0) * COL_WIDTH\n    }, function () {\n      return s.domainConfigs[i];\n    }.bind(this)]);\n    this.components = new Map(componentConfigs.map((args, i) => {\n      let component = getComponent(...args);\n      return [args[0] + '-' + i, component];\n    }));\n    let y = 0;\n    DAY_NAMES_SHORT.forEach((dayName, i) => {\n      if ([1, 3, 5].includes(i)) {\n        let dayText = makeText('subdomain-name', -COL_WIDTH / 2, y, dayName, {\n          fontSize: HEATMAP_SQUARE_SIZE,\n          dy: 8,\n          textAnchor: 'end'\n        });\n        this.drawArea.appendChild(dayText);\n      }\n\n      y += ROW_HEIGHT;\n    });\n  }\n\n  update(data) {\n    if (!data) {\n      console.error('No data to update.');\n    }\n\n    this.data = this.prepareData(data);\n    this.draw();\n    this.bindTooltip();\n  }\n\n  bindTooltip() {\n    this.container.addEventListener('mousemove', e => {\n      this.components.forEach(comp => {\n        let daySquares = comp.store;\n        let daySquare = e.target;\n\n        if (daySquares.includes(daySquare)) {\n          let count = daySquare.getAttribute('data-value');\n          let dateParts = daySquare.getAttribute('data-date').split('-');\n          let month = getMonthName(parseInt(dateParts[1]) - 1, true);\n          let gOff = this.container.getBoundingClientRect(),\n              pOff = daySquare.getBoundingClientRect();\n          let width = parseInt(e.target.getAttribute('width'));\n          let x = pOff.left - gOff.left + width / 2;\n          let y = pOff.top - gOff.top;\n          let value = count + ' ' + this.countLabel;\n          let name = ' on ' + month + ' ' + dateParts[0] + ', ' + dateParts[2];\n          this.tip.setValues(x, y, {\n            name: name,\n            value: value,\n            valueFirst: 1\n          }, []);\n          this.tip.showTip();\n        }\n      });\n    });\n  }\n\n  renderLegend() {\n    this.legendArea.textContent = '';\n    let x = 0;\n    let y = ROW_HEIGHT;\n    let radius = this.rawChartArgs.radius || 0;\n    let lessText = makeText('subdomain-name', x, y, 'Less', {\n      fontSize: HEATMAP_SQUARE_SIZE + 1,\n      dy: 9\n    });\n    x = COL_WIDTH * 2 + COL_WIDTH / 2;\n    this.legendArea.appendChild(lessText);\n    this.colors.slice(0, HEATMAP_DISTRIBUTION_SIZE).map((color, i) => {\n      const square = heatSquare('heatmap-legend-unit', x + (COL_WIDTH + 3) * i, y, HEATMAP_SQUARE_SIZE, radius, color);\n      this.legendArea.appendChild(square);\n    });\n    let moreTextX = x + HEATMAP_DISTRIBUTION_SIZE * (COL_WIDTH + 3) + COL_WIDTH / 4;\n    let moreText = makeText('subdomain-name', moreTextX, y, 'More', {\n      fontSize: HEATMAP_SQUARE_SIZE + 1,\n      dy: 9\n    });\n    this.legendArea.appendChild(moreText);\n  }\n\n  getDomains() {\n    let s = this.state;\n    const [startMonth, startYear] = [s.start.getMonth(), s.start.getFullYear()];\n    const [endMonth, endYear] = [s.end.getMonth(), s.end.getFullYear()];\n    const noOfMonths = endMonth - startMonth + 1 + (endYear - startYear) * 12;\n    let domainConfigs = [];\n    let startOfMonth = clone(s.start);\n\n    for (var i = 0; i < noOfMonths; i++) {\n      let endDate = s.end;\n\n      if (!areInSameMonth(startOfMonth, s.end)) {\n        let [month, year] = [startOfMonth.getMonth(), startOfMonth.getFullYear()];\n        endDate = getLastDateInMonth(month, year);\n      }\n\n      domainConfigs.push(this.getDomainConfig(startOfMonth, endDate));\n      addDays(endDate, 1);\n      startOfMonth = endDate;\n    }\n\n    return domainConfigs;\n  }\n\n  getDomainConfig(startDate, endDate = '') {\n    let [month, year] = [startDate.getMonth(), startDate.getFullYear()];\n    let startOfWeek = setDayToSunday(startDate); // TODO: Monday as well\n\n    endDate = clone(endDate) || getLastDateInMonth(month, year);\n    let domainConfig = {\n      index: month,\n      cols: []\n    };\n    addDays(endDate, 1);\n    let noOfMonthWeeks = getWeeksBetween(startOfWeek, endDate);\n    let cols = [],\n        col;\n\n    for (var i = 0; i < noOfMonthWeeks; i++) {\n      col = this.getCol(startOfWeek, month);\n      cols.push(col);\n      startOfWeek = new Date(col[NO_OF_DAYS_IN_WEEK - 1].yyyyMmDd);\n      addDays(startOfWeek, 1);\n    }\n\n    if (col[NO_OF_DAYS_IN_WEEK - 1].dataValue !== undefined) {\n      addDays(startOfWeek, 1);\n      cols.push(this.getCol(startOfWeek, month, true));\n    }\n\n    domainConfig.cols = cols;\n    return domainConfig;\n  }\n\n  getCol(startDate, month, empty = false) {\n    let s = this.state; // startDate is the start of week\n\n    let currentDate = clone(startDate);\n    let col = [];\n\n    for (var i = 0; i < NO_OF_DAYS_IN_WEEK; i++, addDays(currentDate, 1)) {\n      let config = {}; // Non-generic adjustment for entire heatmap, needs state\n\n      let currentDateWithinData = currentDate >= s.start && currentDate <= s.end;\n\n      if (empty || currentDate.getMonth() !== month || !currentDateWithinData) {\n        config.yyyyMmDd = getYyyyMmDd(currentDate);\n      } else {\n        config = this.getSubDomainConfig(currentDate);\n      }\n\n      col.push(config);\n    }\n\n    return col;\n  }\n\n  getSubDomainConfig(date) {\n    let yyyyMmDd = getYyyyMmDd(date);\n    let dataValue = this.data.dataPoints[yyyyMmDd];\n    let config = {\n      yyyyMmDd: yyyyMmDd,\n      dataValue: dataValue || 0,\n      fill: this.colors[getMaxCheckpoint(dataValue, this.state.distribution)]\n    };\n    return config;\n  }\n\n}\n\nfunction dataPrep(data, type) {\n  data.labels = data.labels || [];\n  let datasetLength = data.labels.length; // Datasets\n\n  let datasets = data.datasets;\n  let zeroArray = new Array(datasetLength).fill(0);\n\n  if (!datasets) {\n    // default\n    datasets = [{\n      values: zeroArray\n    }];\n  }\n\n  datasets.map(d => {\n    // Set values\n    if (!d.values) {\n      d.values = zeroArray;\n    } else {\n      // Check for non values\n      let vals = d.values;\n      vals = vals.map(val => !isNaN(val) ? val : 0); // Trim or extend\n\n      if (vals.length > datasetLength) {\n        vals = vals.slice(0, datasetLength);\n      } else {\n        vals = fillArray(vals, datasetLength - vals.length, 0);\n      }\n    } // Set labels\n    //\n    // Set type\n\n\n    if (!d.chartType) {\n      if (!AXIS_DATASET_CHART_TYPES.includes(type)) type === DEFAULT_AXIS_CHART_TYPE;\n      d.chartType = type;\n    }\n  }); // Markers\n  // Regions\n  // data.yRegions = data.yRegions || [];\n\n  if (data.yRegions) {\n    data.yRegions.map(d => {\n      if (d.end < d.start) {\n        [d.start, d.end] = [d.end, d.start];\n      }\n    });\n  }\n\n  return data;\n}\n\nfunction zeroDataPrep(realData) {\n  let datasetLength = realData.labels.length;\n  let zeroArray = new Array(datasetLength).fill(0);\n  let zeroData = {\n    labels: realData.labels.slice(0, -1),\n    datasets: realData.datasets.map(d => {\n      return {\n        name: '',\n        values: zeroArray.slice(0, -1),\n        chartType: d.chartType\n      };\n    })\n  };\n\n  if (realData.yMarkers) {\n    zeroData.yMarkers = [{\n      value: 0,\n      label: ''\n    }];\n  }\n\n  if (realData.yRegions) {\n    zeroData.yRegions = [{\n      start: 0,\n      end: 0,\n      label: ''\n    }];\n  }\n\n  return zeroData;\n}\n\nfunction getShortenedLabels(chartWidth, labels = [], isSeries = true) {\n  let allowedSpace = chartWidth / labels.length;\n  if (allowedSpace <= 0) allowedSpace = 1;\n  let allowedLetters = allowedSpace / DEFAULT_CHAR_WIDTH;\n  let seriesMultiple;\n\n  if (isSeries) {\n    // Find the maximum label length for spacing calculations\n    let maxLabelLength = Math.max(...labels.map(label => label.length));\n    seriesMultiple = Math.ceil(maxLabelLength / allowedLetters);\n  }\n\n  let calcLabels = labels.map((label, i) => {\n    label += \"\";\n\n    if (label.length > allowedLetters) {\n      if (!isSeries) {\n        if (allowedLetters - 3 > 0) {\n          label = label.slice(0, allowedLetters - 3) + \" ...\";\n        } else {\n          label = label.slice(0, allowedLetters) + '..';\n        }\n      } else {\n        if (i % seriesMultiple !== 0) {\n          label = \"\";\n        }\n      }\n    }\n\n    return label;\n  });\n  return calcLabels;\n}\n\nclass AxisChart extends BaseChart {\n  constructor(parent, args) {\n    super(parent, args);\n    this.barOptions = args.barOptions || {};\n    this.lineOptions = args.lineOptions || {};\n    this.type = args.type || 'line';\n    this.init = 1;\n    this.setup();\n  }\n\n  setMeasures() {\n    if (this.data.datasets.length <= 1) {\n      this.config.showLegend = 0;\n      this.measures.paddings.bottom = 30;\n    }\n  }\n\n  configure(options) {\n    super.configure(options);\n    options.axisOptions = options.axisOptions || {};\n    options.tooltipOptions = options.tooltipOptions || {};\n    this.config.xAxisMode = options.axisOptions.xAxisMode || 'span';\n    this.config.yAxisMode = options.axisOptions.yAxisMode || 'span';\n    this.config.xIsSeries = options.axisOptions.xIsSeries || 0;\n    this.config.shortenYAxisNumbers = options.axisOptions.shortenYAxisNumbers || 0;\n    this.config.formatTooltipX = options.tooltipOptions.formatTooltipX;\n    this.config.formatTooltipY = options.tooltipOptions.formatTooltipY;\n    this.config.valuesOverPoints = options.valuesOverPoints;\n  }\n\n  prepareData(data = this.data) {\n    return dataPrep(data, this.type);\n  }\n\n  prepareFirstData(data = this.data) {\n    return zeroDataPrep(data);\n  }\n\n  calc(onlyWidthChange = false) {\n    this.calcXPositions();\n\n    if (!onlyWidthChange) {\n      this.calcYAxisParameters(this.getAllYValues(), this.type === 'line');\n    }\n\n    this.makeDataByIndex();\n  }\n\n  calcXPositions() {\n    let s = this.state;\n    let labels = this.data.labels;\n    s.datasetLength = labels.length;\n    s.unitWidth = this.width / s.datasetLength; // Default, as per bar, and mixed. Only line will be a special case\n\n    s.xOffset = s.unitWidth / 2; // // For a pure Line Chart\n    // s.unitWidth = this.width/(s.datasetLength - 1);\n    // s.xOffset = 0;\n\n    s.xAxis = {\n      labels: labels,\n      positions: labels.map((d, i) => floatTwo(s.xOffset + i * s.unitWidth))\n    };\n  }\n\n  calcYAxisParameters(dataValues, withMinimum = 'false') {\n    const yPts = calcChartIntervals(dataValues, withMinimum);\n    const scaleMultiplier = this.height / getValueRange(yPts);\n    const intervalHeight = getIntervalSize(yPts) * scaleMultiplier;\n    const zeroLine = this.height - getZeroIndex(yPts) * intervalHeight;\n    this.state.yAxis = {\n      labels: yPts,\n      positions: yPts.map(d => zeroLine - d * scaleMultiplier),\n      scaleMultiplier: scaleMultiplier,\n      zeroLine: zeroLine\n    }; // Dependent if above changes\n\n    this.calcDatasetPoints();\n    this.calcYExtremes();\n    this.calcYRegions();\n  }\n\n  calcDatasetPoints() {\n    let s = this.state;\n\n    let scaleAll = values => values.map(val => scale(val, s.yAxis));\n\n    s.datasets = this.data.datasets.map((d, i) => {\n      let values = d.values;\n      let cumulativeYs = d.cumulativeYs || [];\n      return {\n        name: d.name,\n        index: i,\n        chartType: d.chartType,\n        values: values,\n        yPositions: scaleAll(values),\n        cumulativeYs: cumulativeYs,\n        cumulativeYPos: scaleAll(cumulativeYs)\n      };\n    });\n  }\n\n  calcYExtremes() {\n    let s = this.state;\n\n    if (this.barOptions.stacked) {\n      s.yExtremes = s.datasets[s.datasets.length - 1].cumulativeYPos;\n      return;\n    }\n\n    s.yExtremes = new Array(s.datasetLength).fill(9999);\n    s.datasets.map(d => {\n      d.yPositions.map((pos, j) => {\n        if (pos < s.yExtremes[j]) {\n          s.yExtremes[j] = pos;\n        }\n      });\n    });\n  }\n\n  calcYRegions() {\n    let s = this.state;\n\n    if (this.data.yMarkers) {\n      this.state.yMarkers = this.data.yMarkers.map(d => {\n        d.position = scale(d.value, s.yAxis);\n        if (!d.options) d.options = {}; // if(!d.label.includes(':')) {\n        // \td.label += ': ' + d.value;\n        // }\n\n        return d;\n      });\n    }\n\n    if (this.data.yRegions) {\n      this.state.yRegions = this.data.yRegions.map(d => {\n        d.startPos = scale(d.start, s.yAxis);\n        d.endPos = scale(d.end, s.yAxis);\n        if (!d.options) d.options = {};\n        return d;\n      });\n    }\n  }\n\n  getAllYValues() {\n    let key = 'values';\n\n    if (this.barOptions.stacked) {\n      key = 'cumulativeYs';\n      let cumulative = new Array(this.state.datasetLength).fill(0);\n      this.data.datasets.map((d, i) => {\n        let values = this.data.datasets[i].values;\n        d[key] = cumulative = cumulative.map((c, i) => c + values[i]);\n      });\n    }\n\n    let allValueLists = this.data.datasets.map(d => d[key]);\n\n    if (this.data.yMarkers) {\n      allValueLists.push(this.data.yMarkers.map(d => d.value));\n    }\n\n    if (this.data.yRegions) {\n      this.data.yRegions.map(d => {\n        allValueLists.push([d.end, d.start]);\n      });\n    }\n\n    return [].concat(...allValueLists);\n  }\n\n  setupComponents() {\n    let componentConfigs = [['yAxis', {\n      mode: this.config.yAxisMode,\n      width: this.width,\n      shortenNumbers: this.config.shortenYAxisNumbers // pos: 'right'\n\n    }, function () {\n      return this.state.yAxis;\n    }.bind(this)], ['xAxis', {\n      mode: this.config.xAxisMode,\n      height: this.height // pos: 'right'\n\n    }, function () {\n      let s = this.state;\n      s.xAxis.calcLabels = getShortenedLabels(this.width, s.xAxis.labels, this.config.xIsSeries);\n      return s.xAxis;\n    }.bind(this)], ['yRegions', {\n      width: this.width,\n      pos: 'right'\n    }, function () {\n      return this.state.yRegions;\n    }.bind(this)]];\n    let barDatasets = this.state.datasets.filter(d => d.chartType === 'bar');\n    let lineDatasets = this.state.datasets.filter(d => d.chartType === 'line');\n    let barsConfigs = barDatasets.map(d => {\n      let index = d.index;\n      return ['barGraph' + '-' + d.index, {\n        index: index,\n        color: this.colors[index],\n        stacked: this.barOptions.stacked,\n        // same for all datasets\n        valuesOverPoints: this.config.valuesOverPoints,\n        minHeight: this.height * MIN_BAR_PERCENT_HEIGHT\n      }, function () {\n        let s = this.state;\n        let d = s.datasets[index];\n        let stacked = this.barOptions.stacked;\n        let spaceRatio = this.barOptions.spaceRatio || BAR_CHART_SPACE_RATIO;\n        let barsWidth = s.unitWidth * (1 - spaceRatio);\n        let barWidth = barsWidth / (stacked ? 1 : barDatasets.length);\n        let xPositions = s.xAxis.positions.map(x => x - barsWidth / 2);\n\n        if (!stacked) {\n          xPositions = xPositions.map(p => p + barWidth * index);\n        }\n\n        let labels = new Array(s.datasetLength).fill('');\n\n        if (this.config.valuesOverPoints) {\n          if (stacked && d.index === s.datasets.length - 1) {\n            labels = d.cumulativeYs;\n          } else {\n            labels = d.values;\n          }\n        }\n\n        let offsets = new Array(s.datasetLength).fill(0);\n\n        if (stacked) {\n          offsets = d.yPositions.map((y, j) => y - d.cumulativeYPos[j]);\n        }\n\n        return {\n          xPositions: xPositions,\n          yPositions: d.yPositions,\n          offsets: offsets,\n          // values: d.values,\n          labels: labels,\n          zeroLine: s.yAxis.zeroLine,\n          barsWidth: barsWidth,\n          barWidth: barWidth\n        };\n      }.bind(this)];\n    });\n    let lineConfigs = lineDatasets.map(d => {\n      let index = d.index;\n      return ['lineGraph' + '-' + d.index, {\n        index: index,\n        color: this.colors[index],\n        svgDefs: this.svgDefs,\n        heatline: this.lineOptions.heatline,\n        regionFill: this.lineOptions.regionFill,\n        spline: this.lineOptions.spline,\n        hideDots: this.lineOptions.hideDots,\n        hideLine: this.lineOptions.hideLine,\n        // same for all datasets\n        valuesOverPoints: this.config.valuesOverPoints\n      }, function () {\n        let s = this.state;\n        let d = s.datasets[index];\n        let minLine = s.yAxis.positions[0] < s.yAxis.zeroLine ? s.yAxis.positions[0] : s.yAxis.zeroLine;\n        return {\n          xPositions: s.xAxis.positions,\n          yPositions: d.yPositions,\n          values: d.values,\n          zeroLine: minLine,\n          radius: this.lineOptions.dotSize || LINE_CHART_DOT_SIZE\n        };\n      }.bind(this)];\n    });\n    let markerConfigs = [['yMarkers', {\n      width: this.width,\n      pos: 'right'\n    }, function () {\n      return this.state.yMarkers;\n    }.bind(this)]];\n    componentConfigs = componentConfigs.concat(barsConfigs, lineConfigs, markerConfigs);\n    let optionals = ['yMarkers', 'yRegions'];\n    this.dataUnitComponents = [];\n    this.components = new Map(componentConfigs.filter(args => !optionals.includes(args[0]) || this.state[args[0]]).map(args => {\n      let component = getComponent(...args);\n\n      if (args[0].includes('lineGraph') || args[0].includes('barGraph')) {\n        this.dataUnitComponents.push(component);\n      }\n\n      return [args[0], component];\n    }));\n  }\n\n  makeDataByIndex() {\n    this.dataByIndex = {};\n    let s = this.state;\n    let formatX = this.config.formatTooltipX;\n    let formatY = this.config.formatTooltipY;\n    let titles = s.xAxis.labels;\n    titles.map((label, index) => {\n      let values = this.state.datasets.map((set, i) => {\n        let value = set.values[index];\n        return {\n          title: set.name,\n          value: value,\n          yPos: set.yPositions[index],\n          color: this.colors[i],\n          formatted: formatY ? formatY(value) : value\n        };\n      });\n      this.dataByIndex[index] = {\n        label: label,\n        formattedLabel: formatX ? formatX(label) : label,\n        xPos: s.xAxis.positions[index],\n        values: values,\n        yExtreme: s.yExtremes[index]\n      };\n    });\n  }\n\n  bindTooltip() {\n    // NOTE: could be in tooltip itself, as it is a given functionality for its parent\n    this.container.addEventListener('mousemove', e => {\n      let m = this.measures;\n      let o = getOffset(this.container);\n      let relX = e.pageX - o.left - getLeftOffset(m);\n      let relY = e.pageY - o.top;\n\n      if (relY < this.height + getTopOffset(m) && relY > getTopOffset(m)) {\n        this.mapTooltipXPosition(relX);\n      } else {\n        this.tip.hideTip();\n      }\n    });\n  }\n\n  mapTooltipXPosition(relX) {\n    let s = this.state;\n    if (!s.yExtremes) return;\n    let index = getClosestInArray(relX, s.xAxis.positions, true);\n\n    if (index >= 0) {\n      let dbi = this.dataByIndex[index];\n      this.tip.setValues(dbi.xPos + this.tip.offset.x, dbi.yExtreme + this.tip.offset.y, {\n        name: dbi.formattedLabel,\n        value: ''\n      }, dbi.values, index);\n      this.tip.showTip();\n    }\n  }\n\n  renderLegend() {\n    let s = this.data;\n\n    if (s.datasets.length > 1) {\n      this.legendArea.textContent = '';\n      s.datasets.map((d, i) => {\n        let barWidth = AXIS_LEGEND_BAR_SIZE; // let rightEndPoint = this.baseWidth - this.measures.margins.left - this.measures.margins.right;\n        // let multiplier = s.datasets.length - i;\n\n        let rect = legendBar( // rightEndPoint - multiplier * barWidth,\t// To right align\n        barWidth * i, '0', barWidth, this.colors[i], d.name, this.config.truncateLegends);\n        this.legendArea.appendChild(rect);\n      });\n    }\n  } // Overlay\n\n\n  makeOverlay() {\n    if (this.init) {\n      this.init = 0;\n      return;\n    }\n\n    if (this.overlayGuides) {\n      this.overlayGuides.forEach(g => {\n        let o = g.overlay;\n        o.parentNode.removeChild(o);\n      });\n    }\n\n    this.overlayGuides = this.dataUnitComponents.map(c => {\n      return {\n        type: c.unitType,\n        overlay: undefined,\n        units: c.units\n      };\n    });\n\n    if (this.state.currentIndex === undefined) {\n      this.state.currentIndex = this.state.datasetLength - 1;\n    } // Render overlays\n\n\n    this.overlayGuides.map(d => {\n      let currentUnit = d.units[this.state.currentIndex];\n      d.overlay = makeOverlay[d.type](currentUnit);\n      this.drawArea.appendChild(d.overlay);\n    });\n  }\n\n  updateOverlayGuides() {\n    if (this.overlayGuides) {\n      this.overlayGuides.forEach(g => {\n        let o = g.overlay;\n        o.parentNode.removeChild(o);\n      });\n    }\n  }\n\n  bindOverlay() {\n    this.parent.addEventListener('data-select', () => {\n      this.updateOverlay();\n    });\n  }\n\n  bindUnits() {\n    this.dataUnitComponents.map(c => {\n      c.units.map(unit => {\n        unit.addEventListener('click', () => {\n          let index = unit.getAttribute('data-point-index');\n          this.setCurrentDataPoint(index);\n        });\n      });\n    }); // Note: Doesn't work as tooltip is absolutely positioned\n\n    this.tip.container.addEventListener('click', () => {\n      let index = this.tip.container.getAttribute('data-point-index');\n      this.setCurrentDataPoint(index);\n    });\n  }\n\n  updateOverlay() {\n    this.overlayGuides.map(d => {\n      let currentUnit = d.units[this.state.currentIndex];\n      updateOverlay[d.type](currentUnit, d.overlay);\n    });\n  }\n\n  onLeftArrow() {\n    this.setCurrentDataPoint(this.state.currentIndex - 1);\n  }\n\n  onRightArrow() {\n    this.setCurrentDataPoint(this.state.currentIndex + 1);\n  }\n\n  getDataPoint(index = this.state.currentIndex) {\n    let s = this.state;\n    let data_point = {\n      index: index,\n      label: s.xAxis.labels[index],\n      values: s.datasets.map(d => d.values[index])\n    };\n    return data_point;\n  }\n\n  setCurrentDataPoint(index) {\n    let s = this.state;\n    index = parseInt(index);\n    if (index < 0) index = 0;\n    if (index >= s.xAxis.labels.length) index = s.xAxis.labels.length - 1;\n    if (index === s.currentIndex) return;\n    s.currentIndex = index;\n    fire(this.parent, \"data-select\", this.getDataPoint());\n  } // API\n\n\n  addDataPoint(label, datasetValues, index = this.state.datasetLength) {\n    super.addDataPoint(label, datasetValues, index);\n    this.data.labels.splice(index, 0, label);\n    this.data.datasets.map((d, i) => {\n      d.values.splice(index, 0, datasetValues[i]);\n    });\n    this.update(this.data);\n  }\n\n  removeDataPoint(index = this.state.datasetLength - 1) {\n    if (this.data.labels.length <= 1) {\n      return;\n    }\n\n    super.removeDataPoint(index);\n    this.data.labels.splice(index, 1);\n    this.data.datasets.map(d => {\n      d.values.splice(index, 1);\n    });\n    this.update(this.data);\n  }\n\n  updateDataset(datasetValues, index = 0) {\n    this.data.datasets[index].values = datasetValues;\n    this.update(this.data);\n  } // addDataset(dataset, index) {}\n  // removeDataset(index = 0) {}\n\n\n  updateDatasets(datasets) {\n    this.data.datasets.map((d, i) => {\n      if (datasets[i]) {\n        d.values = datasets[i];\n      }\n    });\n    this.update(this.data);\n  } // updateDataPoint(dataPoint, index = 0) {}\n  // addDataPoint(dataPoint, index = 0) {}\n  // removeDataPoint(index = 0) {}\n\n\n}\n\nclass DonutChart extends AggregationChart {\n  constructor(parent, args) {\n    super(parent, args);\n    this.type = 'donut';\n    this.initTimeout = 0;\n    this.init = 1;\n    this.setup();\n  }\n\n  configure(args) {\n    super.configure(args);\n    this.mouseMove = this.mouseMove.bind(this);\n    this.mouseLeave = this.mouseLeave.bind(this);\n    this.hoverRadio = args.hoverRadio || 0.1;\n    this.config.startAngle = args.startAngle || 0;\n    this.clockWise = args.clockWise || false;\n    this.strokeWidth = args.strokeWidth || 30;\n  }\n\n  calc() {\n    super.calc();\n    let s = this.state;\n    this.radius = this.height > this.width ? this.center.x - this.strokeWidth / 2 : this.center.y - this.strokeWidth / 2;\n    const {\n      radius,\n      clockWise\n    } = this;\n    const prevSlicesProperties = s.slicesProperties || [];\n    s.sliceStrings = [];\n    s.slicesProperties = [];\n    let curAngle = 180 - this.config.startAngle;\n    s.sliceTotals.map((total, i) => {\n      const startAngle = curAngle;\n      const originDiffAngle = total / s.grandTotal * FULL_ANGLE;\n      const largeArc = originDiffAngle > 180 ? 1 : 0;\n      const diffAngle = clockWise ? -originDiffAngle : originDiffAngle;\n      const endAngle = curAngle = curAngle + diffAngle;\n      const startPosition = getPositionByAngle(startAngle, radius);\n      const endPosition = getPositionByAngle(endAngle, radius);\n      const prevProperty = this.init && prevSlicesProperties[i];\n      let curStart, curEnd;\n\n      if (this.init) {\n        curStart = prevProperty ? prevProperty.startPosition : startPosition;\n        curEnd = prevProperty ? prevProperty.endPosition : startPosition;\n      } else {\n        curStart = startPosition;\n        curEnd = endPosition;\n      }\n\n      const curPath = originDiffAngle === 360 ? makeStrokeCircleStr(curStart, curEnd, this.center, this.radius, this.clockWise, largeArc) : makeArcStrokePathStr(curStart, curEnd, this.center, this.radius, this.clockWise, largeArc);\n      s.sliceStrings.push(curPath);\n      s.slicesProperties.push({\n        startPosition,\n        endPosition,\n        value: total,\n        total: s.grandTotal,\n        startAngle,\n        endAngle,\n        angle: diffAngle\n      });\n    });\n    this.init = 0;\n  }\n\n  setupComponents() {\n    let s = this.state;\n    let componentConfigs = [['donutSlices', {}, function () {\n      return {\n        sliceStrings: s.sliceStrings,\n        colors: this.colors,\n        strokeWidth: this.strokeWidth\n      };\n    }.bind(this)]];\n    this.components = new Map(componentConfigs.map(args => {\n      let component = getComponent(...args);\n      return [args[0], component];\n    }));\n  }\n\n  calTranslateByAngle(property) {\n    const {\n      radius,\n      hoverRadio\n    } = this;\n    const position = getPositionByAngle(property.startAngle + property.angle / 2, radius);\n    return `translate3d(${position.x * hoverRadio}px,${position.y * hoverRadio}px,0)`;\n  }\n\n  hoverSlice(path, i, flag, e) {\n    if (!path) return;\n    const color = this.colors[i];\n\n    if (flag) {\n      transform(path, this.calTranslateByAngle(this.state.slicesProperties[i]));\n      path.style.stroke = lightenDarkenColor(color, 50);\n      let g_off = getOffset(this.svg);\n      let x = e.pageX - g_off.left + 10;\n      let y = e.pageY - g_off.top - 10;\n      let title = (this.formatted_labels && this.formatted_labels.length > 0 ? this.formatted_labels[i] : this.state.labels[i]) + ': ';\n      let percent = (this.state.sliceTotals[i] * 100 / this.state.grandTotal).toFixed(1);\n      this.tip.setValues(x, y, {\n        name: title,\n        value: percent + \"%\"\n      });\n      this.tip.showTip();\n    } else {\n      transform(path, 'translate3d(0,0,0)');\n      this.tip.hideTip();\n      path.style.stroke = color;\n    }\n  }\n\n  bindTooltip() {\n    this.container.addEventListener('mousemove', this.mouseMove);\n    this.container.addEventListener('mouseleave', this.mouseLeave);\n  }\n\n  mouseMove(e) {\n    const target = e.target;\n    let slices = this.components.get('donutSlices').store;\n    let prevIndex = this.curActiveSliceIndex;\n    let prevAcitve = this.curActiveSlice;\n\n    if (slices.includes(target)) {\n      let i = slices.indexOf(target);\n      this.hoverSlice(prevAcitve, prevIndex, false);\n      this.curActiveSlice = target;\n      this.curActiveSliceIndex = i;\n      this.hoverSlice(target, i, true, e);\n    } else {\n      this.mouseLeave();\n    }\n  }\n\n  mouseLeave() {\n    this.hoverSlice(this.curActiveSlice, this.curActiveSliceIndex, false);\n  }\n\n} // import MultiAxisChart from './charts/MultiAxisChart';\n\n\nconst chartTypes = {\n  bar: AxisChart,\n  line: AxisChart,\n  // multiaxis: MultiAxisChart,\n  percentage: PercentageChart,\n  heatmap: Heatmap,\n  pie: PieChart,\n  donut: DonutChart\n};\n\nfunction getChartByType(chartType = 'line', parent, options) {\n  if (chartType === 'axis-mixed') {\n    options.type = 'line';\n    return new AxisChart(parent, options);\n  }\n\n  if (!chartTypes[chartType]) {\n    console.error(\"Undefined chart type: \" + chartType);\n    return;\n  }\n\n  return new chartTypes[chartType](parent, options);\n}\n\nclass Chart {\n  constructor(parent, options) {\n    return getChartByType(options.type, parent, options);\n  }\n\n}\n\nexport { Chart, PercentageChart, PieChart, Heatmap, AxisChart };","map":{"version":3,"sources":["/Users/Goon/Desktop/eighth/app/node_modules/frappe-charts/dist/frappe-charts.esm.js"],"names":["$","expr","con","document","querySelector","create","tag","o","element","createElement","i","val","appendChild","ref","parentNode","insertBefore","Object","keys","map","prop","style","setAttribute","getOffset","rect","getBoundingClientRect","top","documentElement","scrollTop","body","left","scrollLeft","isHidden","el","offsetParent","isElementInViewport","bottom","window","innerHeight","clientHeight","right","innerWidth","clientWidth","getElementContentWidth","styles","getComputedStyle","padding","parseFloat","paddingLeft","paddingRight","fire","target","type","properties","evt","createEvent","initEvent","j","dispatchEvent","BASE_MEASURES","margins","paddings","baseHeight","titleHeight","legendHeight","titleFontSize","getTopOffset","m","getLeftOffset","getExtraHeight","totalExtraHeight","getExtraWidth","totalExtraWidth","INIT_CHART_UPDATE_TIMEOUT","CHART_POST_ANIMATE_TIMEOUT","DEFAULT_AXIS_CHART_TYPE","AXIS_DATASET_CHART_TYPES","AXIS_LEGEND_BAR_SIZE","BAR_CHART_SPACE_RATIO","MIN_BAR_PERCENT_HEIGHT","LINE_CHART_DOT_SIZE","DOT_OVERLAY_SIZE_INCR","PERCENTAGE_BAR_DEFAULT_HEIGHT","PERCENTAGE_BAR_DEFAULT_DEPTH","HEATMAP_DISTRIBUTION_SIZE","HEATMAP_SQUARE_SIZE","HEATMAP_GUTTER_SIZE","DEFAULT_CHAR_WIDTH","TOOLTIP_POINTER_TRIANGLE_HEIGHT","DEFAULT_CHART_COLORS","HEATMAP_COLORS_GREEN","DEFAULT_COLORS","bar","line","pie","percentage","heatmap","donut","ANGLE_RATIO","Math","PI","FULL_ANGLE","SvgTip","constructor","parent","colors","titleName","titleValue","listValues","titleValueFirst","x","y","setup","makeTooltip","refresh","fill","calcPosition","container","inside","className","innerHTML","hideTip","title","dataPointList","addEventListener","index","set","color","value","formatted","li","width","offsetWidth","offsetHeight","maxLeft","pointer","delta","pointerOffset","setValues","name","valueFirst","opacity","showTip","floatTwo","d","toFixed","fillArray","array","count","start","length","fillerArray","Array","abs","concat","getStringWidth","string","charWidth","getPositionByAngle","angle","radius","sin","cos","isValidNumber","candidate","nonNegative","Number","isNaN","undefined","isFinite","getBarHeightAndYAttr","yTop","zeroLine","height","equilizeNoOfElements","array1","array2","extraCount","truncateString","txt","len","slice","shortenLargeNumber","label","number","p","floor","log10","l","shortened","pow","round","getSplineCurvePointsStr","xList","yList","points","push","smoothing","pointA","pointB","lengthX","lengthY","sqrt","atan2","controlPoint","current","previous","next","reverse","n","bezierCommand","point","a","cps","cpe","pointStr","command","reduce","acc","PRESET_COLOR_MAP","limitColor","r","lightenDarkenColor","amt","col","getColor","usePound","num","parseInt","b","g","toString","isValidColor","HEX_RE","RGB_RE","test","AXIS_TICK_LENGTH","LABEL_MARGIN","LABEL_MAX_CHARS","FONT_SIZE","BASE_LINE_COLOR","FONT_FILL","$$1","createSVG","createElementNS","renderVerticalGradient","svgDefElem","gradientId","id","x1","x2","y1","y2","setGradientStop","gradElem","offset","makeSVGContainer","makeSVGDefs","svgContainer","makeSVGGroup","transform","args","makePath","pathStr","stroke","strokeWidth","makeArcPathStr","startPosition","endPosition","center","clockWise","largeArc","arcStartX","arcStartY","arcEndX","arcEndY","makeCircleStr","midArc","makeArcStrokePathStr","makeStrokeCircleStr","makeGradient","lighter","gradientDef","opacities","percentageBar","depth","heatSquare","size","data","rx","key","legendBar","truncate","text","dy","group","legendDot","cx","cy","dx","makeText","content","options","fontSize","textAnchor","makeVertLine","makeHoriLine","lineType","shortenNumbers","yLine","pos","mode","xLine","yMarker","labelPos","labelSvg","yRegion","region","datasetBar","meta","minHeight","datasetDot","dot","getPaths","pointsList","pointsStr","join","spline","path","heatline","gradient_id","svgDefs","paths","regionFill","gradient_id_region","makeOverlay","unit","transformValue","nodeName","getAttribute","childNodes","overlay","cloneNode","updateOverlay","attributes","values","filter","attr","includes","specified","nodeValue","UNIT_ANIM_DUR","PATH_ANIM_DUR","MARKER_LINE_ANIM_DUR","REPLACE_ALL_NEW_DUR","STD_EASING","translate","oldCoord","newCoord","duration","old","translateVertLine","newX","oldX","translateHoriLine","newY","oldY","animateRegion","rectGroup","newY1","newY2","oldY2","newHeight","rectAnim","groupAnim","animateBar","oldCoordStr","split","animateDot","animatePath","newXList","newYList","pathComponents","animPath","regStartPt","regEndPt","animRegion","animatePathStr","oldPath","EASING","ease","linear","easein","easeout","easeinout","animateSVGElement","props","dur","easingType","oldValues","animElement","newElement","attributeName","animateElement","currentValue","animAttr","from","to","begin","keySplines","keyTimes","calcMode","webkitTransform","msTransform","mozTransform","oTransform","animateSVG","elements","newElements","animElements","replaceChild","animSvg","runSMILAnimation","svgElement","elementsToAnimate","animSvgElement","removeChild","setTimeout","CSSTEXT","downloadFile","filename","blob","Blob","url","URL","createObjectURL","href","download","click","revokeObjectURL","prepareForExport","svg","clone","classList","add","styleEl","firstChild","BaseChart","HTMLElement","Error","rawChartArgs","realData","prepareData","prepareFirstData","validateColors","config","showTooltip","showLegend","isNavigable","animate","truncateLegends","measures","JSON","parse","stringify","setMeasures","argHeight","state","initTimeout","overlays","configure","validColors","forEach","console","warn","boundDrawFn","draw","destroy","removeEventListener","makeContainer","updateWidth","independentWidth","tip","bindTooltip","onlyWidthChange","init","calc","makeChartArea","setupComponents","components","c","drawArea","render","update","renderLegend","setupNavigation","baseWidth","titleEL","legendArea","updateTipOffset","Map","error","make","updateNav","bindUnits","bindOverlay","keyActions","onEnterKey","bind","onLeftArrow","onUpArrow","onRightArrow","onDownArrow","e","event","keyCode","addDataPoint","removeDataPoint","getDataPoint","setCurrentDataPoint","updateDataset","export","chartSvg","AggregationChart","maxSlices","maxLegendPoints","s","sliceTotals","allTotals","labels","total","datasets","totals","sort","remaining","sumOfRemaining","grandTotal","textContent","legendTotals","barWidth","divisor","NO_OF_YEAR_MONTHS","NO_OF_DAYS_IN_WEEK","NO_OF_MILLIS","SEC_IN_DAY","MONTH_NAMES","DAY_NAMES_SHORT","treatAsUtc","date","result","Date","setMinutes","getMinutes","getTimezoneOffset","getYyyyMmDd","dd","getDate","mm","getMonth","getFullYear","getTime","getWeeksBetween","startDate","endDate","weekStartDate","setDayToSunday","ceil","getDaysBetween","millisecondsPerDay","areInSameMonth","getMonthName","short","monthName","getLastDateInMonth","month","year","newDate","day","getDay","addDays","numberOfDays","setDate","ChartComponent","layerClass","layerTransform","constants","getData","makeElements","animateElements","store","layer","oldData","componentConfigs","donutSlices","sliceStrings","transition","newData","pieSlices","percentageBars","xPositions","widths","barHeight","barDepth","yAxis","positions","position","newPos","newLabels","oldPos","oldLabels","xAxis","calcLabels","yMarkers","newOptions","yRegions","startPos","endPos","newStarts","oldStarts","heatDomain","colWidth","rowHeight","squareSize","xTranslate","monthNameHeight","serializedSubDomains","cols","week","weekNo","toUpperCase","yyyyMmDd","dataValue","square","barGraph","unitType","units","yPositions","offsets","barsWidth","newXPos","newYPos","newOffsets","oldXPos","oldYPos","oldOffsets","lineGraph","hideLine","hideDots","valuesOverPoints","newValues","getComponent","k","assign","PercentageChart","barOptions","component","xPos","makeDataByIndex","bars","get","indexOf","gOff","pOff","formattedLabels","fraction","PieChart","mouseMove","mouseLeave","hoverRadio","startAngle","prevSlicesProperties","slicesProperties","curAngle","originDiffAngle","diffAngle","endAngle","prevProperty","curStart","curEnd","curPath","calTranslateByAngle","property","hoverSlice","flag","g_off","pageX","pageY","formatted_labels","percent","slices","prevIndex","curActiveSliceIndex","prevAcitve","curActiveSlice","normalize","mantissa","exponent","sig","exp","man","getChartRangeIntervals","max","min","upperBound","lowerBound","range","noOfParts","partSize","intervals","getChartIntervals","maxValue","minValue","normalMaxValue","normalMinValue","calcChartIntervals","withMinimum","getPositiveFirstIntervals","absMinValue","intervalSize","unshift","posIntervals","pseudoMaxValue","pseudoMinValue","getZeroIndex","yPts","zeroIndex","interval","getIntervalSize","orderedArray","getValueRange","scale","scaleMultiplier","getClosestInArray","goal","arr","closest","prev","curr","calcDistribution","distributionSize","dataMaxValue","distributionStep","distribution","checkpoint","getMaxCheckpoint","COL_WIDTH","ROW_HEIGHT","Heatmap","countLabel","validStarts","startSubDomain","startSubDomainIndex","discreteDomains","spacing","end","noOfWeeks","setFullYear","dataPoints","timestampSec$$1","firstWeekStart","domainConfigs","getDomains","lessCol","dayName","dayText","comp","daySquares","daySquare","dateParts","lessText","moreTextX","moreText","startMonth","startYear","endMonth","endYear","noOfMonths","startOfMonth","getDomainConfig","startOfWeek","domainConfig","noOfMonthWeeks","getCol","empty","currentDate","currentDateWithinData","getSubDomainConfig","dataPrep","datasetLength","zeroArray","vals","chartType","zeroDataPrep","zeroData","getShortenedLabels","chartWidth","isSeries","allowedSpace","allowedLetters","seriesMultiple","maxLabelLength","AxisChart","lineOptions","axisOptions","tooltipOptions","xAxisMode","yAxisMode","xIsSeries","shortenYAxisNumbers","formatTooltipX","formatTooltipY","calcXPositions","calcYAxisParameters","getAllYValues","unitWidth","xOffset","dataValues","intervalHeight","calcDatasetPoints","calcYExtremes","calcYRegions","scaleAll","cumulativeYs","cumulativeYPos","stacked","yExtremes","cumulative","allValueLists","barDatasets","lineDatasets","barsConfigs","spaceRatio","lineConfigs","minLine","dotSize","markerConfigs","optionals","dataUnitComponents","dataByIndex","formatX","formatY","titles","yPos","formattedLabel","yExtreme","relX","relY","mapTooltipXPosition","dbi","overlayGuides","currentIndex","currentUnit","updateOverlayGuides","data_point","datasetValues","splice","updateDatasets","DonutChart","chartTypes","getChartByType","Chart"],"mappings":"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","sourcesContent":["function $(expr, con) {\n\treturn typeof expr === \"string\"? (con || document).querySelector(expr) : expr || null;\n}\n\n\n\n$.create = (tag, o) => {\n\tvar element = document.createElement(tag);\n\n\tfor (var i in o) {\n\t\tvar val = o[i];\n\n\t\tif (i === \"inside\") {\n\t\t\t$(val).appendChild(element);\n\t\t}\n\t\telse if (i === \"around\") {\n\t\t\tvar ref = $(val);\n\t\t\tref.parentNode.insertBefore(element, ref);\n\t\t\telement.appendChild(ref);\n\n\t\t} else if (i === \"styles\") {\n\t\t\tif(typeof val === \"object\") {\n\t\t\t\tObject.keys(val).map(prop => {\n\t\t\t\t\telement.style[prop] = val[prop];\n\t\t\t\t});\n\t\t\t}\n\t\t} else if (i in element ) {\n\t\t\telement[i] = val;\n\t\t}\n\t\telse {\n\t\t\telement.setAttribute(i, val);\n\t\t}\n\t}\n\n\treturn element;\n};\n\nfunction getOffset(element) {\n\tlet rect = element.getBoundingClientRect();\n\treturn {\n\t\t// https://stackoverflow.com/a/7436602/6495043\n\t\t// rect.top varies with scroll, so we add whatever has been\n\t\t// scrolled to it to get absolute distance from actual page top\n\t\ttop: rect.top + (document.documentElement.scrollTop || document.body.scrollTop),\n\t\tleft: rect.left + (document.documentElement.scrollLeft || document.body.scrollLeft)\n\t};\n}\n\n// https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetParent\n// an element's offsetParent property will return null whenever it, or any of its parents,\n// is hidden via the display style property.\nfunction isHidden(el) {\n\treturn (el.offsetParent === null);\n}\n\nfunction isElementInViewport(el) {\n\t// Although straightforward: https://stackoverflow.com/a/7557433/6495043\n\tvar rect = el.getBoundingClientRect();\n\n\treturn (\n\t\trect.top >= 0 &&\n        rect.left >= 0 &&\n        rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) && /*or $(window).height() */\n        rect.right <= (window.innerWidth || document.documentElement.clientWidth) /*or $(window).width() */\n\t);\n}\n\nfunction getElementContentWidth(element) {\n\tvar styles = window.getComputedStyle(element);\n\tvar padding = parseFloat(styles.paddingLeft) +\n\t\tparseFloat(styles.paddingRight);\n\n\treturn element.clientWidth - padding;\n}\n\n\n\n\n\nfunction fire(target, type, properties) {\n\tvar evt = document.createEvent(\"HTMLEvents\");\n\n\tevt.initEvent(type, true, true );\n\n\tfor (var j in properties) {\n\t\tevt[j] = properties[j];\n\t}\n\n\treturn target.dispatchEvent(evt);\n}\n\n// https://css-tricks.com/snippets/javascript/loop-queryselectorall-matches/\n\nconst BASE_MEASURES = {\n\tmargins: {\n\t\ttop: 10,\n\t\tbottom: 10,\n\t\tleft: 20,\n\t\tright: 20\n\t},\n\tpaddings: {\n\t\ttop: 20,\n\t\tbottom: 40,\n\t\tleft: 30,\n\t\tright: 10\n\t},\n\n\tbaseHeight: 240,\n\ttitleHeight: 20,\n\tlegendHeight: 30,\n\n\ttitleFontSize: 12,\n};\n\nfunction getTopOffset(m) {\n\treturn m.titleHeight + m.margins.top + m.paddings.top;\n}\n\nfunction getLeftOffset(m) {\n\treturn m.margins.left + m.paddings.left;\n}\n\nfunction getExtraHeight(m) {\n\tlet totalExtraHeight = m.margins.top + m.margins.bottom\n\t\t+ m.paddings.top + m.paddings.bottom\n\t\t+ m.titleHeight + m.legendHeight;\n\treturn totalExtraHeight;\n}\n\nfunction getExtraWidth(m) {\n\tlet totalExtraWidth = m.margins.left + m.margins.right\n\t\t+ m.paddings.left + m.paddings.right;\n\n\treturn totalExtraWidth;\n}\n\nconst INIT_CHART_UPDATE_TIMEOUT = 700;\nconst CHART_POST_ANIMATE_TIMEOUT = 400;\n\nconst DEFAULT_AXIS_CHART_TYPE = 'line';\nconst AXIS_DATASET_CHART_TYPES = ['line', 'bar'];\n\nconst AXIS_LEGEND_BAR_SIZE = 100;\n\nconst BAR_CHART_SPACE_RATIO = 0.5;\nconst MIN_BAR_PERCENT_HEIGHT = 0.00;\n\nconst LINE_CHART_DOT_SIZE = 4;\nconst DOT_OVERLAY_SIZE_INCR = 4;\n\nconst PERCENTAGE_BAR_DEFAULT_HEIGHT = 20;\nconst PERCENTAGE_BAR_DEFAULT_DEPTH = 2;\n\n// Fixed 5-color theme,\n// More colors are difficult to parse visually\nconst HEATMAP_DISTRIBUTION_SIZE = 5;\n\nconst HEATMAP_SQUARE_SIZE = 10;\nconst HEATMAP_GUTTER_SIZE = 2;\n\nconst DEFAULT_CHAR_WIDTH = 7;\n\nconst TOOLTIP_POINTER_TRIANGLE_HEIGHT = 5;\n\nconst DEFAULT_CHART_COLORS = ['light-blue', 'blue', 'violet', 'red', 'orange',\n\t'yellow', 'green', 'light-green', 'purple', 'magenta', 'light-grey', 'dark-grey'];\nconst HEATMAP_COLORS_GREEN = ['#ebedf0', '#c6e48b', '#7bc96f', '#239a3b', '#196127'];\n\n\n\nconst DEFAULT_COLORS = {\n\tbar: DEFAULT_CHART_COLORS,\n\tline: DEFAULT_CHART_COLORS,\n\tpie: DEFAULT_CHART_COLORS,\n\tpercentage: DEFAULT_CHART_COLORS,\n\theatmap: HEATMAP_COLORS_GREEN,\n\tdonut: DEFAULT_CHART_COLORS\n};\n\n// Universal constants\nconst ANGLE_RATIO = Math.PI / 180;\nconst FULL_ANGLE = 360;\n\nclass SvgTip {\n\tconstructor({\n\t\tparent = null,\n\t\tcolors = []\n\t}) {\n\t\tthis.parent = parent;\n\t\tthis.colors = colors;\n\t\tthis.titleName = '';\n\t\tthis.titleValue = '';\n\t\tthis.listValues = [];\n\t\tthis.titleValueFirst = 0;\n\n\t\tthis.x = 0;\n\t\tthis.y = 0;\n\n\t\tthis.top = 0;\n\t\tthis.left = 0;\n\n\t\tthis.setup();\n\t}\n\n\tsetup() {\n\t\tthis.makeTooltip();\n\t}\n\n\trefresh() {\n\t\tthis.fill();\n\t\tthis.calcPosition();\n\t}\n\n\tmakeTooltip() {\n\t\tthis.container = $.create('div', {\n\t\t\tinside: this.parent,\n\t\t\tclassName: 'graph-svg-tip comparison',\n\t\t\tinnerHTML: `<span class=\"title\"></span>\n\t\t\t\t<ul class=\"data-point-list\"></ul>\n\t\t\t\t<div class=\"svg-pointer\"></div>`\n\t\t});\n\t\tthis.hideTip();\n\n\t\tthis.title = this.container.querySelector('.title');\n\t\tthis.dataPointList = this.container.querySelector('.data-point-list');\n\n\t\tthis.parent.addEventListener('mouseleave', () => {\n\t\t\tthis.hideTip();\n\t\t});\n\t}\n\n\tfill() {\n\t\tlet title;\n\t\tif(this.index) {\n\t\t\tthis.container.setAttribute('data-point-index', this.index);\n\t\t}\n\t\tif(this.titleValueFirst) {\n\t\t\ttitle = `<strong>${this.titleValue}</strong>${this.titleName}`;\n\t\t} else {\n\t\t\ttitle = `${this.titleName}<strong>${this.titleValue}</strong>`;\n\t\t}\n\t\tthis.title.innerHTML = title;\n\t\tthis.dataPointList.innerHTML = '';\n\n\t\tthis.listValues.map((set, i) => {\n\t\t\tconst color = this.colors[i] || 'black';\n\t\t\tlet value = set.formatted === 0 || set.formatted ? set.formatted : set.value;\n\n\t\t\tlet li = $.create('li', {\n\t\t\t\tstyles: {\n\t\t\t\t\t'border-top': `3px solid ${color}`\n\t\t\t\t},\n\t\t\t\tinnerHTML: `<strong style=\"display: block;\">${ value === 0 || value ? value : '' }</strong>\n\t\t\t\t\t${set.title ? set.title : '' }`\n\t\t\t});\n\n\t\t\tthis.dataPointList.appendChild(li);\n\t\t});\n\t}\n\n\tcalcPosition() {\n\t\tlet width = this.container.offsetWidth;\n\n\t\tthis.top = this.y - this.container.offsetHeight\n\t\t\t- TOOLTIP_POINTER_TRIANGLE_HEIGHT;\n\t\tthis.left = this.x - width/2;\n\t\tlet maxLeft = this.parent.offsetWidth - width;\n\n\t\tlet pointer = this.container.querySelector('.svg-pointer');\n\n\t\tif(this.left < 0) {\n\t\t\tpointer.style.left = `calc(50% - ${-1 * this.left}px)`;\n\t\t\tthis.left = 0;\n\t\t} else if(this.left > maxLeft) {\n\t\t\tlet delta = this.left - maxLeft;\n\t\t\tlet pointerOffset = `calc(50% + ${delta}px)`;\n\t\t\tpointer.style.left = pointerOffset;\n\n\t\t\tthis.left = maxLeft;\n\t\t} else {\n\t\t\tpointer.style.left = `50%`;\n\t\t}\n\t}\n\n\tsetValues(x, y, title = {}, listValues = [], index = -1) {\n\t\tthis.titleName = title.name;\n\t\tthis.titleValue = title.value;\n\t\tthis.listValues = listValues;\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.titleValueFirst = title.valueFirst || 0;\n\t\tthis.index = index;\n\t\tthis.refresh();\n\t}\n\n\thideTip() {\n\t\tthis.container.style.top = '0px';\n\t\tthis.container.style.left = '0px';\n\t\tthis.container.style.opacity = '0';\n\t}\n\n\tshowTip() {\n\t\tthis.container.style.top = this.top + 'px';\n\t\tthis.container.style.left = this.left + 'px';\n\t\tthis.container.style.opacity = '1';\n\t}\n}\n\n/**\n * Returns the value of a number upto 2 decimal places.\n * @param {Number} d Any number\n */\nfunction floatTwo(d) {\n\treturn parseFloat(d.toFixed(2));\n}\n\n/**\n * Returns whether or not two given arrays are equal.\n * @param {Array} arr1 First array\n * @param {Array} arr2 Second array\n */\n\n\n/**\n * Shuffles array in place. ES6 version\n * @param {Array} array An array containing the items.\n */\n\n\n/**\n * Fill an array with extra points\n * @param {Array} array Array\n * @param {Number} count number of filler elements\n * @param {Object} element element to fill with\n * @param {Boolean} start fill at start?\n */\nfunction fillArray(array, count, element, start=false) {\n\tif(!element) {\n\t\telement = start ? array[0] : array[array.length - 1];\n\t}\n\tlet fillerArray = new Array(Math.abs(count)).fill(element);\n\tarray = start ? fillerArray.concat(array) : array.concat(fillerArray);\n\treturn array;\n}\n\n/**\n * Returns pixel width of string.\n * @param {String} string\n * @param {Number} charWidth Width of single char in pixels\n */\nfunction getStringWidth(string, charWidth) {\n\treturn (string+\"\").length * charWidth;\n}\n\n\n\n// https://stackoverflow.com/a/29325222\n\n\nfunction getPositionByAngle(angle, radius) {\n\treturn {\n\t\tx: Math.sin(angle * ANGLE_RATIO) * radius,\n\t\ty: Math.cos(angle * ANGLE_RATIO) * radius,\n\t};\n}\n\n/**\n * Check if a number is valid for svg attributes\n * @param {object} candidate Candidate to test\n * @param {Boolean} nonNegative flag to treat negative number as invalid\n */\nfunction isValidNumber(candidate, nonNegative=false) {\n\tif (Number.isNaN(candidate)) return false;\n\telse if (candidate === undefined) return false;\n\telse if (!Number.isFinite(candidate)) return false;\n\telse if (nonNegative && candidate < 0) return false;\n\telse return true;\n}\n\nfunction getBarHeightAndYAttr(yTop, zeroLine) {\n\tlet height, y;\n\tif (yTop <= zeroLine) {\n\t\theight = zeroLine - yTop;\n\t\ty = yTop;\n\t} else {\n\t\theight = yTop - zeroLine;\n\t\ty = zeroLine;\n\t}\n\n\treturn [height, y];\n}\n\nfunction equilizeNoOfElements(array1, array2,\n\textraCount = array2.length - array1.length) {\n\n\t// Doesn't work if either has zero elements.\n\tif(extraCount > 0) {\n\t\tarray1 = fillArray(array1, extraCount);\n\t} else {\n\t\tarray2 = fillArray(array2, extraCount);\n\t}\n\treturn [array1, array2];\n}\n\nfunction truncateString(txt, len) {\n\tif (!txt) {\n\t\treturn;\n\t}\n\tif (txt.length > len) {\n\t\treturn txt.slice(0, len-3) + '...';\n\t} else {\n\t\treturn txt;\n\t}\n}\n\nfunction shortenLargeNumber(label) {\n\tlet number;\n\tif (typeof label === 'number') number = label;\n\telse if (typeof label === 'string') {\n\t\tnumber = Number(label);\n\t\tif (Number.isNaN(number)) return label;\n\t}\n\n\t// Using absolute since log wont work for negative numbers\n\tlet p = Math.floor(Math.log10(Math.abs(number)));\n\tif (p <= 2) return number; // Return as is for a 3 digit number of less\n\tlet\tl = Math.floor(p / 3);\n\tlet shortened = (Math.pow(10, p - l * 3) * +(number / Math.pow(10, p)).toFixed(1));\n\n\t// Correct for floating point error upto 2 decimal places\n\treturn Math.round(shortened*100)/100 + ' ' + ['', 'K', 'M', 'B', 'T'][l];\n}\n\n// cubic bezier curve calculation (from example by FranÃ§ois Romain)\nfunction getSplineCurvePointsStr(xList, yList) {\n\n\tlet points=[];\n\tfor(let i=0;i<xList.length;i++){\n\t\tpoints.push([xList[i], yList[i]]);\n\t}\n\n\tlet smoothing = 0.2;\n\tlet line = (pointA, pointB) => {\n\t\tlet lengthX = pointB[0] - pointA[0];\n\t\tlet lengthY = pointB[1] - pointA[1];\n\t\treturn {\n\t\t\tlength: Math.sqrt(Math.pow(lengthX, 2) + Math.pow(lengthY, 2)),\n\t\t\tangle: Math.atan2(lengthY, lengthX)\n\t\t};\n\t};\n    \n\tlet controlPoint = (current, previous, next, reverse) => {\n\t\tlet p = previous || current;\n\t\tlet n = next || current;\n\t\tlet o = line(p, n);\n\t\tlet angle = o.angle + (reverse ? Math.PI : 0);\n\t\tlet length = o.length * smoothing;\n\t\tlet x = current[0] + Math.cos(angle) * length;\n\t\tlet y = current[1] + Math.sin(angle) * length;\n\t\treturn [x, y];\n\t};\n    \n\tlet bezierCommand = (point, i, a) => {\n\t\tlet cps = controlPoint(a[i - 1], a[i - 2], point);\n\t\tlet cpe = controlPoint(point, a[i - 1], a[i + 1], true);\n\t\treturn `C ${cps[0]},${cps[1]} ${cpe[0]},${cpe[1]} ${point[0]},${point[1]}`;\n\t};\n    \n\tlet pointStr = (points, command) => {\n\t\treturn points.reduce((acc, point, i, a) => i === 0\n\t\t\t? `${point[0]},${point[1]}`\n\t\t\t: `${acc} ${command(point, i, a)}`, '');\n\t};\n    \n\treturn pointStr(points, bezierCommand);\n}\n\nconst PRESET_COLOR_MAP = {\n\t'light-blue': '#7cd6fd',\n\t'blue': '#5e64ff',\n\t'violet': '#743ee2',\n\t'red': '#ff5858',\n\t'orange': '#ffa00a',\n\t'yellow': '#feef72',\n\t'green': '#28a745',\n\t'light-green': '#98d85b',\n\t'purple': '#b554ff',\n\t'magenta': '#ffa3ef',\n\t'black': '#36114C',\n\t'grey': '#bdd3e6',\n\t'light-grey': '#f0f4f7',\n\t'dark-grey': '#b8c2cc'\n};\n\nfunction limitColor(r){\n\tif (r > 255) return 255;\n\telse if (r < 0) return 0;\n\treturn r;\n}\n\nfunction lightenDarkenColor(color, amt) {\n\tlet col = getColor(color);\n\tlet usePound = false;\n\tif (col[0] == \"#\") {\n\t\tcol = col.slice(1);\n\t\tusePound = true;\n\t}\n\tlet num = parseInt(col,16);\n\tlet r = limitColor((num >> 16) + amt);\n\tlet b = limitColor(((num >> 8) & 0x00FF) + amt);\n\tlet g = limitColor((num & 0x0000FF) + amt);\n\treturn (usePound?\"#\":\"\") + (g | (b << 8) | (r << 16)).toString(16);\n}\n\nfunction isValidColor(string) {\n\t// https://stackoverflow.com/a/32685393\n\tlet HEX_RE = /(^\\s*)(#)((?:[A-Fa-f0-9]{3}){1,2})$/i;\n\tlet RGB_RE = /(^\\s*)(rgb|hsl)(a?)[(]\\s*([\\d.]+\\s*%?)\\s*,\\s*([\\d.]+\\s*%?)\\s*,\\s*([\\d.]+\\s*%?)\\s*(?:,\\s*([\\d.]+)\\s*)?[)]$/i;\n\treturn HEX_RE.test(string) || RGB_RE.test(string);\n}\n\nconst getColor = (color) => {\n\treturn PRESET_COLOR_MAP[color] || color;\n};\n\nconst AXIS_TICK_LENGTH = 6;\nconst LABEL_MARGIN = 4;\nconst LABEL_MAX_CHARS = 15;\nconst FONT_SIZE = 10;\nconst BASE_LINE_COLOR = '#dadada';\nconst FONT_FILL = '#555b51';\n\nfunction $$1(expr, con) {\n\treturn typeof expr === \"string\"? (con || document).querySelector(expr) : expr || null;\n}\n\nfunction createSVG(tag, o) {\n\tvar element = document.createElementNS(\"http://www.w3.org/2000/svg\", tag);\n\n\tfor (var i in o) {\n\t\tvar val = o[i];\n\n\t\tif (i === \"inside\") {\n\t\t\t$$1(val).appendChild(element);\n\t\t}\n\t\telse if (i === \"around\") {\n\t\t\tvar ref = $$1(val);\n\t\t\tref.parentNode.insertBefore(element, ref);\n\t\t\telement.appendChild(ref);\n\n\t\t} else if (i === \"styles\") {\n\t\t\tif(typeof val === \"object\") {\n\t\t\t\tObject.keys(val).map(prop => {\n\t\t\t\t\telement.style[prop] = val[prop];\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tif(i === \"className\") { i = \"class\"; }\n\t\t\tif(i === \"innerHTML\") {\n\t\t\t\telement['textContent'] = val;\n\t\t\t} else {\n\t\t\t\telement.setAttribute(i, val);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn element;\n}\n\nfunction renderVerticalGradient(svgDefElem, gradientId) {\n\treturn createSVG('linearGradient', {\n\t\tinside: svgDefElem,\n\t\tid: gradientId,\n\t\tx1: 0,\n\t\tx2: 0,\n\t\ty1: 0,\n\t\ty2: 1\n\t});\n}\n\nfunction setGradientStop(gradElem, offset, color, opacity) {\n\treturn createSVG('stop', {\n\t\t'inside': gradElem,\n\t\t'style': `stop-color: ${color}`,\n\t\t'offset': offset,\n\t\t'stop-opacity': opacity\n\t});\n}\n\nfunction makeSVGContainer(parent, className, width, height) {\n\treturn createSVG('svg', {\n\t\tclassName: className,\n\t\tinside: parent,\n\t\twidth: width,\n\t\theight: height\n\t});\n}\n\nfunction makeSVGDefs(svgContainer) {\n\treturn createSVG('defs', {\n\t\tinside: svgContainer,\n\t});\n}\n\nfunction makeSVGGroup(className, transform='', parent=undefined) {\n\tlet args = {\n\t\tclassName: className,\n\t\ttransform: transform\n\t};\n\tif(parent) args.inside = parent;\n\treturn createSVG('g', args);\n}\n\n\n\nfunction makePath(pathStr, className='', stroke='none', fill='none', strokeWidth=2) {\n\treturn createSVG('path', {\n\t\tclassName: className,\n\t\td: pathStr,\n\t\tstyles: {\n\t\t\tstroke: stroke,\n\t\t\tfill: fill,\n\t\t\t'stroke-width': strokeWidth\n\t\t}\n\t});\n}\n\nfunction makeArcPathStr(startPosition, endPosition, center, radius, clockWise=1, largeArc=0){\n\tlet [arcStartX, arcStartY] = [center.x + startPosition.x, center.y + startPosition.y];\n\tlet [arcEndX, arcEndY] = [center.x + endPosition.x, center.y + endPosition.y];\n\treturn `M${center.x} ${center.y}\n\t\tL${arcStartX} ${arcStartY}\n\t\tA ${radius} ${radius} 0 ${largeArc} ${clockWise ? 1 : 0}\n\t\t${arcEndX} ${arcEndY} z`;\n}\n\nfunction makeCircleStr(startPosition, endPosition, center, radius, clockWise=1, largeArc=0){\n\tlet [arcStartX, arcStartY] = [center.x + startPosition.x, center.y + startPosition.y];\n\tlet [arcEndX, midArc, arcEndY] = [center.x + endPosition.x, center.y * 2, center.y + endPosition.y];\n\treturn `M${center.x} ${center.y}\n\t\tL${arcStartX} ${arcStartY}\n\t\tA ${radius} ${radius} 0 ${largeArc} ${clockWise ? 1 : 0}\n\t\t${arcEndX} ${midArc} z\n\t\tL${arcStartX} ${midArc}\n\t\tA ${radius} ${radius} 0 ${largeArc} ${clockWise ? 1 : 0}\n\t\t${arcEndX} ${arcEndY} z`;\n}\n\nfunction makeArcStrokePathStr(startPosition, endPosition, center, radius, clockWise=1, largeArc=0){\n\tlet [arcStartX, arcStartY] = [center.x + startPosition.x, center.y + startPosition.y];\n\tlet [arcEndX, arcEndY] = [center.x + endPosition.x, center.y + endPosition.y];\n\n\treturn `M${arcStartX} ${arcStartY}\n\t\tA ${radius} ${radius} 0 ${largeArc} ${clockWise ? 1 : 0}\n\t\t${arcEndX} ${arcEndY}`;\n}\n\nfunction makeStrokeCircleStr(startPosition, endPosition, center, radius, clockWise=1, largeArc=0){\n\tlet [arcStartX, arcStartY] = [center.x + startPosition.x, center.y + startPosition.y];\n\tlet [arcEndX, midArc, arcEndY] = [center.x + endPosition.x, radius * 2 + arcStartY, center.y + startPosition.y];\n\n\treturn `M${arcStartX} ${arcStartY}\n\t\tA ${radius} ${radius} 0 ${largeArc} ${clockWise ? 1 : 0}\n\t\t${arcEndX} ${midArc}\n\t\tM${arcStartX} ${midArc}\n\t\tA ${radius} ${radius} 0 ${largeArc} ${clockWise ? 1 : 0}\n\t\t${arcEndX} ${arcEndY}`;\n}\n\nfunction makeGradient(svgDefElem, color, lighter = false) {\n\tlet gradientId ='path-fill-gradient' + '-' + color + '-' +(lighter ? 'lighter' : 'default');\n\tlet gradientDef = renderVerticalGradient(svgDefElem, gradientId);\n\tlet opacities = [1, 0.6, 0.2];\n\tif(lighter) {\n\t\topacities = [0.4, 0.2, 0];\n\t}\n\n\tsetGradientStop(gradientDef, \"0%\", color, opacities[0]);\n\tsetGradientStop(gradientDef, \"50%\", color, opacities[1]);\n\tsetGradientStop(gradientDef, \"100%\", color, opacities[2]);\n\n\treturn gradientId;\n}\n\nfunction percentageBar(x, y, width, height,\n\tdepth=PERCENTAGE_BAR_DEFAULT_DEPTH, fill='none') {\n\n\tlet args = {\n\t\tclassName: 'percentage-bar',\n\t\tx: x,\n\t\ty: y,\n\t\twidth: width,\n\t\theight: height,\n\t\tfill: fill,\n\t\tstyles: {\n\t\t\t'stroke': lightenDarkenColor(fill, -25),\n\t\t\t// Diabolically good: https://stackoverflow.com/a/9000859\n\t\t\t// https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/stroke-dasharray\n\t\t\t'stroke-dasharray': `0, ${height + width}, ${width}, ${height}`,\n\t\t\t'stroke-width': depth\n\t\t},\n\t};\n\n\treturn createSVG(\"rect\", args);\n}\n\nfunction heatSquare(className, x, y, size, radius, fill='none', data={}) {\n\tlet args = {\n\t\tclassName: className,\n\t\tx: x,\n\t\ty: y,\n\t\twidth: size,\n\t\theight: size,\n\t\trx: radius,\n\t\tfill: fill\n\t};\n\n\tObject.keys(data).map(key => {\n\t\targs[key] = data[key];\n\t});\n\n\treturn createSVG(\"rect\", args);\n}\n\nfunction legendBar(x, y, size, fill='none', label, truncate=false) {\n\tlabel = truncate ? truncateString(label, LABEL_MAX_CHARS) : label;\n\n\tlet args = {\n\t\tclassName: 'legend-bar',\n\t\tx: 0,\n\t\ty: 0,\n\t\twidth: size,\n\t\theight: '2px',\n\t\tfill: fill\n\t};\n\tlet text = createSVG('text', {\n\t\tclassName: 'legend-dataset-text',\n\t\tx: 0,\n\t\ty: 0,\n\t\tdy: (FONT_SIZE * 2) + 'px',\n\t\t'font-size': (FONT_SIZE * 1.2) + 'px',\n\t\t'text-anchor': 'start',\n\t\tfill: FONT_FILL,\n\t\tinnerHTML: label\n\t});\n\n\tlet group = createSVG('g', {\n\t\ttransform: `translate(${x}, ${y})`\n\t});\n\tgroup.appendChild(createSVG(\"rect\", args));\n\tgroup.appendChild(text);\n\n\treturn group;\n}\n\nfunction legendDot(x, y, size, fill='none', label, truncate=false) {\n\tlabel = truncate ? truncateString(label, LABEL_MAX_CHARS) : label;\n\n\tlet args = {\n\t\tclassName: 'legend-dot',\n\t\tcx: 0,\n\t\tcy: 0,\n\t\tr: size,\n\t\tfill: fill\n\t};\n\tlet text = createSVG('text', {\n\t\tclassName: 'legend-dataset-text',\n\t\tx: 0,\n\t\ty: 0,\n\t\tdx: (FONT_SIZE) + 'px',\n\t\tdy: (FONT_SIZE/3) + 'px',\n\t\t'font-size': (FONT_SIZE * 1.2) + 'px',\n\t\t'text-anchor': 'start',\n\t\tfill: FONT_FILL,\n\t\tinnerHTML: label\n\t});\n\n\tlet group = createSVG('g', {\n\t\ttransform: `translate(${x}, ${y})`\n\t});\n\tgroup.appendChild(createSVG(\"circle\", args));\n\tgroup.appendChild(text);\n\n\treturn group;\n}\n\nfunction makeText(className, x, y, content, options = {}) {\n\tlet fontSize = options.fontSize || FONT_SIZE;\n\tlet dy = options.dy !== undefined ? options.dy : (fontSize / 2);\n\tlet fill = options.fill || FONT_FILL;\n\tlet textAnchor = options.textAnchor || 'start';\n\treturn createSVG('text', {\n\t\tclassName: className,\n\t\tx: x,\n\t\ty: y,\n\t\tdy: dy + 'px',\n\t\t'font-size': fontSize + 'px',\n\t\tfill: fill,\n\t\t'text-anchor': textAnchor,\n\t\tinnerHTML: content\n\t});\n}\n\nfunction makeVertLine(x, label, y1, y2, options={}) {\n\tif(!options.stroke) options.stroke = BASE_LINE_COLOR;\n\tlet l = createSVG('line', {\n\t\tclassName: 'line-vertical ' + options.className,\n\t\tx1: 0,\n\t\tx2: 0,\n\t\ty1: y1,\n\t\ty2: y2,\n\t\tstyles: {\n\t\t\tstroke: options.stroke\n\t\t}\n\t});\n\n\tlet text = createSVG('text', {\n\t\tx: 0,\n\t\ty: y1 > y2 ? y1 + LABEL_MARGIN : y1 - LABEL_MARGIN - FONT_SIZE,\n\t\tdy: FONT_SIZE + 'px',\n\t\t'font-size': FONT_SIZE + 'px',\n\t\t'text-anchor': 'middle',\n\t\tinnerHTML: label + \"\"\n\t});\n\n\tlet line = createSVG('g', {\n\t\ttransform: `translate(${ x }, 0)`\n\t});\n\n\tline.appendChild(l);\n\tline.appendChild(text);\n\n\treturn line;\n}\n\nfunction makeHoriLine(y, label, x1, x2, options={}) {\n\tif(!options.stroke) options.stroke = BASE_LINE_COLOR;\n\tif(!options.lineType) options.lineType = '';\n\tif (options.shortenNumbers) label = shortenLargeNumber(label);\n\n\tlet className = 'line-horizontal ' + options.className +\n\t\t(options.lineType === \"dashed\" ? \"dashed\": \"\");\n\n\tlet l = createSVG('line', {\n\t\tclassName: className,\n\t\tx1: x1,\n\t\tx2: x2,\n\t\ty1: 0,\n\t\ty2: 0,\n\t\tstyles: {\n\t\t\tstroke: options.stroke\n\t\t}\n\t});\n\n\tlet text = createSVG('text', {\n\t\tx: x1 < x2 ? x1 - LABEL_MARGIN : x1 + LABEL_MARGIN,\n\t\ty: 0,\n\t\tdy: (FONT_SIZE / 2 - 2) + 'px',\n\t\t'font-size': FONT_SIZE + 'px',\n\t\t'text-anchor': x1 < x2 ? 'end' : 'start',\n\t\tinnerHTML: label+\"\"\n\t});\n\n\tlet line = createSVG('g', {\n\t\ttransform: `translate(0, ${y})`,\n\t\t'stroke-opacity': 1\n\t});\n\n\tif(text === 0 || text === '0') {\n\t\tline.style.stroke = \"rgba(27, 31, 35, 0.6)\";\n\t}\n\n\tline.appendChild(l);\n\tline.appendChild(text);\n\n\treturn line;\n}\n\nfunction yLine(y, label, width, options={}) {\n\tif (!isValidNumber(y)) y = 0;\n\n\tif(!options.pos) options.pos = 'left';\n\tif(!options.offset) options.offset = 0;\n\tif(!options.mode) options.mode = 'span';\n\tif(!options.stroke) options.stroke = BASE_LINE_COLOR;\n\tif(!options.className) options.className = '';\n\n\tlet x1 = -1 * AXIS_TICK_LENGTH;\n\tlet x2 = options.mode === 'span' ? width + AXIS_TICK_LENGTH : 0;\n\n\tif(options.mode === 'tick' && options.pos === 'right') {\n\t\tx1 = width + AXIS_TICK_LENGTH;\n\t\tx2 = width;\n\t}\n\n\t// let offset = options.pos === 'left' ? -1 * options.offset : options.offset;\n\n\tx1 += options.offset;\n\tx2 += options.offset;\n\n\treturn makeHoriLine(y, label, x1, x2, {\n\t\tstroke: options.stroke,\n\t\tclassName: options.className,\n\t\tlineType: options.lineType,\n\t\tshortenNumbers: options.shortenNumbers\n\t});\n}\n\nfunction xLine(x, label, height, options={}) {\n\tif (!isValidNumber(x)) x = 0;\n\n\tif(!options.pos) options.pos = 'bottom';\n\tif(!options.offset) options.offset = 0;\n\tif(!options.mode) options.mode = 'span';\n\tif(!options.stroke) options.stroke = BASE_LINE_COLOR;\n\tif(!options.className) options.className = '';\n\n\t// Draw X axis line in span/tick mode with optional label\n\t//                        \ty2(span)\n\t// \t\t\t\t\t\t|\n\t// \t\t\t\t\t\t|\n\t//\t\t\t\tx line\t|\n\t//\t\t\t\t\t\t|\n\t// \t\t\t\t\t   \t|\n\t// ---------------------+-- y2(tick)\n\t//\t\t\t\t\t\t|\n\t//\t\t\t\t\t\t\ty1\n\n\tlet y1 = height + AXIS_TICK_LENGTH;\n\tlet y2 = options.mode === 'span' ? -1 * AXIS_TICK_LENGTH : height;\n\n\tif(options.mode === 'tick' && options.pos === 'top') {\n\t\t// top axis ticks\n\t\ty1 = -1 * AXIS_TICK_LENGTH;\n\t\ty2 = 0;\n\t}\n\n\treturn makeVertLine(x, label, y1, y2, {\n\t\tstroke: options.stroke,\n\t\tclassName: options.className,\n\t\tlineType: options.lineType\n\t});\n}\n\nfunction yMarker(y, label, width, options={}) {\n\tif(!options.labelPos) options.labelPos = 'right';\n\tlet x = options.labelPos === 'left' ? LABEL_MARGIN\n\t\t: width - getStringWidth(label, 5) - LABEL_MARGIN;\n\n\tlet labelSvg = createSVG('text', {\n\t\tclassName: 'chart-label',\n\t\tx: x,\n\t\ty: 0,\n\t\tdy: (FONT_SIZE / -2) + 'px',\n\t\t'font-size': FONT_SIZE + 'px',\n\t\t'text-anchor': 'start',\n\t\tinnerHTML: label+\"\"\n\t});\n\n\tlet line = makeHoriLine(y, '', 0, width, {\n\t\tstroke: options.stroke || BASE_LINE_COLOR,\n\t\tclassName: options.className || '',\n\t\tlineType: options.lineType\n\t});\n\n\tline.appendChild(labelSvg);\n\n\treturn line;\n}\n\nfunction yRegion(y1, y2, width, label, options={}) {\n\t// return a group\n\tlet height = y1 - y2;\n\n\tlet rect = createSVG('rect', {\n\t\tclassName: `bar mini`, // remove class\n\t\tstyles: {\n\t\t\tfill: `rgba(228, 234, 239, 0.49)`,\n\t\t\tstroke: BASE_LINE_COLOR,\n\t\t\t'stroke-dasharray': `${width}, ${height}`\n\t\t},\n\t\t// 'data-point-index': index,\n\t\tx: 0,\n\t\ty: 0,\n\t\twidth: width,\n\t\theight: height\n\t});\n\n\tif(!options.labelPos) options.labelPos = 'right';\n\tlet x = options.labelPos === 'left' ? LABEL_MARGIN\n\t\t: width - getStringWidth(label+\"\", 4.5) - LABEL_MARGIN;\n\n\tlet labelSvg = createSVG('text', {\n\t\tclassName: 'chart-label',\n\t\tx: x,\n\t\ty: 0,\n\t\tdy: (FONT_SIZE / -2) + 'px',\n\t\t'font-size': FONT_SIZE + 'px',\n\t\t'text-anchor': 'start',\n\t\tinnerHTML: label+\"\"\n\t});\n\n\tlet region = createSVG('g', {\n\t\ttransform: `translate(0, ${y2})`\n\t});\n\n\tregion.appendChild(rect);\n\tregion.appendChild(labelSvg);\n\n\treturn region;\n}\n\nfunction datasetBar(x, yTop, width, color, label='', index=0, offset=0, meta={}) {\n\tlet [height, y] = getBarHeightAndYAttr(yTop, meta.zeroLine);\n\ty -= offset;\n\n\tif(height === 0) {\n\t\theight = meta.minHeight;\n\t\ty -= meta.minHeight;\n\t}\n\n\t// Preprocess numbers to avoid svg building errors\n\tif (!isValidNumber(x)) x = 0;\n\tif (!isValidNumber(y)) y = 0;\n\tif (!isValidNumber(height, true)) height = 0;\n\tif (!isValidNumber(width, true)) width = 0;\n\n\tlet rect = createSVG('rect', {\n\t\tclassName: `bar mini`,\n\t\tstyle: `fill: ${color}`,\n\t\t'data-point-index': index,\n\t\tx: x,\n\t\ty: y,\n\t\twidth: width,\n\t\theight: height\n\t});\n\n\tlabel += \"\";\n\n\tif(!label && !label.length) {\n\t\treturn rect;\n\t} else {\n\t\trect.setAttribute('y', 0);\n\t\trect.setAttribute('x', 0);\n\t\tlet text = createSVG('text', {\n\t\t\tclassName: 'data-point-value',\n\t\t\tx: width/2,\n\t\t\ty: 0,\n\t\t\tdy: (FONT_SIZE / 2 * -1) + 'px',\n\t\t\t'font-size': FONT_SIZE + 'px',\n\t\t\t'text-anchor': 'middle',\n\t\t\tinnerHTML: label\n\t\t});\n\n\t\tlet group = createSVG('g', {\n\t\t\t'data-point-index': index,\n\t\t\ttransform: `translate(${x}, ${y})`\n\t\t});\n\t\tgroup.appendChild(rect);\n\t\tgroup.appendChild(text);\n\n\t\treturn group;\n\t}\n}\n\nfunction datasetDot(x, y, radius, color, label='', index=0) {\n\tlet dot = createSVG('circle', {\n\t\tstyle: `fill: ${color}`,\n\t\t'data-point-index': index,\n\t\tcx: x,\n\t\tcy: y,\n\t\tr: radius\n\t});\n\n\tlabel += \"\";\n\n\tif(!label && !label.length) {\n\t\treturn dot;\n\t} else {\n\t\tdot.setAttribute('cy', 0);\n\t\tdot.setAttribute('cx', 0);\n\n\t\tlet text = createSVG('text', {\n\t\t\tclassName: 'data-point-value',\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t\tdy: (FONT_SIZE / 2 * -1 - radius) + 'px',\n\t\t\t'font-size': FONT_SIZE + 'px',\n\t\t\t'text-anchor': 'middle',\n\t\t\tinnerHTML: label\n\t\t});\n\n\t\tlet group = createSVG('g', {\n\t\t\t'data-point-index': index,\n\t\t\ttransform: `translate(${x}, ${y})`\n\t\t});\n\t\tgroup.appendChild(dot);\n\t\tgroup.appendChild(text);\n\n\t\treturn group;\n\t}\n}\n\nfunction getPaths(xList, yList, color, options={}, meta={}) {\n\tlet pointsList = yList.map((y, i) => (xList[i] + ',' + y));\n\tlet pointsStr = pointsList.join(\"L\");\n\n\t// Spline\n\tif (options.spline)\n\t\tpointsStr = getSplineCurvePointsStr(xList, yList);\n\n\tlet path = makePath(\"M\"+pointsStr, 'line-graph-path', color);\n\n\t// HeatLine\n\tif(options.heatline) {\n\t\tlet gradient_id = makeGradient(meta.svgDefs, color);\n\t\tpath.style.stroke = `url(#${gradient_id})`;\n\t}\n\n\tlet paths = {\n\t\tpath: path\n\t};\n\n\t// Region\n\tif(options.regionFill) {\n\t\tlet gradient_id_region = makeGradient(meta.svgDefs, color, true);\n\n\t\tlet pathStr = \"M\" + `${xList[0]},${meta.zeroLine}L` + pointsStr + `L${xList.slice(-1)[0]},${meta.zeroLine}`;\n\t\tpaths.region = makePath(pathStr, `region-fill`, 'none', `url(#${gradient_id_region})`);\n\t}\n\n\treturn paths;\n}\n\nlet makeOverlay = {\n\t'bar': (unit) => {\n\t\tlet transformValue;\n\t\tif(unit.nodeName !== 'rect') {\n\t\t\ttransformValue = unit.getAttribute('transform');\n\t\t\tunit = unit.childNodes[0];\n\t\t}\n\t\tlet overlay = unit.cloneNode();\n\t\toverlay.style.fill = '#000000';\n\t\toverlay.style.opacity = '0.4';\n\n\t\tif(transformValue) {\n\t\t\toverlay.setAttribute('transform', transformValue);\n\t\t}\n\t\treturn overlay;\n\t},\n\n\t'dot': (unit) => {\n\t\tlet transformValue;\n\t\tif(unit.nodeName !== 'circle') {\n\t\t\ttransformValue = unit.getAttribute('transform');\n\t\t\tunit = unit.childNodes[0];\n\t\t}\n\t\tlet overlay = unit.cloneNode();\n\t\tlet radius = unit.getAttribute('r');\n\t\tlet fill = unit.getAttribute('fill');\n\t\toverlay.setAttribute('r', parseInt(radius) + DOT_OVERLAY_SIZE_INCR);\n\t\toverlay.setAttribute('fill', fill);\n\t\toverlay.style.opacity = '0.6';\n\n\t\tif(transformValue) {\n\t\t\toverlay.setAttribute('transform', transformValue);\n\t\t}\n\t\treturn overlay;\n\t},\n\n\t'heat_square': (unit) => {\n\t\tlet transformValue;\n\t\tif(unit.nodeName !== 'circle') {\n\t\t\ttransformValue = unit.getAttribute('transform');\n\t\t\tunit = unit.childNodes[0];\n\t\t}\n\t\tlet overlay = unit.cloneNode();\n\t\tlet radius = unit.getAttribute('r');\n\t\tlet fill = unit.getAttribute('fill');\n\t\toverlay.setAttribute('r', parseInt(radius) + DOT_OVERLAY_SIZE_INCR);\n\t\toverlay.setAttribute('fill', fill);\n\t\toverlay.style.opacity = '0.6';\n\n\t\tif(transformValue) {\n\t\t\toverlay.setAttribute('transform', transformValue);\n\t\t}\n\t\treturn overlay;\n\t}\n};\n\nlet updateOverlay = {\n\t'bar': (unit, overlay) => {\n\t\tlet transformValue;\n\t\tif(unit.nodeName !== 'rect') {\n\t\t\ttransformValue = unit.getAttribute('transform');\n\t\t\tunit = unit.childNodes[0];\n\t\t}\n\t\tlet attributes = ['x', 'y', 'width', 'height'];\n\t\tObject.values(unit.attributes)\n\t\t\t.filter(attr => attributes.includes(attr.name) && attr.specified)\n\t\t\t.map(attr => {\n\t\t\t\toverlay.setAttribute(attr.name, attr.nodeValue);\n\t\t\t});\n\n\t\tif(transformValue) {\n\t\t\toverlay.setAttribute('transform', transformValue);\n\t\t}\n\t},\n\n\t'dot': (unit, overlay) => {\n\t\tlet transformValue;\n\t\tif(unit.nodeName !== 'circle') {\n\t\t\ttransformValue = unit.getAttribute('transform');\n\t\t\tunit = unit.childNodes[0];\n\t\t}\n\t\tlet attributes = ['cx', 'cy'];\n\t\tObject.values(unit.attributes)\n\t\t\t.filter(attr => attributes.includes(attr.name) && attr.specified)\n\t\t\t.map(attr => {\n\t\t\t\toverlay.setAttribute(attr.name, attr.nodeValue);\n\t\t\t});\n\n\t\tif(transformValue) {\n\t\t\toverlay.setAttribute('transform', transformValue);\n\t\t}\n\t},\n\n\t'heat_square': (unit, overlay) => {\n\t\tlet transformValue;\n\t\tif(unit.nodeName !== 'circle') {\n\t\t\ttransformValue = unit.getAttribute('transform');\n\t\t\tunit = unit.childNodes[0];\n\t\t}\n\t\tlet attributes = ['cx', 'cy'];\n\t\tObject.values(unit.attributes)\n\t\t\t.filter(attr => attributes.includes(attr.name) && attr.specified)\n\t\t\t.map(attr => {\n\t\t\t\toverlay.setAttribute(attr.name, attr.nodeValue);\n\t\t\t});\n\n\t\tif(transformValue) {\n\t\t\toverlay.setAttribute('transform', transformValue);\n\t\t}\n\t},\n};\n\nconst UNIT_ANIM_DUR = 350;\nconst PATH_ANIM_DUR = 350;\nconst MARKER_LINE_ANIM_DUR = UNIT_ANIM_DUR;\nconst REPLACE_ALL_NEW_DUR = 250;\n\nconst STD_EASING = 'easein';\n\nfunction translate(unit, oldCoord, newCoord, duration) {\n\tlet old = typeof oldCoord === 'string' ? oldCoord : oldCoord.join(', ');\n\treturn [\n\t\tunit,\n\t\t{transform: newCoord.join(', ')},\n\t\tduration,\n\t\tSTD_EASING,\n\t\t\"translate\",\n\t\t{transform: old}\n\t];\n}\n\nfunction translateVertLine(xLine, newX, oldX) {\n\treturn translate(xLine, [oldX, 0], [newX, 0], MARKER_LINE_ANIM_DUR);\n}\n\nfunction translateHoriLine(yLine, newY, oldY) {\n\treturn translate(yLine, [0, oldY], [0, newY], MARKER_LINE_ANIM_DUR);\n}\n\nfunction animateRegion(rectGroup, newY1, newY2, oldY2) {\n\tlet newHeight = newY1 - newY2;\n\tlet rect = rectGroup.childNodes[0];\n\tlet width = rect.getAttribute(\"width\");\n\tlet rectAnim = [\n\t\trect,\n\t\t{ height: newHeight, 'stroke-dasharray': `${width}, ${newHeight}` },\n\t\tMARKER_LINE_ANIM_DUR,\n\t\tSTD_EASING\n\t];\n\n\tlet groupAnim = translate(rectGroup, [0, oldY2], [0, newY2], MARKER_LINE_ANIM_DUR);\n\treturn [rectAnim, groupAnim];\n}\n\nfunction animateBar(bar, x, yTop, width, offset=0, meta={}) {\n\tlet [height, y] = getBarHeightAndYAttr(yTop, meta.zeroLine);\n\ty -= offset;\n\tif(bar.nodeName !== 'rect') {\n\t\tlet rect = bar.childNodes[0];\n\t\tlet rectAnim = [\n\t\t\trect,\n\t\t\t{width: width, height: height},\n\t\t\tUNIT_ANIM_DUR,\n\t\t\tSTD_EASING\n\t\t];\n\n\t\tlet oldCoordStr = bar.getAttribute(\"transform\").split(\"(\")[1].slice(0, -1);\n\t\tlet groupAnim = translate(bar, oldCoordStr, [x, y], MARKER_LINE_ANIM_DUR);\n\t\treturn [rectAnim, groupAnim];\n\t} else {\n\t\treturn [[bar, {width: width, height: height, x: x, y: y}, UNIT_ANIM_DUR, STD_EASING]];\n\t}\n\t// bar.animate({height: args.newHeight, y: yTop}, UNIT_ANIM_DUR, mina.easein);\n}\n\nfunction animateDot(dot, x, y) {\n\tif(dot.nodeName !== 'circle') {\n\t\tlet oldCoordStr = dot.getAttribute(\"transform\").split(\"(\")[1].slice(0, -1);\n\t\tlet groupAnim = translate(dot, oldCoordStr, [x, y], MARKER_LINE_ANIM_DUR);\n\t\treturn [groupAnim];\n\t} else {\n\t\treturn [[dot, {cx: x, cy: y}, UNIT_ANIM_DUR, STD_EASING]];\n\t}\n\t// dot.animate({cy: yTop}, UNIT_ANIM_DUR, mina.easein);\n}\n\nfunction animatePath(paths, newXList, newYList, zeroLine, spline) {\n\tlet pathComponents = [];\n\tlet pointsStr = newYList.map((y, i) => (newXList[i] + ',' + y)).join(\"L\");\n\n\tif (spline)\n\t\tpointsStr = getSplineCurvePointsStr(newXList, newYList);\n\n\tconst animPath = [paths.path, {d:\"M\" + pointsStr}, PATH_ANIM_DUR, STD_EASING];\n\tpathComponents.push(animPath);\n\n\tif(paths.region) {\n\t\tlet regStartPt = `${newXList[0]},${zeroLine}L`;\n\t\tlet regEndPt = `L${newXList.slice(-1)[0]}, ${zeroLine}`;\n\n\t\tconst animRegion = [\n\t\t\tpaths.region,\n\t\t\t{d:\"M\" + regStartPt + pointsStr + regEndPt},\n\t\t\tPATH_ANIM_DUR,\n\t\t\tSTD_EASING\n\t\t];\n\t\tpathComponents.push(animRegion);\n\t}\n\n\treturn pathComponents;\n}\n\nfunction animatePathStr(oldPath, pathStr) {\n\treturn [oldPath, {d: pathStr}, UNIT_ANIM_DUR, STD_EASING];\n}\n\n// Leveraging SMIL Animations\n\nconst EASING = {\n\tease: \"0.25 0.1 0.25 1\",\n\tlinear: \"0 0 1 1\",\n\t// easein: \"0.42 0 1 1\",\n\teasein: \"0.1 0.8 0.2 1\",\n\teaseout: \"0 0 0.58 1\",\n\teaseinout: \"0.42 0 0.58 1\"\n};\n\nfunction animateSVGElement(element, props, dur, easingType=\"linear\", type=undefined, oldValues={}) {\n\n\tlet animElement = element.cloneNode(true);\n\tlet newElement = element.cloneNode(true);\n\n\tfor(var attributeName in props) {\n\t\tlet animateElement;\n\t\tif(attributeName === 'transform') {\n\t\t\tanimateElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"animateTransform\");\n\t\t} else {\n\t\t\tanimateElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"animate\");\n\t\t}\n\t\tlet currentValue = oldValues[attributeName] || element.getAttribute(attributeName);\n\t\tlet value = props[attributeName];\n\n\t\tlet animAttr = {\n\t\t\tattributeName: attributeName,\n\t\t\tfrom: currentValue,\n\t\t\tto: value,\n\t\t\tbegin: \"0s\",\n\t\t\tdur: dur/1000 + \"s\",\n\t\t\tvalues: currentValue + \";\" + value,\n\t\t\tkeySplines: EASING[easingType],\n\t\t\tkeyTimes: \"0;1\",\n\t\t\tcalcMode: \"spline\",\n\t\t\tfill: 'freeze'\n\t\t};\n\n\t\tif(type) {\n\t\t\tanimAttr[\"type\"] = type;\n\t\t}\n\n\t\tfor (var i in animAttr) {\n\t\t\tanimateElement.setAttribute(i, animAttr[i]);\n\t\t}\n\n\t\tanimElement.appendChild(animateElement);\n\n\t\tif(type) {\n\t\t\tnewElement.setAttribute(attributeName, `translate(${value})`);\n\t\t} else {\n\t\t\tnewElement.setAttribute(attributeName, value);\n\t\t}\n\t}\n\n\treturn [animElement, newElement];\n}\n\nfunction transform(element, style) { // eslint-disable-line no-unused-vars\n\telement.style.transform = style;\n\telement.style.webkitTransform = style;\n\telement.style.msTransform = style;\n\telement.style.mozTransform = style;\n\telement.style.oTransform = style;\n}\n\nfunction animateSVG(svgContainer, elements) {\n\tlet newElements = [];\n\tlet animElements = [];\n\n\telements.map(element => {\n\t\tlet unit = element[0];\n\t\tlet parent = unit.parentNode;\n\n\t\tlet animElement, newElement;\n\n\t\telement[0] = unit;\n\t\t[animElement, newElement] = animateSVGElement(...element);\n\n\t\tnewElements.push(newElement);\n\t\tanimElements.push([animElement, parent]);\n\n\t\tparent.replaceChild(animElement, unit);\n\t});\n\n\tlet animSvg = svgContainer.cloneNode(true);\n\n\tanimElements.map((animElement, i) => {\n\t\tanimElement[1].replaceChild(newElements[i], animElement[0]);\n\t\telements[i][0] = newElements[i];\n\t});\n\n\treturn animSvg;\n}\n\nfunction runSMILAnimation(parent, svgElement, elementsToAnimate) {\n\tif(elementsToAnimate.length === 0) return;\n\n\tlet animSvgElement = animateSVG(svgElement, elementsToAnimate);\n\tif(svgElement.parentNode == parent) {\n\t\tparent.removeChild(svgElement);\n\t\tparent.appendChild(animSvgElement);\n\n\t}\n\n\t// Replace the new svgElement (data has already been replaced)\n\tsetTimeout(() => {\n\t\tif(animSvgElement.parentNode == parent) {\n\t\t\tparent.removeChild(animSvgElement);\n\t\t\tparent.appendChild(svgElement);\n\t\t}\n\t}, REPLACE_ALL_NEW_DUR);\n}\n\nconst CSSTEXT = \".chart-container{position:relative;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif}.chart-container .axis,.chart-container .chart-label{fill:#555b51}.chart-container .axis line,.chart-container .chart-label line{stroke:#dadada}.chart-container .dataset-units circle{stroke:#fff;stroke-width:2}.chart-container .dataset-units path{fill:none;stroke-opacity:1;stroke-width:2px}.chart-container .dataset-path{stroke-width:2px}.chart-container .path-group path{fill:none;stroke-opacity:1;stroke-width:2px}.chart-container line.dashed{stroke-dasharray:5,3}.chart-container .axis-line .specific-value{text-anchor:start}.chart-container .axis-line .y-line{text-anchor:end}.chart-container .axis-line .x-line{text-anchor:middle}.chart-container .legend-dataset-text{fill:#6c7680;font-weight:600}.graph-svg-tip{position:absolute;z-index:99999;padding:10px;font-size:12px;color:#959da5;text-align:center;background:rgba(0,0,0,.8);border-radius:3px}.graph-svg-tip ul{padding-left:0;display:flex}.graph-svg-tip ol{padding-left:0;display:flex}.graph-svg-tip ul.data-point-list li{min-width:90px;flex:1;font-weight:600}.graph-svg-tip strong{color:#dfe2e5;font-weight:600}.graph-svg-tip .svg-pointer{position:absolute;height:5px;margin:0 0 0 -5px;content:' ';border:5px solid transparent;border-top-color:rgba(0,0,0,.8)}.graph-svg-tip.comparison{padding:0;text-align:left;pointer-events:none}.graph-svg-tip.comparison .title{display:block;padding:10px;margin:0;font-weight:600;line-height:1;pointer-events:none}.graph-svg-tip.comparison ul{margin:0;white-space:nowrap;list-style:none}.graph-svg-tip.comparison li{display:inline-block;padding:5px 10px}\";\n\nfunction downloadFile(filename, data) {\n\tvar a = document.createElement('a');\n\ta.style = \"display: none\";\n\tvar blob = new Blob(data, {type: \"image/svg+xml; charset=utf-8\"});\n\tvar url = window.URL.createObjectURL(blob);\n\ta.href = url;\n\ta.download = filename;\n\tdocument.body.appendChild(a);\n\ta.click();\n\tsetTimeout(function(){\n\t\tdocument.body.removeChild(a);\n\t\twindow.URL.revokeObjectURL(url);\n\t}, 300);\n}\n\nfunction prepareForExport(svg) {\n\tlet clone = svg.cloneNode(true);\n\tclone.classList.add('chart-container');\n\tclone.setAttribute('xmlns', \"http://www.w3.org/2000/svg\");\n\tclone.setAttribute('xmlns:xlink', \"http://www.w3.org/1999/xlink\");\n\tlet styleEl = $.create('style', {\n\t\t'innerHTML': CSSTEXT\n\t});\n\tclone.insertBefore(styleEl, clone.firstChild);\n\n\tlet container = $.create('div');\n\tcontainer.appendChild(clone);\n\n\treturn container.innerHTML;\n}\n\nclass BaseChart {\n\tconstructor(parent, options) {\n\n\t\tthis.parent = typeof parent === 'string'\n\t\t\t? document.querySelector(parent)\n\t\t\t: parent;\n\n\t\tif (!(this.parent instanceof HTMLElement)) {\n\t\t\tthrow new Error('No `parent` element to render on was provided.');\n\t\t}\n\n\t\tthis.rawChartArgs = options;\n\n\t\tthis.title = options.title || '';\n\t\tthis.type = options.type || '';\n\n\t\tthis.realData = this.prepareData(options.data);\n\t\tthis.data = this.prepareFirstData(this.realData);\n\n\t\tthis.colors = this.validateColors(options.colors, this.type);\n\n\t\tthis.config = {\n\t\t\tshowTooltip: 1, // calculate\n\t\t\tshowLegend: 1, // calculate\n\t\t\tisNavigable: options.isNavigable || 0,\n\t\t\tanimate: (typeof options.animate !== 'undefined') ? options.animate : 1,\n\t\t\ttruncateLegends: options.truncateLegends || 1\n\t\t};\n\n\t\tthis.measures = JSON.parse(JSON.stringify(BASE_MEASURES));\n\t\tlet m = this.measures;\n\t\tthis.setMeasures(options);\n\t\tif(!this.title.length) { m.titleHeight = 0; }\n\t\tif(!this.config.showLegend) m.legendHeight = 0;\n\t\tthis.argHeight = options.height || m.baseHeight;\n\n\t\tthis.state = {};\n\t\tthis.options = {};\n\n\t\tthis.initTimeout = INIT_CHART_UPDATE_TIMEOUT;\n\n\t\tif(this.config.isNavigable) {\n\t\t\tthis.overlays = [];\n\t\t}\n\n\t\tthis.configure(options);\n\t}\n\n\tprepareData(data) {\n\t\treturn data;\n\t}\n\n\tprepareFirstData(data) {\n\t\treturn data;\n\t}\n\n\tvalidateColors(colors, type) {\n\t\tconst validColors = [];\n\t\tcolors = (colors || []).concat(DEFAULT_COLORS[type]);\n\t\tcolors.forEach((string) => {\n\t\t\tconst color = getColor(string);\n\t\t\tif(!isValidColor(color)) {\n\t\t\t\tconsole.warn('\"' + string + '\" is not a valid color.');\n\t\t\t} else {\n\t\t\t\tvalidColors.push(color);\n\t\t\t}\n\t\t});\n\t\treturn validColors;\n\t}\n\n\tsetMeasures() {\n\t\t// Override measures, including those for title and legend\n\t\t// set config for legend and title\n\t}\n\n\tconfigure() {\n\t\tlet height = this.argHeight;\n\t\tthis.baseHeight = height;\n\t\tthis.height = height - getExtraHeight(this.measures);\n\n\t\t// Bind window events\n\t\tthis.boundDrawFn = () => this.draw(true);\n\t\twindow.addEventListener('resize', this.boundDrawFn);\n\t\twindow.addEventListener('orientationchange', this.boundDrawFn);\n\t}\n\n\tdestroy() {\n\t\twindow.removeEventListener('resize', this.boundDrawFn);\n\t\twindow.removeEventListener('orientationchange', this.boundDrawFn);\n\t}\n\n\t// Has to be called manually\n\tsetup() {\n\t\tthis.makeContainer();\n\t\tthis.updateWidth();\n\t\tthis.makeTooltip();\n\n\t\tthis.draw(false, true);\n\t}\n\n\tmakeContainer() {\n\t\t// Chart needs a dedicated parent element\n\t\tthis.parent.innerHTML = '';\n\n\t\tlet args = {\n\t\t\tinside: this.parent,\n\t\t\tclassName: 'chart-container'\n\t\t};\n\n\t\tif(this.independentWidth) {\n\t\t\targs.styles = { width: this.independentWidth + 'px' };\n\t\t}\n\n\t\tthis.container = $.create('div', args);\n\t}\n\n\tmakeTooltip() {\n\t\tthis.tip = new SvgTip({\n\t\t\tparent: this.container,\n\t\t\tcolors: this.colors\n\t\t});\n\t\tthis.bindTooltip();\n\t}\n\n\tbindTooltip() {}\n\n\tdraw(onlyWidthChange=false, init=false) {\n\t\tif (onlyWidthChange && isHidden(this.parent)) {\n\t\t\t// Don't update anything if the chart is hidden\n\t\t\treturn;\n\t\t}\n\t\tthis.updateWidth();\n\n\t\tthis.calc(onlyWidthChange);\n\t\tthis.makeChartArea();\n\t\tthis.setupComponents();\n\n\t\tthis.components.forEach(c => c.setup(this.drawArea));\n\t\t// this.components.forEach(c => c.make());\n\t\tthis.render(this.components, false);\n\n\t\tif(init) {\n\t\t\tthis.data = this.realData;\n\t\t\tsetTimeout(() => {this.update(this.data);}, this.initTimeout);\n\t\t}\n\n\t\tthis.renderLegend();\n\n\t\tthis.setupNavigation(init);\n\t}\n\n\tcalc() {} // builds state\n\n\tupdateWidth() {\n\t\tthis.baseWidth = getElementContentWidth(this.parent);\n\t\tthis.width = this.baseWidth - getExtraWidth(this.measures);\n\t}\n\n\tmakeChartArea() {\n\t\tif(this.svg) {\n\t\t\tthis.container.removeChild(this.svg);\n\t\t}\n\t\tlet m = this.measures;\n\n\t\tthis.svg = makeSVGContainer(\n\t\t\tthis.container,\n\t\t\t'frappe-chart chart',\n\t\t\tthis.baseWidth,\n\t\t\tthis.baseHeight\n\t\t);\n\t\tthis.svgDefs = makeSVGDefs(this.svg);\n\n\t\tif(this.title.length) {\n\t\t\tthis.titleEL = makeText(\n\t\t\t\t'title',\n\t\t\t\tm.margins.left,\n\t\t\t\tm.margins.top,\n\t\t\t\tthis.title,\n\t\t\t\t{\n\t\t\t\t\tfontSize: m.titleFontSize,\n\t\t\t\t\tfill: '#666666',\n\t\t\t\t\tdy: m.titleFontSize\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tlet top = getTopOffset(m);\n\t\tthis.drawArea = makeSVGGroup(\n\t\t\tthis.type + '-chart chart-draw-area',\n\t\t\t`translate(${getLeftOffset(m)}, ${top})`\n\t\t);\n\n\t\tif(this.config.showLegend) {\n\t\t\ttop += this.height + m.paddings.bottom;\n\t\t\tthis.legendArea = makeSVGGroup(\n\t\t\t\t'chart-legend',\n\t\t\t\t`translate(${getLeftOffset(m)}, ${top})`\n\t\t\t);\n\t\t}\n\n\t\tif(this.title.length) { this.svg.appendChild(this.titleEL); }\n\t\tthis.svg.appendChild(this.drawArea);\n\t\tif(this.config.showLegend) { this.svg.appendChild(this.legendArea); }\n\n\t\tthis.updateTipOffset(getLeftOffset(m), getTopOffset(m));\n\t}\n\n\tupdateTipOffset(x, y) {\n\t\tthis.tip.offset = {\n\t\t\tx: x,\n\t\t\ty: y\n\t\t};\n\t}\n\n\tsetupComponents() { this.components = new Map(); }\n\n\tupdate(data) {\n\t\tif(!data) {\n\t\t\tconsole.error('No data to update.');\n\t\t}\n\t\tthis.data = this.prepareData(data);\n\t\tthis.calc(); // builds state\n\t\tthis.render(this.components, this.config.animate);\n\t}\n\n\trender(components=this.components, animate=true) {\n\t\tif(this.config.isNavigable) {\n\t\t\t// Remove all existing overlays\n\t\t\tthis.overlays.map(o => o.parentNode.removeChild(o));\n\t\t\t// ref.parentNode.insertBefore(element, ref);\n\t\t}\n\t\tlet elementsToAnimate = [];\n\t\t// Can decouple to this.refreshComponents() first to save animation timeout\n\t\tcomponents.forEach(c => {\n\t\t\telementsToAnimate = elementsToAnimate.concat(c.update(animate));\n\t\t});\n\t\tif(elementsToAnimate.length > 0) {\n\t\t\trunSMILAnimation(this.container, this.svg, elementsToAnimate);\n\t\t\tsetTimeout(() => {\n\t\t\t\tcomponents.forEach(c => c.make());\n\t\t\t\tthis.updateNav();\n\t\t\t}, CHART_POST_ANIMATE_TIMEOUT);\n\t\t} else {\n\t\t\tcomponents.forEach(c => c.make());\n\t\t\tthis.updateNav();\n\t\t}\n\t}\n\n\tupdateNav() {\n\t\tif(this.config.isNavigable) {\n\t\t\tthis.makeOverlay();\n\t\t\tthis.bindUnits();\n\t\t}\n\t}\n\n\trenderLegend() {}\n\n\tsetupNavigation(init=false) {\n\t\tif(!this.config.isNavigable) return;\n\n\t\tif(init) {\n\t\t\tthis.bindOverlay();\n\n\t\t\tthis.keyActions = {\n\t\t\t\t'13': this.onEnterKey.bind(this),\n\t\t\t\t'37': this.onLeftArrow.bind(this),\n\t\t\t\t'38': this.onUpArrow.bind(this),\n\t\t\t\t'39': this.onRightArrow.bind(this),\n\t\t\t\t'40': this.onDownArrow.bind(this),\n\t\t\t};\n\n\t\t\tdocument.addEventListener('keydown', (e) => {\n\t\t\t\tif(isElementInViewport(this.container)) {\n\t\t\t\t\te = e || window.event;\n\t\t\t\t\tif(this.keyActions[e.keyCode]) {\n\t\t\t\t\t\tthis.keyActions[e.keyCode]();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tmakeOverlay() {}\n\tupdateOverlay() {}\n\tbindOverlay() {}\n\tbindUnits() {}\n\n\tonLeftArrow() {}\n\tonRightArrow() {}\n\tonUpArrow() {}\n\tonDownArrow() {}\n\tonEnterKey() {}\n\n\taddDataPoint() {}\n\tremoveDataPoint() {}\n\n\tgetDataPoint() {}\n\tsetCurrentDataPoint() {}\n\n\tupdateDataset() {}\n\n\texport() {\n\t\tlet chartSvg = prepareForExport(this.svg);\n\t\tdownloadFile(this.title || 'Chart', [chartSvg]);\n\t}\n}\n\nclass AggregationChart extends BaseChart {\n\tconstructor(parent, args) {\n\t\tsuper(parent, args);\n\t}\n\n\tconfigure(args) {\n\t\tsuper.configure(args);\n\n\t\tthis.config.maxSlices = args.maxSlices || 20;\n\t\tthis.config.maxLegendPoints = args.maxLegendPoints || 20;\n\t}\n\n\tcalc() {\n\t\tlet s = this.state;\n\t\tlet maxSlices = this.config.maxSlices;\n\t\ts.sliceTotals = [];\n\n\t\tlet allTotals = this.data.labels.map((label, i) => {\n\t\t\tlet total = 0;\n\t\t\tthis.data.datasets.map(e => {\n\t\t\t\ttotal += e.values[i];\n\t\t\t});\n\t\t\treturn [total, label];\n\t\t}).filter(d => { return d[0] >= 0; }); // keep only positive results\n\n\t\tlet totals = allTotals;\n\t\tif(allTotals.length > maxSlices) {\n\t\t\t// Prune and keep a grey area for rest as per maxSlices\n\t\t\tallTotals.sort((a, b) => { return b[0] - a[0]; });\n\n\t\t\ttotals = allTotals.slice(0, maxSlices-1);\n\t\t\tlet remaining = allTotals.slice(maxSlices-1);\n\n\t\t\tlet sumOfRemaining = 0;\n\t\t\tremaining.map(d => {sumOfRemaining += d[0];});\n\t\t\ttotals.push([sumOfRemaining, 'Rest']);\n\t\t\tthis.colors[maxSlices-1] = 'grey';\n\t\t}\n\n\t\ts.labels = [];\n\t\ttotals.map(d => {\n\t\t\ts.sliceTotals.push(d[0]);\n\t\t\ts.labels.push(d[1]);\n\t\t});\n\n\t\ts.grandTotal = s.sliceTotals.reduce((a, b) => a + b, 0);\n\n\t\tthis.center = {\n\t\t\tx: this.width / 2,\n\t\t\ty: this.height / 2\n\t\t};\n\t}\n\n\trenderLegend() {\n\t\tlet s = this.state;\n\t\tthis.legendArea.textContent = '';\n\t\tthis.legendTotals = s.sliceTotals.slice(0, this.config.maxLegendPoints);\n\n\t\tlet count = 0;\n\t\tlet y = 0;\n\t\tthis.legendTotals.map((d, i) => {\n\t\t\tlet barWidth = 150;\n\t\t\tlet divisor = Math.floor(\n\t\t\t\t(this.width - getExtraWidth(this.measures))/barWidth\n\t\t\t);\n\t\t\tif (this.legendTotals.length < divisor) {\n\t\t\t\tbarWidth = this.width/this.legendTotals.length;\n\t\t\t}\n\t\t\tif(count > divisor) {\n\t\t\t\tcount = 0;\n\t\t\t\ty += 20;\n\t\t\t}\n\t\t\tlet x = barWidth * count + 5;\n\t\t\tlet label = this.config.truncateLegends ? truncateString(s.labels[i], barWidth/10) : s.labels[i];\n\t\t\tlet dot = legendDot(\n\t\t\t\tx,\n\t\t\t\ty,\n\t\t\t\t5,\n\t\t\t\tthis.colors[i],\n\t\t\t\t`${label}: ${d}`,\n\t\t\t\tfalse\n\t\t\t);\n\t\t\tthis.legendArea.appendChild(dot);\n\t\t\tcount++;\n\t\t});\n\t}\n}\n\n// Playing around with dates\n\nconst NO_OF_YEAR_MONTHS = 12;\nconst NO_OF_DAYS_IN_WEEK = 7;\n\nconst NO_OF_MILLIS = 1000;\nconst SEC_IN_DAY = 86400;\n\nconst MONTH_NAMES = [\"January\", \"February\", \"March\", \"April\", \"May\",\n\t\"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"];\n\n\nconst DAY_NAMES_SHORT = [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"];\n\n\n// https://stackoverflow.com/a/11252167/6495043\nfunction treatAsUtc(date) {\n\tlet result = new Date(date);\n\tresult.setMinutes(result.getMinutes() - result.getTimezoneOffset());\n\treturn result;\n}\n\nfunction getYyyyMmDd(date) {\n\tlet dd = date.getDate();\n\tlet mm = date.getMonth() + 1; // getMonth() is zero-based\n\treturn [\n\t\tdate.getFullYear(),\n\t\t(mm>9 ? '' : '0') + mm,\n\t\t(dd>9 ? '' : '0') + dd\n\t].join('-');\n}\n\nfunction clone(date) {\n\treturn new Date(date.getTime());\n}\n\n\n\n\n\n// export function getMonthsBetween(startDate, endDate) {}\n\nfunction getWeeksBetween(startDate, endDate) {\n\tlet weekStartDate = setDayToSunday(startDate);\n\treturn Math.ceil(getDaysBetween(weekStartDate, endDate) / NO_OF_DAYS_IN_WEEK);\n}\n\nfunction getDaysBetween(startDate, endDate) {\n\tlet millisecondsPerDay = SEC_IN_DAY * NO_OF_MILLIS;\n\treturn (treatAsUtc(endDate) - treatAsUtc(startDate)) / millisecondsPerDay;\n}\n\nfunction areInSameMonth(startDate, endDate) {\n\treturn startDate.getMonth() === endDate.getMonth()\n\t\t&& startDate.getFullYear() === endDate.getFullYear();\n}\n\nfunction getMonthName(i, short=false) {\n\tlet monthName = MONTH_NAMES[i];\n\treturn short ? monthName.slice(0, 3) : monthName;\n}\n\nfunction getLastDateInMonth (month, year) {\n\treturn new Date(year, month + 1, 0); // 0: last day in previous month\n}\n\n// mutates\nfunction setDayToSunday(date) {\n\tlet newDate = clone(date);\n\tconst day = newDate.getDay();\n\tif(day !== 0) {\n\t\taddDays(newDate, (-1) * day);\n\t}\n\treturn newDate;\n}\n\n// mutates\nfunction addDays(date, numberOfDays) {\n\tdate.setDate(date.getDate() + numberOfDays);\n}\n\nclass ChartComponent {\n\tconstructor({\n\t\tlayerClass = '',\n\t\tlayerTransform = '',\n\t\tconstants,\n\n\t\tgetData,\n\t\tmakeElements,\n\t\tanimateElements\n\t}) {\n\t\tthis.layerTransform = layerTransform;\n\t\tthis.constants = constants;\n\n\t\tthis.makeElements = makeElements;\n\t\tthis.getData = getData;\n\n\t\tthis.animateElements = animateElements;\n\n\t\tthis.store = [];\n\t\tthis.labels = [];\n\n\t\tthis.layerClass = layerClass;\n\t\tthis.layerClass = typeof(this.layerClass) === 'function'\n\t\t\t? this.layerClass() : this.layerClass;\n\n\t\tthis.refresh();\n\t}\n\n\trefresh(data) {\n\t\tthis.data = data || this.getData();\n\t}\n\n\tsetup(parent) {\n\t\tthis.layer = makeSVGGroup(this.layerClass, this.layerTransform, parent);\n\t}\n\n\tmake() {\n\t\tthis.render(this.data);\n\t\tthis.oldData = this.data;\n\t}\n\n\trender(data) {\n\t\tthis.store = this.makeElements(data);\n\n\t\tthis.layer.textContent = '';\n\t\tthis.store.forEach(element => {\n\t\t\tthis.layer.appendChild(element);\n\t\t});\n\t\tthis.labels.forEach(element => {\n\t\t\tthis.layer.appendChild(element);\n\t\t});\n\t}\n\n\tupdate(animate = true) {\n\t\tthis.refresh();\n\t\tlet animateElements = [];\n\t\tif(animate) {\n\t\t\tanimateElements = this.animateElements(this.data) || [];\n\t\t}\n\t\treturn animateElements;\n\t}\n}\n\nlet componentConfigs = {\n\tdonutSlices: {\n\t\tlayerClass: 'donut-slices',\n\t\tmakeElements(data) {\n\t\t\treturn data.sliceStrings.map((s, i) => {\n\t\t\t\tlet slice = makePath(s, 'donut-path', data.colors[i], 'none', data.strokeWidth);\n\t\t\t\tslice.style.transition = 'transform .3s;';\n\t\t\t\treturn slice;\n\t\t\t});\n\t\t},\n\n\t\tanimateElements(newData) {\n\t\t\treturn this.store.map((slice, i) => animatePathStr(slice, newData.sliceStrings[i]));\n\t\t},\n\t},\n\tpieSlices: {\n\t\tlayerClass: 'pie-slices',\n\t\tmakeElements(data) {\n\t\t\treturn data.sliceStrings.map((s, i) =>{\n\t\t\t\tlet slice = makePath(s, 'pie-path', 'none', data.colors[i]);\n\t\t\t\tslice.style.transition = 'transform .3s;';\n\t\t\t\treturn slice;\n\t\t\t});\n\t\t},\n\n\t\tanimateElements(newData) {\n\t\t\treturn this.store.map((slice, i) =>\n\t\t\t\tanimatePathStr(slice, newData.sliceStrings[i])\n\t\t\t);\n\t\t}\n\t},\n\tpercentageBars: {\n\t\tlayerClass: 'percentage-bars',\n\t\tmakeElements(data) {\n\t\t\treturn data.xPositions.map((x, i) =>{\n\t\t\t\tlet y = 0;\n\t\t\t\tlet bar = percentageBar(x, y, data.widths[i],\n\t\t\t\t\tthis.constants.barHeight, this.constants.barDepth, data.colors[i]);\n\t\t\t\treturn bar;\n\t\t\t});\n\t\t},\n\n\t\tanimateElements(newData) {\n\t\t\tif(newData) return [];\n\t\t}\n\t},\n\tyAxis: {\n\t\tlayerClass: 'y axis',\n\t\tmakeElements(data) {\n\t\t\treturn data.positions.map((position, i) =>\n\t\t\t\tyLine(position, data.labels[i], this.constants.width,\n\t\t\t\t\t{mode: this.constants.mode, pos: this.constants.pos, shortenNumbers: this.constants.shortenNumbers})\n\t\t\t);\n\t\t},\n\n\t\tanimateElements(newData) {\n\t\t\tlet newPos = newData.positions;\n\t\t\tlet newLabels = newData.labels;\n\t\t\tlet oldPos = this.oldData.positions;\n\t\t\tlet oldLabels = this.oldData.labels;\n\n\t\t\t[oldPos, newPos] = equilizeNoOfElements(oldPos, newPos);\n\t\t\t[oldLabels, newLabels] = equilizeNoOfElements(oldLabels, newLabels);\n\n\t\t\tthis.render({\n\t\t\t\tpositions: oldPos,\n\t\t\t\tlabels: newLabels\n\t\t\t});\n\n\t\t\treturn this.store.map((line, i) => {\n\t\t\t\treturn translateHoriLine(\n\t\t\t\t\tline, newPos[i], oldPos[i]\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t},\n\n\txAxis: {\n\t\tlayerClass: 'x axis',\n\t\tmakeElements(data) {\n\t\t\treturn data.positions.map((position, i) =>\n\t\t\t\txLine(position, data.calcLabels[i], this.constants.height,\n\t\t\t\t\t{mode: this.constants.mode, pos: this.constants.pos})\n\t\t\t);\n\t\t},\n\n\t\tanimateElements(newData) {\n\t\t\tlet newPos = newData.positions;\n\t\t\tlet newLabels = newData.calcLabels;\n\t\t\tlet oldPos = this.oldData.positions;\n\t\t\tlet oldLabels = this.oldData.calcLabels;\n\n\t\t\t[oldPos, newPos] = equilizeNoOfElements(oldPos, newPos);\n\t\t\t[oldLabels, newLabels] = equilizeNoOfElements(oldLabels, newLabels);\n\n\t\t\tthis.render({\n\t\t\t\tpositions: oldPos,\n\t\t\t\tcalcLabels: newLabels\n\t\t\t});\n\n\t\t\treturn this.store.map((line, i) => {\n\t\t\t\treturn translateVertLine(\n\t\t\t\t\tline, newPos[i], oldPos[i]\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t},\n\n\tyMarkers: {\n\t\tlayerClass: 'y-markers',\n\t\tmakeElements(data) {\n\t\t\treturn data.map(m =>\n\t\t\t\tyMarker(m.position, m.label, this.constants.width,\n\t\t\t\t\t{labelPos: m.options.labelPos, mode: 'span', lineType: 'dashed'})\n\t\t\t);\n\t\t},\n\t\tanimateElements(newData) {\n\t\t\t[this.oldData, newData] = equilizeNoOfElements(this.oldData, newData);\n\n\t\t\tlet newPos = newData.map(d => d.position);\n\t\t\tlet newLabels = newData.map(d => d.label);\n\t\t\tlet newOptions = newData.map(d => d.options);\n\n\t\t\tlet oldPos = this.oldData.map(d => d.position);\n\n\t\t\tthis.render(oldPos.map((pos, i) => {\n\t\t\t\treturn {\n\t\t\t\t\tposition: oldPos[i],\n\t\t\t\t\tlabel: newLabels[i],\n\t\t\t\t\toptions: newOptions[i]\n\t\t\t\t};\n\t\t\t}));\n\n\t\t\treturn this.store.map((line, i) => {\n\t\t\t\treturn translateHoriLine(\n\t\t\t\t\tline, newPos[i], oldPos[i]\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t},\n\n\tyRegions: {\n\t\tlayerClass: 'y-regions',\n\t\tmakeElements(data) {\n\t\t\treturn data.map(r =>\n\t\t\t\tyRegion(r.startPos, r.endPos, this.constants.width,\n\t\t\t\t\tr.label, {labelPos: r.options.labelPos})\n\t\t\t);\n\t\t},\n\t\tanimateElements(newData) {\n\t\t\t[this.oldData, newData] = equilizeNoOfElements(this.oldData, newData);\n\n\t\t\tlet newPos = newData.map(d => d.endPos);\n\t\t\tlet newLabels = newData.map(d => d.label);\n\t\t\tlet newStarts = newData.map(d => d.startPos);\n\t\t\tlet newOptions = newData.map(d => d.options);\n\n\t\t\tlet oldPos = this.oldData.map(d => d.endPos);\n\t\t\tlet oldStarts = this.oldData.map(d => d.startPos);\n\n\t\t\tthis.render(oldPos.map((pos, i) => {\n\t\t\t\treturn {\n\t\t\t\t\tstartPos: oldStarts[i],\n\t\t\t\t\tendPos: oldPos[i],\n\t\t\t\t\tlabel: newLabels[i],\n\t\t\t\t\toptions: newOptions[i]\n\t\t\t\t};\n\t\t\t}));\n\n\t\t\tlet animateElements = [];\n\n\t\t\tthis.store.map((rectGroup, i) => {\n\t\t\t\tanimateElements = animateElements.concat(animateRegion(\n\t\t\t\t\trectGroup, newStarts[i], newPos[i], oldPos[i]\n\t\t\t\t));\n\t\t\t});\n\n\t\t\treturn animateElements;\n\t\t}\n\t},\n\n\theatDomain: {\n\t\tlayerClass: function() { return 'heat-domain domain-' + this.constants.index; },\n\t\tmakeElements(data) {\n\t\t\tlet {index, colWidth, rowHeight, squareSize, radius, xTranslate} = this.constants;\n\t\t\tlet monthNameHeight = -12;\n\t\t\tlet x = xTranslate, y = 0;\n\n\t\t\tthis.serializedSubDomains = [];\n\n\t\t\tdata.cols.map((week, weekNo) => {\n\t\t\t\tif(weekNo === 1) {\n\t\t\t\t\tthis.labels.push(\n\t\t\t\t\t\tmakeText('domain-name', x, monthNameHeight, getMonthName(index, true).toUpperCase(),\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfontSize: 9\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tweek.map((day, i) => {\n\t\t\t\t\tif(day.fill) {\n\t\t\t\t\t\tlet data = {\n\t\t\t\t\t\t\t'data-date': day.yyyyMmDd,\n\t\t\t\t\t\t\t'data-value': day.dataValue,\n\t\t\t\t\t\t\t'data-day': i\n\t\t\t\t\t\t};\n\t\t\t\t\t\tlet square = heatSquare('day', x, y, squareSize, radius, day.fill, data);\n\t\t\t\t\t\tthis.serializedSubDomains.push(square);\n\t\t\t\t\t}\n\t\t\t\t\ty += rowHeight;\n\t\t\t\t});\n\t\t\t\ty = 0;\n\t\t\t\tx += colWidth;\n\t\t\t});\n\n\t\t\treturn this.serializedSubDomains;\n\t\t},\n\n\t\tanimateElements(newData) {\n\t\t\tif(newData) return [];\n\t\t}\n\t},\n\n\tbarGraph: {\n\t\tlayerClass: function() { return 'dataset-units dataset-bars dataset-' + this.constants.index; },\n\t\tmakeElements(data) {\n\t\t\tlet c = this.constants;\n\t\t\tthis.unitType = 'bar';\n\t\t\tthis.units = data.yPositions.map((y, j) => {\n\t\t\t\treturn datasetBar(\n\t\t\t\t\tdata.xPositions[j],\n\t\t\t\t\ty,\n\t\t\t\t\tdata.barWidth,\n\t\t\t\t\tc.color,\n\t\t\t\t\tdata.labels[j],\n\t\t\t\t\tj,\n\t\t\t\t\tdata.offsets[j],\n\t\t\t\t\t{\n\t\t\t\t\t\tzeroLine: data.zeroLine,\n\t\t\t\t\t\tbarsWidth: data.barsWidth,\n\t\t\t\t\t\tminHeight: c.minHeight\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t});\n\t\t\treturn this.units;\n\t\t},\n\t\tanimateElements(newData) {\n\t\t\tlet newXPos = newData.xPositions;\n\t\t\tlet newYPos = newData.yPositions;\n\t\t\tlet newOffsets = newData.offsets;\n\t\t\tlet newLabels = newData.labels;\n\n\t\t\tlet oldXPos = this.oldData.xPositions;\n\t\t\tlet oldYPos = this.oldData.yPositions;\n\t\t\tlet oldOffsets = this.oldData.offsets;\n\t\t\tlet oldLabels = this.oldData.labels;\n\n\t\t\t[oldXPos, newXPos] = equilizeNoOfElements(oldXPos, newXPos);\n\t\t\t[oldYPos, newYPos] = equilizeNoOfElements(oldYPos, newYPos);\n\t\t\t[oldOffsets, newOffsets] = equilizeNoOfElements(oldOffsets, newOffsets);\n\t\t\t[oldLabels, newLabels] = equilizeNoOfElements(oldLabels, newLabels);\n\n\t\t\tthis.render({\n\t\t\t\txPositions: oldXPos,\n\t\t\t\tyPositions: oldYPos,\n\t\t\t\toffsets: oldOffsets,\n\t\t\t\tlabels: newLabels,\n\n\t\t\t\tzeroLine: this.oldData.zeroLine,\n\t\t\t\tbarsWidth: this.oldData.barsWidth,\n\t\t\t\tbarWidth: this.oldData.barWidth,\n\t\t\t});\n\n\t\t\tlet animateElements = [];\n\n\t\t\tthis.store.map((bar, i) => {\n\t\t\t\tanimateElements = animateElements.concat(animateBar(\n\t\t\t\t\tbar, newXPos[i], newYPos[i], newData.barWidth, newOffsets[i],\n\t\t\t\t\t{zeroLine: newData.zeroLine}\n\t\t\t\t));\n\t\t\t});\n\n\t\t\treturn animateElements;\n\t\t}\n\t},\n\n\tlineGraph: {\n\t\tlayerClass: function() { return 'dataset-units dataset-line dataset-' + this.constants.index; },\n\t\tmakeElements(data) {\n\t\t\tlet c = this.constants;\n\t\t\tthis.unitType = 'dot';\n\t\t\tthis.paths = {};\n\t\t\tif(!c.hideLine) {\n\t\t\t\tthis.paths = getPaths(\n\t\t\t\t\tdata.xPositions,\n\t\t\t\t\tdata.yPositions,\n\t\t\t\t\tc.color,\n\t\t\t\t\t{\n\t\t\t\t\t\theatline: c.heatline,\n\t\t\t\t\t\tregionFill: c.regionFill,\n\t\t\t\t\t\tspline: c.spline\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tsvgDefs: c.svgDefs,\n\t\t\t\t\t\tzeroLine: data.zeroLine\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tthis.units = [];\n\t\t\tif(!c.hideDots) {\n\t\t\t\tthis.units = data.yPositions.map((y, j) => {\n\t\t\t\t\treturn datasetDot(\n\t\t\t\t\t\tdata.xPositions[j],\n\t\t\t\t\t\ty,\n\t\t\t\t\t\tdata.radius,\n\t\t\t\t\t\tc.color,\n\t\t\t\t\t\t(c.valuesOverPoints ? data.values[j] : ''),\n\t\t\t\t\t\tj\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn Object.values(this.paths).concat(this.units);\n\t\t},\n\t\tanimateElements(newData) {\n\t\t\tlet newXPos = newData.xPositions;\n\t\t\tlet newYPos = newData.yPositions;\n\t\t\tlet newValues = newData.values;\n\n\t\t\tlet oldXPos = this.oldData.xPositions;\n\t\t\tlet oldYPos = this.oldData.yPositions;\n\t\t\tlet oldValues = this.oldData.values;\n\n\t\t\t[oldXPos, newXPos] = equilizeNoOfElements(oldXPos, newXPos);\n\t\t\t[oldYPos, newYPos] = equilizeNoOfElements(oldYPos, newYPos);\n\t\t\t[oldValues, newValues] = equilizeNoOfElements(oldValues, newValues);\n\n\t\t\tthis.render({\n\t\t\t\txPositions: oldXPos,\n\t\t\t\tyPositions: oldYPos,\n\t\t\t\tvalues: newValues,\n\n\t\t\t\tzeroLine: this.oldData.zeroLine,\n\t\t\t\tradius: this.oldData.radius,\n\t\t\t});\n\n\t\t\tlet animateElements = [];\n\n\t\t\tif(Object.keys(this.paths).length) {\n\t\t\t\tanimateElements = animateElements.concat(animatePath(\n\t\t\t\t\tthis.paths, newXPos, newYPos, newData.zeroLine, this.constants.spline));\n\t\t\t}\n\n\t\t\tif(this.units.length) {\n\t\t\t\tthis.units.map((dot, i) => {\n\t\t\t\t\tanimateElements = animateElements.concat(animateDot(\n\t\t\t\t\t\tdot, newXPos[i], newYPos[i]));\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn animateElements;\n\t\t}\n\t}\n};\n\nfunction getComponent(name, constants, getData) {\n\tlet keys = Object.keys(componentConfigs).filter(k => name.includes(k));\n\tlet config = componentConfigs[keys[0]];\n\tObject.assign(config, {\n\t\tconstants: constants,\n\t\tgetData: getData\n\t});\n\treturn new ChartComponent(config);\n}\n\nclass PercentageChart extends AggregationChart {\n\tconstructor(parent, args) {\n\t\tsuper(parent, args);\n\t\tthis.type = 'percentage';\n\t\tthis.setup();\n\t}\n\n\tsetMeasures(options) {\n\t\tlet m = this.measures;\n\t\tthis.barOptions = options.barOptions || {};\n\n\t\tlet b = this.barOptions;\n\t\tb.height = b.height || PERCENTAGE_BAR_DEFAULT_HEIGHT;\n\t\tb.depth = b.depth || PERCENTAGE_BAR_DEFAULT_DEPTH;\n\n\t\tm.paddings.right = 30;\n\t\tm.legendHeight = 60;\n\t\tm.baseHeight = (b.height + b.depth * 0.5) * 8;\n\t}\n\n\tsetupComponents() {\n\t\tlet s = this.state;\n\n\t\tlet componentConfigs = [\n\t\t\t[\n\t\t\t\t'percentageBars',\n\t\t\t\t{\n\t\t\t\t\tbarHeight: this.barOptions.height,\n\t\t\t\t\tbarDepth: this.barOptions.depth,\n\t\t\t\t},\n\t\t\t\tfunction() {\n\t\t\t\t\treturn {\n\t\t\t\t\t\txPositions: s.xPositions,\n\t\t\t\t\t\twidths: s.widths,\n\t\t\t\t\t\tcolors: this.colors\n\t\t\t\t\t};\n\t\t\t\t}.bind(this)\n\t\t\t]\n\t\t];\n\n\t\tthis.components = new Map(componentConfigs\n\t\t\t.map(args => {\n\t\t\t\tlet component = getComponent(...args);\n\t\t\t\treturn [args[0], component];\n\t\t\t}));\n\t}\n\n\tcalc() {\n\t\tsuper.calc();\n\t\tlet s = this.state;\n\n\t\ts.xPositions = [];\n\t\ts.widths = [];\n\n\t\tlet xPos = 0;\n\t\ts.sliceTotals.map((value) => {\n\t\t\tlet width = this.width * value / s.grandTotal;\n\t\t\ts.widths.push(width);\n\t\t\ts.xPositions.push(xPos);\n\t\t\txPos += width;\n\t\t});\n\t}\n\n\tmakeDataByIndex() { }\n\n\tbindTooltip() {\n\t\tlet s = this.state;\n\t\tthis.container.addEventListener('mousemove', (e) => {\n\t\t\tlet bars = this.components.get('percentageBars').store;\n\t\t\tlet bar = e.target;\n\t\t\tif(bars.includes(bar)) {\n\n\t\t\t\tlet i = bars.indexOf(bar);\n\t\t\t\tlet gOff = getOffset(this.container), pOff = getOffset(bar);\n\n\t\t\t\tlet x = pOff.left - gOff.left + parseInt(bar.getAttribute('width'))/2;\n\t\t\t\tlet y = pOff.top - gOff.top;\n\t\t\t\tlet title = (this.formattedLabels && this.formattedLabels.length>0\n\t\t\t\t\t? this.formattedLabels[i] : this.state.labels[i]) + ': ';\n\t\t\t\tlet fraction = s.sliceTotals[i]/s.grandTotal;\n\n\t\t\t\tthis.tip.setValues(x, y, {name: title, value: (fraction*100).toFixed(1) + \"%\"});\n\t\t\t\tthis.tip.showTip();\n\t\t\t}\n\t\t});\n\t}\n}\n\nclass PieChart extends AggregationChart {\n\tconstructor(parent, args) {\n\t\tsuper(parent, args);\n\t\tthis.type = 'pie';\n\t\tthis.initTimeout = 0;\n\t\tthis.init = 1;\n\n\t\tthis.setup();\n\t}\n\n\tconfigure(args) {\n\t\tsuper.configure(args);\n\t\tthis.mouseMove = this.mouseMove.bind(this);\n\t\tthis.mouseLeave = this.mouseLeave.bind(this);\n\n\t\tthis.hoverRadio = args.hoverRadio || 0.1;\n\t\tthis.config.startAngle = args.startAngle || 0;\n\n\t\tthis.clockWise = args.clockWise || false;\n\t}\n\n\tcalc() {\n\t\tsuper.calc();\n\t\tlet s = this.state;\n\t\tthis.radius = (this.height > this.width ? this.center.x : this.center.y);\n\n\t\tconst { radius, clockWise } = this;\n\n\t\tconst prevSlicesProperties = s.slicesProperties || [];\n\t\ts.sliceStrings = [];\n\t\ts.slicesProperties = [];\n\t\tlet curAngle = 180 - this.config.startAngle;\n\t\ts.sliceTotals.map((total, i) => {\n\t\t\tconst startAngle = curAngle;\n\t\t\tconst originDiffAngle = (total / s.grandTotal) * FULL_ANGLE;\n\t\t\tconst largeArc = originDiffAngle > 180 ? 1: 0;\n\t\t\tconst diffAngle = clockWise ? -originDiffAngle : originDiffAngle;\n\t\t\tconst endAngle = curAngle = curAngle + diffAngle;\n\t\t\tconst startPosition = getPositionByAngle(startAngle, radius);\n\t\t\tconst endPosition = getPositionByAngle(endAngle, radius);\n\n\t\t\tconst prevProperty = this.init && prevSlicesProperties[i];\n\n\t\t\tlet curStart,curEnd;\n\t\t\tif(this.init) {\n\t\t\t\tcurStart = prevProperty ? prevProperty.startPosition : startPosition;\n\t\t\t\tcurEnd = prevProperty ? prevProperty.endPosition : startPosition;\n\t\t\t} else {\n\t\t\t\tcurStart = startPosition;\n\t\t\t\tcurEnd = endPosition;\n\t\t\t}\n\t\t\tconst curPath =\n\t\t\t\toriginDiffAngle === 360\n\t\t\t\t\t? makeCircleStr(curStart, curEnd, this.center, this.radius, clockWise, largeArc)\n\t\t\t\t\t: makeArcPathStr(curStart, curEnd, this.center, this.radius, clockWise, largeArc);\n\n\t\t\ts.sliceStrings.push(curPath);\n\t\t\ts.slicesProperties.push({\n\t\t\t\tstartPosition,\n\t\t\t\tendPosition,\n\t\t\t\tvalue: total,\n\t\t\t\ttotal: s.grandTotal,\n\t\t\t\tstartAngle,\n\t\t\t\tendAngle,\n\t\t\t\tangle: diffAngle\n\t\t\t});\n\n\t\t});\n\t\tthis.init = 0;\n\t}\n\n\tsetupComponents() {\n\t\tlet s = this.state;\n\n\t\tlet componentConfigs = [\n\t\t\t[\n\t\t\t\t'pieSlices',\n\t\t\t\t{ },\n\t\t\t\tfunction() {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tsliceStrings: s.sliceStrings,\n\t\t\t\t\t\tcolors: this.colors\n\t\t\t\t\t};\n\t\t\t\t}.bind(this)\n\t\t\t]\n\t\t];\n\n\t\tthis.components = new Map(componentConfigs\n\t\t\t.map(args => {\n\t\t\t\tlet component = getComponent(...args);\n\t\t\t\treturn [args[0], component];\n\t\t\t}));\n\t}\n\n\tcalTranslateByAngle(property){\n\t\tconst{radius,hoverRadio} = this;\n\t\tconst position = getPositionByAngle(property.startAngle+(property.angle / 2),radius);\n\t\treturn `translate3d(${(position.x) * hoverRadio}px,${(position.y) * hoverRadio}px,0)`;\n\t}\n\n\thoverSlice(path,i,flag,e){\n\t\tif(!path) return;\n\t\tconst color = this.colors[i];\n\t\tif(flag) {\n\t\t\ttransform(path, this.calTranslateByAngle(this.state.slicesProperties[i]));\n\t\t\tpath.style.fill = lightenDarkenColor(color, 50);\n\t\t\tlet g_off = getOffset(this.svg);\n\t\t\tlet x = e.pageX - g_off.left + 10;\n\t\t\tlet y = e.pageY - g_off.top - 10;\n\t\t\tlet title = (this.formatted_labels && this.formatted_labels.length > 0\n\t\t\t\t? this.formatted_labels[i] : this.state.labels[i]) + ': ';\n\t\t\tlet percent = (this.state.sliceTotals[i] * 100 / this.state.grandTotal).toFixed(1);\n\t\t\tthis.tip.setValues(x, y, {name: title, value: percent + \"%\"});\n\t\t\tthis.tip.showTip();\n\t\t} else {\n\t\t\ttransform(path,'translate3d(0,0,0)');\n\t\t\tthis.tip.hideTip();\n\t\t\tpath.style.fill = color;\n\t\t}\n\t}\n\n\tbindTooltip() {\n\t\tthis.container.addEventListener('mousemove', this.mouseMove);\n\t\tthis.container.addEventListener('mouseleave', this.mouseLeave);\n\t}\n\n\tmouseMove(e){\n\t\tconst target = e.target;\n\t\tlet slices = this.components.get('pieSlices').store;\n\t\tlet prevIndex = this.curActiveSliceIndex;\n\t\tlet prevAcitve = this.curActiveSlice;\n\t\tif(slices.includes(target)) {\n\t\t\tlet i = slices.indexOf(target);\n\t\t\tthis.hoverSlice(prevAcitve, prevIndex,false);\n\t\t\tthis.curActiveSlice = target;\n\t\t\tthis.curActiveSliceIndex = i;\n\t\t\tthis.hoverSlice(target, i, true, e);\n\t\t} else {\n\t\t\tthis.mouseLeave();\n\t\t}\n\t}\n\n\tmouseLeave(){\n\t\tthis.hoverSlice(this.curActiveSlice,this.curActiveSliceIndex,false);\n\t}\n}\n\nfunction normalize(x) {\n\t// Calculates mantissa and exponent of a number\n\t// Returns normalized number and exponent\n\t// https://stackoverflow.com/q/9383593/6495043\n\n\tif(x===0) {\n\t\treturn [0, 0];\n\t}\n\tif(isNaN(x)) {\n\t\treturn {mantissa: -6755399441055744, exponent: 972};\n\t}\n\tvar sig = x > 0 ? 1 : -1;\n\tif(!isFinite(x)) {\n\t\treturn {mantissa: sig * 4503599627370496, exponent: 972};\n\t}\n\n\tx = Math.abs(x);\n\tvar exp = Math.floor(Math.log10(x));\n\tvar man = x/Math.pow(10, exp);\n\n\treturn [sig * man, exp];\n}\n\nfunction getChartRangeIntervals(max, min=0) {\n\tlet upperBound = Math.ceil(max);\n\tlet lowerBound = Math.floor(min);\n\tlet range = upperBound - lowerBound;\n\n\tlet noOfParts = range;\n\tlet partSize = 1;\n\n\t// To avoid too many partitions\n\tif(range > 5) {\n\t\tif(range % 2 !== 0) {\n\t\t\tupperBound++;\n\t\t\t// Recalc range\n\t\t\trange = upperBound - lowerBound;\n\t\t}\n\t\tnoOfParts = range/2;\n\t\tpartSize = 2;\n\t}\n\n\t// Special case: 1 and 2\n\tif(range <= 2) {\n\t\tnoOfParts = 4;\n\t\tpartSize = range/noOfParts;\n\t}\n\n\t// Special case: 0\n\tif(range === 0) {\n\t\tnoOfParts = 5;\n\t\tpartSize = 1;\n\t}\n\n\tlet intervals = [];\n\tfor(var i = 0; i <= noOfParts; i++){\n\t\tintervals.push(lowerBound + partSize * i);\n\t}\n\treturn intervals;\n}\n\nfunction getChartIntervals(maxValue, minValue=0) {\n\tlet [normalMaxValue, exponent] = normalize(maxValue);\n\tlet normalMinValue = minValue ? minValue/Math.pow(10, exponent): 0;\n\n\t// Allow only 7 significant digits\n\tnormalMaxValue = normalMaxValue.toFixed(6);\n\n\tlet intervals = getChartRangeIntervals(normalMaxValue, normalMinValue);\n\tintervals = intervals.map(value => value * Math.pow(10, exponent));\n\treturn intervals;\n}\n\nfunction calcChartIntervals(values, withMinimum=false) {\n\t//*** Where the magic happens ***\n\n\t// Calculates best-fit y intervals from given values\n\t// and returns the interval array\n\n\tlet maxValue = Math.max(...values);\n\tlet minValue = Math.min(...values);\n\n\t// Exponent to be used for pretty print\n\tlet exponent = 0, intervals = []; // eslint-disable-line no-unused-vars\n\n\tfunction getPositiveFirstIntervals(maxValue, absMinValue) {\n\t\tlet intervals = getChartIntervals(maxValue);\n\n\t\tlet intervalSize = intervals[1] - intervals[0];\n\n\t\t// Then unshift the negative values\n\t\tlet value = 0;\n\t\tfor(var i = 1; value < absMinValue; i++) {\n\t\t\tvalue += intervalSize;\n\t\t\tintervals.unshift((-1) * value);\n\t\t}\n\t\treturn intervals;\n\t}\n\n\t// CASE I: Both non-negative\n\n\tif(maxValue >= 0 && minValue >= 0) {\n\t\texponent = normalize(maxValue)[1];\n\t\tif(!withMinimum) {\n\t\t\tintervals = getChartIntervals(maxValue);\n\t\t} else {\n\t\t\tintervals = getChartIntervals(maxValue, minValue);\n\t\t}\n\t}\n\n\t// CASE II: Only minValue negative\n\n\telse if(maxValue > 0 && minValue < 0) {\n\t\t// `withMinimum` irrelevant in this case,\n\t\t// We'll be handling both sides of zero separately\n\t\t// (both starting from zero)\n\t\t// Because ceil() and floor() behave differently\n\t\t// in those two regions\n\n\t\tlet absMinValue = Math.abs(minValue);\n\n\t\tif(maxValue >= absMinValue) {\n\t\t\texponent = normalize(maxValue)[1];\n\t\t\tintervals = getPositiveFirstIntervals(maxValue, absMinValue);\n\t\t} else {\n\t\t\t// Mirror: maxValue => absMinValue, then change sign\n\t\t\texponent = normalize(absMinValue)[1];\n\t\t\tlet posIntervals = getPositiveFirstIntervals(absMinValue, maxValue);\n\t\t\tintervals = posIntervals.map(d => d * (-1));\n\t\t}\n\n\t}\n\n\t// CASE III: Both non-positive\n\n\telse if(maxValue <= 0 && minValue <= 0) {\n\t\t// Mirrored Case I:\n\t\t// Work with positives, then reverse the sign and array\n\n\t\tlet pseudoMaxValue = Math.abs(minValue);\n\t\tlet pseudoMinValue = Math.abs(maxValue);\n\n\t\texponent = normalize(pseudoMaxValue)[1];\n\t\tif(!withMinimum) {\n\t\t\tintervals = getChartIntervals(pseudoMaxValue);\n\t\t} else {\n\t\t\tintervals = getChartIntervals(pseudoMaxValue, pseudoMinValue);\n\t\t}\n\n\t\tintervals = intervals.reverse().map(d => d * (-1));\n\t}\n\n\treturn intervals;\n}\n\nfunction getZeroIndex(yPts) {\n\tlet zeroIndex;\n\tlet interval = getIntervalSize(yPts);\n\tif(yPts.indexOf(0) >= 0) {\n\t\t// the range has a given zero\n\t\t// zero-line on the chart\n\t\tzeroIndex = yPts.indexOf(0);\n\t} else if(yPts[0] > 0) {\n\t\t// Minimum value is positive\n\t\t// zero-line is off the chart: below\n\t\tlet min = yPts[0];\n\t\tzeroIndex = (-1) * min / interval;\n\t} else {\n\t\t// Maximum value is negative\n\t\t// zero-line is off the chart: above\n\t\tlet max = yPts[yPts.length - 1];\n\t\tzeroIndex = (-1) * max / interval + (yPts.length - 1);\n\t}\n\treturn zeroIndex;\n}\n\n\n\nfunction getIntervalSize(orderedArray) {\n\treturn orderedArray[1] - orderedArray[0];\n}\n\nfunction getValueRange(orderedArray) {\n\treturn orderedArray[orderedArray.length-1] - orderedArray[0];\n}\n\nfunction scale(val, yAxis) {\n\treturn floatTwo(yAxis.zeroLine - val * yAxis.scaleMultiplier);\n}\n\n\n\n\n\nfunction getClosestInArray(goal, arr, index = false) {\n\tlet closest = arr.reduce(function(prev, curr) {\n\t\treturn (Math.abs(curr - goal) < Math.abs(prev - goal) ? curr : prev);\n\t}, []);\n\n\treturn index ? arr.indexOf(closest) : closest;\n}\n\nfunction calcDistribution(values, distributionSize) {\n\t// Assume non-negative values,\n\t// implying distribution minimum at zero\n\n\tlet dataMaxValue = Math.max(...values);\n\n\tlet distributionStep = 1 / (distributionSize - 1);\n\tlet distribution = [];\n\n\tfor(var i = 0; i < distributionSize; i++) {\n\t\tlet checkpoint = dataMaxValue * (distributionStep * i);\n\t\tdistribution.push(checkpoint);\n\t}\n\n\treturn distribution;\n}\n\nfunction getMaxCheckpoint(value, distribution) {\n\treturn distribution.filter(d => d < value).length;\n}\n\nconst COL_WIDTH = HEATMAP_SQUARE_SIZE + HEATMAP_GUTTER_SIZE;\nconst ROW_HEIGHT = COL_WIDTH;\n// const DAY_INCR = 1;\n\nclass Heatmap extends BaseChart {\n\tconstructor(parent, options) {\n\t\tsuper(parent, options);\n\t\tthis.type = 'heatmap';\n\n\t\tthis.countLabel = options.countLabel || '';\n\n\t\tlet validStarts = ['Sunday', 'Monday'];\n\t\tlet startSubDomain = validStarts.includes(options.startSubDomain)\n\t\t\t? options.startSubDomain : 'Sunday';\n\t\tthis.startSubDomainIndex = validStarts.indexOf(startSubDomain);\n\n\t\tthis.setup();\n\t}\n\n\tsetMeasures(options) {\n\t\tlet m = this.measures;\n\t\tthis.discreteDomains = options.discreteDomains === 0 ? 0 : 1;\n\n\t\tm.paddings.top = ROW_HEIGHT * 3;\n\t\tm.paddings.bottom = 0;\n\t\tm.legendHeight = ROW_HEIGHT * 2;\n\t\tm.baseHeight = ROW_HEIGHT * NO_OF_DAYS_IN_WEEK\n\t\t\t+ getExtraHeight(m);\n\n\t\tlet d = this.data;\n\t\tlet spacing = this.discreteDomains ? NO_OF_YEAR_MONTHS : 0;\n\t\tthis.independentWidth = (getWeeksBetween(d.start, d.end)\n\t\t\t+ spacing) * COL_WIDTH + getExtraWidth(m);\n\t}\n\n\tupdateWidth() {\n\t\tlet spacing = this.discreteDomains ? NO_OF_YEAR_MONTHS : 0;\n\t\tlet noOfWeeks = this.state.noOfWeeks ? this.state.noOfWeeks : 52;\n\t\tthis.baseWidth = (noOfWeeks + spacing) * COL_WIDTH\n\t\t\t+ getExtraWidth(this.measures);\n\t}\n\n\tprepareData(data=this.data) {\n\t\tif(data.start && data.end && data.start > data.end) {\n\t\t\tthrow new Error('Start date cannot be greater than end date.');\n\t\t}\n\n\t\tif(!data.start) {\n\t\t\tdata.start = new Date();\n\t\t\tdata.start.setFullYear( data.start.getFullYear() - 1 );\n\t\t}\n\t\tif(!data.end) { data.end = new Date(); }\n\t\tdata.dataPoints = data.dataPoints || {};\n\n\t\tif(parseInt(Object.keys(data.dataPoints)[0]) > 100000) {\n\t\t\tlet points = {};\n\t\t\tObject.keys(data.dataPoints).forEach(timestampSec$$1 => {\n\t\t\t\tlet date = new Date(timestampSec$$1 * NO_OF_MILLIS);\n\t\t\t\tpoints[getYyyyMmDd(date)] = data.dataPoints[timestampSec$$1];\n\t\t\t});\n\t\t\tdata.dataPoints = points;\n\t\t}\n\n\t\treturn data;\n\t}\n\n\tcalc() {\n\t\tlet s = this.state;\n\n\t\ts.start = clone(this.data.start);\n\t\ts.end = clone(this.data.end);\n\n\t\ts.firstWeekStart = clone(s.start);\n\t\ts.noOfWeeks = getWeeksBetween(s.start, s.end);\n\t\ts.distribution = calcDistribution(\n\t\t\tObject.values(this.data.dataPoints), HEATMAP_DISTRIBUTION_SIZE);\n\n\t\ts.domainConfigs = this.getDomains();\n\t}\n\n\tsetupComponents() {\n\t\tlet s = this.state;\n\t\tlet lessCol = this.discreteDomains ? 0 : 1;\n\n\t\tlet componentConfigs = s.domainConfigs.map((config, i) => [\n\t\t\t'heatDomain',\n\t\t\t{\n\t\t\t\tindex: config.index,\n\t\t\t\tcolWidth: COL_WIDTH,\n\t\t\t\trowHeight: ROW_HEIGHT,\n\t\t\t\tsquareSize: HEATMAP_SQUARE_SIZE,\n\t\t\t\tradius: this.rawChartArgs.radius || 0,\n\t\t\t\txTranslate: s.domainConfigs\n\t\t\t\t\t.filter((config, j) => j < i)\n\t\t\t\t\t.map(config => config.cols.length - lessCol)\n\t\t\t\t\t.reduce((a, b) => a + b, 0)\n\t\t\t\t\t* COL_WIDTH\n\t\t\t},\n\t\t\tfunction() {\n\t\t\t\treturn s.domainConfigs[i];\n\t\t\t}.bind(this)\n\n\t\t]);\n\n\t\tthis.components = new Map(componentConfigs\n\t\t\t.map((args, i) => {\n\t\t\t\tlet component = getComponent(...args);\n\t\t\t\treturn [args[0] + '-' + i, component];\n\t\t\t})\n\t\t);\n\n\t\tlet y = 0;\n\t\tDAY_NAMES_SHORT.forEach((dayName, i) => {\n\t\t\tif([1, 3, 5].includes(i)) {\n\t\t\t\tlet dayText = makeText('subdomain-name', -COL_WIDTH/2, y, dayName,\n\t\t\t\t\t{\n\t\t\t\t\t\tfontSize: HEATMAP_SQUARE_SIZE,\n\t\t\t\t\t\tdy: 8,\n\t\t\t\t\t\ttextAnchor: 'end'\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\tthis.drawArea.appendChild(dayText);\n\t\t\t}\n\t\t\ty += ROW_HEIGHT;\n\t\t});\n\t}\n\n\tupdate(data) {\n\t\tif(!data) {\n\t\t\tconsole.error('No data to update.');\n\t\t}\n\n\t\tthis.data = this.prepareData(data);\n\t\tthis.draw();\n\t\tthis.bindTooltip();\n\t}\n\n\tbindTooltip() {\n\t\tthis.container.addEventListener('mousemove', (e) => {\n\t\t\tthis.components.forEach(comp => {\n\t\t\t\tlet daySquares = comp.store;\n\t\t\t\tlet daySquare = e.target;\n\t\t\t\tif(daySquares.includes(daySquare)) {\n\n\t\t\t\t\tlet count = daySquare.getAttribute('data-value');\n\t\t\t\t\tlet dateParts = daySquare.getAttribute('data-date').split('-');\n\n\t\t\t\t\tlet month = getMonthName(parseInt(dateParts[1])-1, true);\n\n\t\t\t\t\tlet gOff = this.container.getBoundingClientRect(), pOff = daySquare.getBoundingClientRect();\n\n\t\t\t\t\tlet width = parseInt(e.target.getAttribute('width'));\n\t\t\t\t\tlet x = pOff.left - gOff.left + width/2;\n\t\t\t\t\tlet y = pOff.top - gOff.top;\n\t\t\t\t\tlet value = count + ' ' + this.countLabel;\n\t\t\t\t\tlet name = ' on ' + month + ' ' + dateParts[0] + ', ' + dateParts[2];\n\n\t\t\t\t\tthis.tip.setValues(x, y, {name: name, value: value, valueFirst: 1}, []);\n\t\t\t\t\tthis.tip.showTip();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\trenderLegend() {\n\t\tthis.legendArea.textContent = '';\n\t\tlet x = 0;\n\t\tlet y = ROW_HEIGHT;\n\t\tlet radius = this.rawChartArgs.radius || 0;\n\n\t\tlet lessText = makeText('subdomain-name', x, y, 'Less',\n\t\t\t{\n\t\t\t\tfontSize: HEATMAP_SQUARE_SIZE + 1,\n\t\t\t\tdy: 9\n\t\t\t}\n\t\t);\n\t\tx = (COL_WIDTH * 2) + COL_WIDTH/2;\n\t\tthis.legendArea.appendChild(lessText);\n\n\t\tthis.colors.slice(0, HEATMAP_DISTRIBUTION_SIZE).map((color, i) => {\n\t\t\tconst square = heatSquare('heatmap-legend-unit', x + (COL_WIDTH + 3) * i,\n\t\t\t\ty, HEATMAP_SQUARE_SIZE, radius, color);\n\t\t\tthis.legendArea.appendChild(square);\n\t\t});\n\n\t\tlet moreTextX = x + HEATMAP_DISTRIBUTION_SIZE * (COL_WIDTH + 3) + COL_WIDTH/4;\n\t\tlet moreText = makeText('subdomain-name', moreTextX, y, 'More',\n\t\t\t{\n\t\t\t\tfontSize: HEATMAP_SQUARE_SIZE + 1,\n\t\t\t\tdy: 9\n\t\t\t}\n\t\t);\n\t\tthis.legendArea.appendChild(moreText);\n\t}\n\n\tgetDomains() {\n\t\tlet s = this.state;\n\t\tconst [startMonth, startYear] = [s.start.getMonth(), s.start.getFullYear()];\n\t\tconst [endMonth, endYear] = [s.end.getMonth(), s.end.getFullYear()];\n\n\t\tconst noOfMonths = (endMonth - startMonth + 1) + (endYear - startYear) * 12;\n\n\t\tlet domainConfigs = [];\n\n\t\tlet startOfMonth = clone(s.start);\n\t\tfor(var i = 0; i < noOfMonths; i++) {\n\t\t\tlet endDate = s.end;\n\t\t\tif(!areInSameMonth(startOfMonth, s.end)) {\n\t\t\t\tlet [month, year] = [startOfMonth.getMonth(), startOfMonth.getFullYear()];\n\t\t\t\tendDate = getLastDateInMonth(month, year);\n\t\t\t}\n\t\t\tdomainConfigs.push(this.getDomainConfig(startOfMonth, endDate));\n\n\t\t\taddDays(endDate, 1);\n\t\t\tstartOfMonth = endDate;\n\t\t}\n\n\t\treturn domainConfigs;\n\t}\n\n\tgetDomainConfig(startDate, endDate='') {\n\t\tlet [month, year] = [startDate.getMonth(), startDate.getFullYear()];\n\t\tlet startOfWeek = setDayToSunday(startDate); // TODO: Monday as well\n\t\tendDate = clone(endDate) || getLastDateInMonth(month, year);\n\n\t\tlet domainConfig = {\n\t\t\tindex: month,\n\t\t\tcols: []\n\t\t};\n\n\t\taddDays(endDate, 1);\n\t\tlet noOfMonthWeeks = getWeeksBetween(startOfWeek, endDate);\n\n\t\tlet cols = [], col;\n\t\tfor(var i = 0; i < noOfMonthWeeks; i++) {\n\t\t\tcol = this.getCol(startOfWeek, month);\n\t\t\tcols.push(col);\n\n\t\t\tstartOfWeek = new Date(col[NO_OF_DAYS_IN_WEEK - 1].yyyyMmDd);\n\t\t\taddDays(startOfWeek, 1);\n\t\t}\n\n\t\tif(col[NO_OF_DAYS_IN_WEEK - 1].dataValue !== undefined) {\n\t\t\taddDays(startOfWeek, 1);\n\t\t\tcols.push(this.getCol(startOfWeek, month, true));\n\t\t}\n\n\t\tdomainConfig.cols = cols;\n\n\t\treturn domainConfig;\n\t}\n\n\tgetCol(startDate, month, empty = false) {\n\t\tlet s = this.state;\n\n\t\t// startDate is the start of week\n\t\tlet currentDate = clone(startDate);\n\t\tlet col = [];\n\n\t\tfor(var i = 0; i < NO_OF_DAYS_IN_WEEK; i++, addDays(currentDate, 1)) {\n\t\t\tlet config = {};\n\n\t\t\t// Non-generic adjustment for entire heatmap, needs state\n\t\t\tlet currentDateWithinData = currentDate >= s.start && currentDate <= s.end;\n\n\t\t\tif(empty || currentDate.getMonth() !== month || !currentDateWithinData) {\n\t\t\t\tconfig.yyyyMmDd = getYyyyMmDd(currentDate);\n\t\t\t} else {\n\t\t\t\tconfig = this.getSubDomainConfig(currentDate);\n\t\t\t}\n\t\t\tcol.push(config);\n\t\t}\n\n\t\treturn col;\n\t}\n\n\tgetSubDomainConfig(date) {\n\t\tlet yyyyMmDd = getYyyyMmDd(date);\n\t\tlet dataValue = this.data.dataPoints[yyyyMmDd];\n\t\tlet config = {\n\t\t\tyyyyMmDd: yyyyMmDd,\n\t\t\tdataValue: dataValue || 0,\n\t\t\tfill: this.colors[getMaxCheckpoint(dataValue, this.state.distribution)]\n\t\t};\n\t\treturn config;\n\t}\n}\n\nfunction dataPrep(data, type) {\n\tdata.labels = data.labels || [];\n\n\tlet datasetLength = data.labels.length;\n\n\t// Datasets\n\tlet datasets = data.datasets;\n\tlet zeroArray = new Array(datasetLength).fill(0);\n\tif(!datasets) {\n\t\t// default\n\t\tdatasets = [{\n\t\t\tvalues: zeroArray\n\t\t}];\n\t}\n\n\tdatasets.map(d=> {\n\t\t// Set values\n\t\tif(!d.values) {\n\t\t\td.values = zeroArray;\n\t\t} else {\n\t\t\t// Check for non values\n\t\t\tlet vals = d.values;\n\t\t\tvals = vals.map(val => (!isNaN(val) ? val : 0));\n\n\t\t\t// Trim or extend\n\t\t\tif(vals.length > datasetLength) {\n\t\t\t\tvals = vals.slice(0, datasetLength);\n\t\t\t} else {\n\t\t\t\tvals = fillArray(vals, datasetLength - vals.length, 0);\n\t\t\t}\n\t\t}\n\n\t\t// Set labels\n\t\t//\n\n\t\t// Set type\n\t\tif(!d.chartType ) {\n\t\t\tif(!AXIS_DATASET_CHART_TYPES.includes(type)) type === DEFAULT_AXIS_CHART_TYPE;\n\t\t\td.chartType = type;\n\t\t}\n\n\t});\n\n\t// Markers\n\n\t// Regions\n\t// data.yRegions = data.yRegions || [];\n\tif(data.yRegions) {\n\t\tdata.yRegions.map(d => {\n\t\t\tif(d.end < d.start) {\n\t\t\t\t[d.start, d.end] = [d.end, d.start];\n\t\t\t}\n\t\t});\n\t}\n\n\treturn data;\n}\n\nfunction zeroDataPrep(realData) {\n\tlet datasetLength = realData.labels.length;\n\tlet zeroArray = new Array(datasetLength).fill(0);\n\n\tlet zeroData = {\n\t\tlabels: realData.labels.slice(0, -1),\n\t\tdatasets: realData.datasets.map(d => {\n\t\t\treturn {\n\t\t\t\tname: '',\n\t\t\t\tvalues: zeroArray.slice(0, -1),\n\t\t\t\tchartType: d.chartType\n\t\t\t};\n\t\t}),\n\t};\n\n\tif(realData.yMarkers) {\n\t\tzeroData.yMarkers = [\n\t\t\t{\n\t\t\t\tvalue: 0,\n\t\t\t\tlabel: ''\n\t\t\t}\n\t\t];\n\t}\n\n\tif(realData.yRegions) {\n\t\tzeroData.yRegions = [\n\t\t\t{\n\t\t\t\tstart: 0,\n\t\t\t\tend: 0,\n\t\t\t\tlabel: ''\n\t\t\t}\n\t\t];\n\t}\n\n\treturn zeroData;\n}\n\nfunction getShortenedLabels(chartWidth, labels=[], isSeries=true) {\n\tlet allowedSpace = chartWidth / labels.length;\n\tif(allowedSpace <= 0) allowedSpace = 1;\n\tlet allowedLetters = allowedSpace / DEFAULT_CHAR_WIDTH;\n\n\tlet seriesMultiple;\n\tif(isSeries) {\n\t\t// Find the maximum label length for spacing calculations\n\t\tlet maxLabelLength = Math.max(...labels.map(label => label.length));\n\t\tseriesMultiple = Math.ceil(maxLabelLength/allowedLetters);\n\t}\n\n\tlet calcLabels = labels.map((label, i) => {\n\t\tlabel += \"\";\n\t\tif(label.length > allowedLetters) {\n\n\t\t\tif(!isSeries) {\n\t\t\t\tif(allowedLetters-3 > 0) {\n\t\t\t\t\tlabel = label.slice(0, allowedLetters-3) + \" ...\";\n\t\t\t\t} else {\n\t\t\t\t\tlabel = label.slice(0, allowedLetters) + '..';\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif(i % seriesMultiple !== 0) {\n\t\t\t\t\tlabel = \"\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn label;\n\t});\n\n\treturn calcLabels;\n}\n\nclass AxisChart extends BaseChart {\n\tconstructor(parent, args) {\n\t\tsuper(parent, args);\n\n\t\tthis.barOptions = args.barOptions || {};\n\t\tthis.lineOptions = args.lineOptions || {};\n\n\t\tthis.type = args.type || 'line';\n\t\tthis.init = 1;\n\n\t\tthis.setup();\n\t}\n\n\tsetMeasures() {\n\t\tif(this.data.datasets.length <= 1) {\n\t\t\tthis.config.showLegend = 0;\n\t\t\tthis.measures.paddings.bottom = 30;\n\t\t}\n\t}\n\n\tconfigure(options) {\n\t\tsuper.configure(options);\n\n\t\toptions.axisOptions = options.axisOptions || {};\n\t\toptions.tooltipOptions = options.tooltipOptions || {};\n\n\t\tthis.config.xAxisMode = options.axisOptions.xAxisMode || 'span';\n\t\tthis.config.yAxisMode = options.axisOptions.yAxisMode || 'span';\n\t\tthis.config.xIsSeries = options.axisOptions.xIsSeries || 0;\n\t\tthis.config.shortenYAxisNumbers = options.axisOptions.shortenYAxisNumbers || 0;\n\n\t\tthis.config.formatTooltipX = options.tooltipOptions.formatTooltipX;\n\t\tthis.config.formatTooltipY = options.tooltipOptions.formatTooltipY;\n\n\t\tthis.config.valuesOverPoints = options.valuesOverPoints;\n\t}\n\n\tprepareData(data=this.data) {\n\t\treturn dataPrep(data, this.type);\n\t}\n\n\tprepareFirstData(data=this.data) {\n\t\treturn zeroDataPrep(data);\n\t}\n\n\tcalc(onlyWidthChange = false) {\n\t\tthis.calcXPositions();\n\t\tif(!onlyWidthChange) {\n\t\t\tthis.calcYAxisParameters(this.getAllYValues(), this.type === 'line');\n\t\t}\n\t\tthis.makeDataByIndex();\n\t}\n\n\tcalcXPositions() {\n\t\tlet s = this.state;\n\t\tlet labels = this.data.labels;\n\t\ts.datasetLength = labels.length;\n\n\t\ts.unitWidth = this.width/(s.datasetLength);\n\t\t// Default, as per bar, and mixed. Only line will be a special case\n\t\ts.xOffset = s.unitWidth/2;\n\n\t\t// // For a pure Line Chart\n\t\t// s.unitWidth = this.width/(s.datasetLength - 1);\n\t\t// s.xOffset = 0;\n\n\t\ts.xAxis = {\n\t\t\tlabels: labels,\n\t\t\tpositions: labels.map((d, i) =>\n\t\t\t\tfloatTwo(s.xOffset + i * s.unitWidth)\n\t\t\t)\n\t\t};\n\t}\n\n\tcalcYAxisParameters(dataValues, withMinimum = 'false') {\n\t\tconst yPts = calcChartIntervals(dataValues, withMinimum);\n\t\tconst scaleMultiplier = this.height / getValueRange(yPts);\n\t\tconst intervalHeight = getIntervalSize(yPts) * scaleMultiplier;\n\t\tconst zeroLine = this.height - (getZeroIndex(yPts) * intervalHeight);\n\n\t\tthis.state.yAxis = {\n\t\t\tlabels: yPts,\n\t\t\tpositions: yPts.map(d => zeroLine - d * scaleMultiplier),\n\t\t\tscaleMultiplier: scaleMultiplier,\n\t\t\tzeroLine: zeroLine,\n\t\t};\n\n\t\t// Dependent if above changes\n\t\tthis.calcDatasetPoints();\n\t\tthis.calcYExtremes();\n\t\tthis.calcYRegions();\n\t}\n\n\tcalcDatasetPoints() {\n\t\tlet s = this.state;\n\t\tlet scaleAll = values => values.map(val => scale(val, s.yAxis));\n\n\t\ts.datasets = this.data.datasets.map((d, i) => {\n\t\t\tlet values = d.values;\n\t\t\tlet cumulativeYs = d.cumulativeYs || [];\n\t\t\treturn {\n\t\t\t\tname: d.name,\n\t\t\t\tindex: i,\n\t\t\t\tchartType: d.chartType,\n\n\t\t\t\tvalues: values,\n\t\t\t\tyPositions: scaleAll(values),\n\n\t\t\t\tcumulativeYs: cumulativeYs,\n\t\t\t\tcumulativeYPos: scaleAll(cumulativeYs),\n\t\t\t};\n\t\t});\n\t}\n\n\tcalcYExtremes() {\n\t\tlet s = this.state;\n\t\tif(this.barOptions.stacked) {\n\t\t\ts.yExtremes = s.datasets[s.datasets.length - 1].cumulativeYPos;\n\t\t\treturn;\n\t\t}\n\t\ts.yExtremes = new Array(s.datasetLength).fill(9999);\n\t\ts.datasets.map(d => {\n\t\t\td.yPositions.map((pos, j) => {\n\t\t\t\tif(pos < s.yExtremes[j]) {\n\t\t\t\t\ts.yExtremes[j] = pos;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tcalcYRegions() {\n\t\tlet s = this.state;\n\t\tif(this.data.yMarkers) {\n\t\t\tthis.state.yMarkers = this.data.yMarkers.map(d => {\n\t\t\t\td.position = scale(d.value, s.yAxis);\n\t\t\t\tif(!d.options) d.options = {};\n\t\t\t\t// if(!d.label.includes(':')) {\n\t\t\t\t// \td.label += ': ' + d.value;\n\t\t\t\t// }\n\t\t\t\treturn d;\n\t\t\t});\n\t\t}\n\t\tif(this.data.yRegions) {\n\t\t\tthis.state.yRegions = this.data.yRegions.map(d => {\n\t\t\t\td.startPos = scale(d.start, s.yAxis);\n\t\t\t\td.endPos = scale(d.end, s.yAxis);\n\t\t\t\tif(!d.options) d.options = {};\n\t\t\t\treturn d;\n\t\t\t});\n\t\t}\n\t}\n\n\tgetAllYValues() {\n\t\tlet key = 'values';\n\n\t\tif(this.barOptions.stacked) {\n\t\t\tkey = 'cumulativeYs';\n\t\t\tlet cumulative = new Array(this.state.datasetLength).fill(0);\n\t\t\tthis.data.datasets.map((d, i) => {\n\t\t\t\tlet values = this.data.datasets[i].values;\n\t\t\t\td[key] = cumulative = cumulative.map((c, i) => c + values[i]);\n\t\t\t});\n\t\t}\n\n\t\tlet allValueLists = this.data.datasets.map(d => d[key]);\n\t\tif(this.data.yMarkers) {\n\t\t\tallValueLists.push(this.data.yMarkers.map(d => d.value));\n\t\t}\n\t\tif(this.data.yRegions) {\n\t\t\tthis.data.yRegions.map(d => {\n\t\t\t\tallValueLists.push([d.end, d.start]);\n\t\t\t});\n\t\t}\n\n\t\treturn [].concat(...allValueLists);\n\t}\n\n\tsetupComponents() {\n\t\tlet componentConfigs = [\n\t\t\t[\n\t\t\t\t'yAxis',\n\t\t\t\t{\n\t\t\t\t\tmode: this.config.yAxisMode,\n\t\t\t\t\twidth: this.width,\n\t\t\t\t\tshortenNumbers: this.config.shortenYAxisNumbers\n\t\t\t\t\t// pos: 'right'\n\t\t\t\t},\n\t\t\t\tfunction() {\n\t\t\t\t\treturn this.state.yAxis;\n\t\t\t\t}.bind(this)\n\t\t\t],\n\n\t\t\t[\n\t\t\t\t'xAxis',\n\t\t\t\t{\n\t\t\t\t\tmode: this.config.xAxisMode,\n\t\t\t\t\theight: this.height,\n\t\t\t\t\t// pos: 'right'\n\t\t\t\t},\n\t\t\t\tfunction() {\n\t\t\t\t\tlet s = this.state;\n\t\t\t\t\ts.xAxis.calcLabels = getShortenedLabels(this.width,\n\t\t\t\t\t\ts.xAxis.labels, this.config.xIsSeries);\n\n\t\t\t\t\treturn s.xAxis;\n\t\t\t\t}.bind(this)\n\t\t\t],\n\n\t\t\t[\n\t\t\t\t'yRegions',\n\t\t\t\t{\n\t\t\t\t\twidth: this.width,\n\t\t\t\t\tpos: 'right'\n\t\t\t\t},\n\t\t\t\tfunction() {\n\t\t\t\t\treturn this.state.yRegions;\n\t\t\t\t}.bind(this)\n\t\t\t],\n\t\t];\n\n\t\tlet barDatasets = this.state.datasets.filter(d => d.chartType === 'bar');\n\t\tlet lineDatasets = this.state.datasets.filter(d => d.chartType === 'line');\n\n\t\tlet barsConfigs = barDatasets.map(d => {\n\t\t\tlet index = d.index;\n\t\t\treturn [\n\t\t\t\t'barGraph' + '-' + d.index,\n\t\t\t\t{\n\t\t\t\t\tindex: index,\n\t\t\t\t\tcolor: this.colors[index],\n\t\t\t\t\tstacked: this.barOptions.stacked,\n\n\t\t\t\t\t// same for all datasets\n\t\t\t\t\tvaluesOverPoints: this.config.valuesOverPoints,\n\t\t\t\t\tminHeight: this.height * MIN_BAR_PERCENT_HEIGHT,\n\t\t\t\t},\n\t\t\t\tfunction() {\n\t\t\t\t\tlet s = this.state;\n\t\t\t\t\tlet d = s.datasets[index];\n\t\t\t\t\tlet stacked = this.barOptions.stacked;\n\n\t\t\t\t\tlet spaceRatio = this.barOptions.spaceRatio || BAR_CHART_SPACE_RATIO;\n\t\t\t\t\tlet barsWidth = s.unitWidth * (1 - spaceRatio);\n\t\t\t\t\tlet barWidth = barsWidth/(stacked ? 1 : barDatasets.length);\n\n\t\t\t\t\tlet xPositions = s.xAxis.positions.map(x => x - barsWidth/2);\n\t\t\t\t\tif(!stacked) {\n\t\t\t\t\t\txPositions = xPositions.map(p => p + barWidth * index);\n\t\t\t\t\t}\n\n\t\t\t\t\tlet labels = new Array(s.datasetLength).fill('');\n\t\t\t\t\tif(this.config.valuesOverPoints) {\n\t\t\t\t\t\tif(stacked && d.index === s.datasets.length - 1) {\n\t\t\t\t\t\t\tlabels = d.cumulativeYs;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlabels = d.values;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tlet offsets = new Array(s.datasetLength).fill(0);\n\t\t\t\t\tif(stacked) {\n\t\t\t\t\t\toffsets = d.yPositions.map((y, j) => y - d.cumulativeYPos[j]);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\txPositions: xPositions,\n\t\t\t\t\t\tyPositions: d.yPositions,\n\t\t\t\t\t\toffsets: offsets,\n\t\t\t\t\t\t// values: d.values,\n\t\t\t\t\t\tlabels: labels,\n\n\t\t\t\t\t\tzeroLine: s.yAxis.zeroLine,\n\t\t\t\t\t\tbarsWidth: barsWidth,\n\t\t\t\t\t\tbarWidth: barWidth,\n\t\t\t\t\t};\n\t\t\t\t}.bind(this)\n\t\t\t];\n\t\t});\n\n\t\tlet lineConfigs = lineDatasets.map(d => {\n\t\t\tlet index = d.index;\n\t\t\treturn [\n\t\t\t\t'lineGraph' + '-' + d.index,\n\t\t\t\t{\n\t\t\t\t\tindex: index,\n\t\t\t\t\tcolor: this.colors[index],\n\t\t\t\t\tsvgDefs: this.svgDefs,\n\t\t\t\t\theatline: this.lineOptions.heatline,\n\t\t\t\t\tregionFill: this.lineOptions.regionFill,\n\t\t\t\t\tspline: this.lineOptions.spline,\n\t\t\t\t\thideDots: this.lineOptions.hideDots,\n\t\t\t\t\thideLine: this.lineOptions.hideLine,\n\n\t\t\t\t\t// same for all datasets\n\t\t\t\t\tvaluesOverPoints: this.config.valuesOverPoints,\n\t\t\t\t},\n\t\t\t\tfunction() {\n\t\t\t\t\tlet s = this.state;\n\t\t\t\t\tlet d = s.datasets[index];\n\t\t\t\t\tlet minLine = s.yAxis.positions[0] < s.yAxis.zeroLine\n\t\t\t\t\t\t? s.yAxis.positions[0] : s.yAxis.zeroLine;\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\txPositions: s.xAxis.positions,\n\t\t\t\t\t\tyPositions: d.yPositions,\n\n\t\t\t\t\t\tvalues: d.values,\n\n\t\t\t\t\t\tzeroLine: minLine,\n\t\t\t\t\t\tradius: this.lineOptions.dotSize || LINE_CHART_DOT_SIZE,\n\t\t\t\t\t};\n\t\t\t\t}.bind(this)\n\t\t\t];\n\t\t});\n\n\t\tlet markerConfigs = [\n\t\t\t[\n\t\t\t\t'yMarkers',\n\t\t\t\t{\n\t\t\t\t\twidth: this.width,\n\t\t\t\t\tpos: 'right'\n\t\t\t\t},\n\t\t\t\tfunction() {\n\t\t\t\t\treturn this.state.yMarkers;\n\t\t\t\t}.bind(this)\n\t\t\t]\n\t\t];\n\n\t\tcomponentConfigs = componentConfigs.concat(barsConfigs, lineConfigs, markerConfigs);\n\n\t\tlet optionals = ['yMarkers', 'yRegions'];\n\t\tthis.dataUnitComponents = [];\n\n\t\tthis.components = new Map(componentConfigs\n\t\t\t.filter(args => !optionals.includes(args[0]) || this.state[args[0]])\n\t\t\t.map(args => {\n\t\t\t\tlet component = getComponent(...args);\n\t\t\t\tif(args[0].includes('lineGraph') || args[0].includes('barGraph')) {\n\t\t\t\t\tthis.dataUnitComponents.push(component);\n\t\t\t\t}\n\t\t\t\treturn [args[0], component];\n\t\t\t}));\n\t}\n\n\tmakeDataByIndex() {\n\t\tthis.dataByIndex = {};\n\n\t\tlet s = this.state;\n\t\tlet formatX = this.config.formatTooltipX;\n\t\tlet formatY = this.config.formatTooltipY;\n\t\tlet titles = s.xAxis.labels;\n\n\t\ttitles.map((label, index) => {\n\t\t\tlet values = this.state.datasets.map((set, i) => {\n\t\t\t\tlet value = set.values[index];\n\t\t\t\treturn {\n\t\t\t\t\ttitle: set.name,\n\t\t\t\t\tvalue: value,\n\t\t\t\t\tyPos: set.yPositions[index],\n\t\t\t\t\tcolor: this.colors[i],\n\t\t\t\t\tformatted: formatY ? formatY(value) : value,\n\t\t\t\t};\n\t\t\t});\n\n\t\t\tthis.dataByIndex[index] = {\n\t\t\t\tlabel: label,\n\t\t\t\tformattedLabel: formatX ? formatX(label) : label,\n\t\t\t\txPos: s.xAxis.positions[index],\n\t\t\t\tvalues: values,\n\t\t\t\tyExtreme: s.yExtremes[index],\n\t\t\t};\n\t\t});\n\t}\n\n\tbindTooltip() {\n\t\t// NOTE: could be in tooltip itself, as it is a given functionality for its parent\n\t\tthis.container.addEventListener('mousemove', (e) => {\n\t\t\tlet m = this.measures;\n\t\t\tlet o = getOffset(this.container);\n\t\t\tlet relX = e.pageX - o.left - getLeftOffset(m);\n\t\t\tlet relY = e.pageY - o.top;\n\n\t\t\tif(relY < this.height + getTopOffset(m)\n\t\t\t\t&& relY >  getTopOffset(m)) {\n\t\t\t\tthis.mapTooltipXPosition(relX);\n\t\t\t} else {\n\t\t\t\tthis.tip.hideTip();\n\t\t\t}\n\t\t});\n\t}\n\n\tmapTooltipXPosition(relX) {\n\t\tlet s = this.state;\n\t\tif(!s.yExtremes) return;\n\n\t\tlet index = getClosestInArray(relX, s.xAxis.positions, true);\n\t\tif (index >= 0) {\n\t\t\tlet dbi = this.dataByIndex[index];\n\n\t\t\tthis.tip.setValues(\n\t\t\t\tdbi.xPos + this.tip.offset.x,\n\t\t\t\tdbi.yExtreme + this.tip.offset.y,\n\t\t\t\t{name: dbi.formattedLabel, value: ''},\n\t\t\t\tdbi.values,\n\t\t\t\tindex\n\t\t\t);\n\n\t\t\tthis.tip.showTip();\n\t\t}\n\t}\n\n\trenderLegend() {\n\t\tlet s = this.data;\n\t\tif(s.datasets.length > 1) {\n\t\t\tthis.legendArea.textContent = '';\n\t\t\ts.datasets.map((d, i) => {\n\t\t\t\tlet barWidth = AXIS_LEGEND_BAR_SIZE;\n\t\t\t\t// let rightEndPoint = this.baseWidth - this.measures.margins.left - this.measures.margins.right;\n\t\t\t\t// let multiplier = s.datasets.length - i;\n\t\t\t\tlet rect = legendBar(\n\t\t\t\t\t// rightEndPoint - multiplier * barWidth,\t// To right align\n\t\t\t\t\tbarWidth * i,\n\t\t\t\t\t'0',\n\t\t\t\t\tbarWidth,\n\t\t\t\t\tthis.colors[i],\n\t\t\t\t\td.name,\n\t\t\t\t\tthis.config.truncateLegends);\n\t\t\t\tthis.legendArea.appendChild(rect);\n\t\t\t});\n\t\t}\n\t}\n\n\n\n\t// Overlay\n\tmakeOverlay() {\n\t\tif(this.init) {\n\t\t\tthis.init = 0;\n\t\t\treturn;\n\t\t}\n\t\tif(this.overlayGuides) {\n\t\t\tthis.overlayGuides.forEach(g => {\n\t\t\t\tlet o = g.overlay;\n\t\t\t\to.parentNode.removeChild(o);\n\t\t\t});\n\t\t}\n\n\t\tthis.overlayGuides = this.dataUnitComponents.map(c => {\n\t\t\treturn {\n\t\t\t\ttype: c.unitType,\n\t\t\t\toverlay: undefined,\n\t\t\t\tunits: c.units,\n\t\t\t};\n\t\t});\n\n\t\tif(this.state.currentIndex === undefined) {\n\t\t\tthis.state.currentIndex = this.state.datasetLength - 1;\n\t\t}\n\n\t\t// Render overlays\n\t\tthis.overlayGuides.map(d => {\n\t\t\tlet currentUnit = d.units[this.state.currentIndex];\n\n\t\t\td.overlay = makeOverlay[d.type](currentUnit);\n\t\t\tthis.drawArea.appendChild(d.overlay);\n\t\t});\n\t}\n\n\tupdateOverlayGuides() {\n\t\tif(this.overlayGuides) {\n\t\t\tthis.overlayGuides.forEach(g => {\n\t\t\t\tlet o = g.overlay;\n\t\t\t\to.parentNode.removeChild(o);\n\t\t\t});\n\t\t}\n\t}\n\n\tbindOverlay() {\n\t\tthis.parent.addEventListener('data-select', () => {\n\t\t\tthis.updateOverlay();\n\t\t});\n\t}\n\n\tbindUnits() {\n\t\tthis.dataUnitComponents.map(c => {\n\t\t\tc.units.map(unit => {\n\t\t\t\tunit.addEventListener('click', () => {\n\t\t\t\t\tlet index = unit.getAttribute('data-point-index');\n\t\t\t\t\tthis.setCurrentDataPoint(index);\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\t// Note: Doesn't work as tooltip is absolutely positioned\n\t\tthis.tip.container.addEventListener('click', () => {\n\t\t\tlet index = this.tip.container.getAttribute('data-point-index');\n\t\t\tthis.setCurrentDataPoint(index);\n\t\t});\n\t}\n\n\tupdateOverlay() {\n\t\tthis.overlayGuides.map(d => {\n\t\t\tlet currentUnit = d.units[this.state.currentIndex];\n\t\t\tupdateOverlay[d.type](currentUnit, d.overlay);\n\t\t});\n\t}\n\n\tonLeftArrow() {\n\t\tthis.setCurrentDataPoint(this.state.currentIndex - 1);\n\t}\n\n\tonRightArrow() {\n\t\tthis.setCurrentDataPoint(this.state.currentIndex + 1);\n\t}\n\n\tgetDataPoint(index=this.state.currentIndex) {\n\t\tlet s = this.state;\n\t\tlet data_point = {\n\t\t\tindex: index,\n\t\t\tlabel: s.xAxis.labels[index],\n\t\t\tvalues: s.datasets.map(d => d.values[index])\n\t\t};\n\t\treturn data_point;\n\t}\n\n\tsetCurrentDataPoint(index) {\n\t\tlet s = this.state;\n\t\tindex = parseInt(index);\n\t\tif(index < 0) index = 0;\n\t\tif(index >= s.xAxis.labels.length) index = s.xAxis.labels.length - 1;\n\t\tif(index === s.currentIndex) return;\n\t\ts.currentIndex = index;\n\t\tfire(this.parent, \"data-select\", this.getDataPoint());\n\t}\n\n\n\n\t// API\n\taddDataPoint(label, datasetValues, index=this.state.datasetLength) {\n\t\tsuper.addDataPoint(label, datasetValues, index);\n\t\tthis.data.labels.splice(index, 0, label);\n\t\tthis.data.datasets.map((d, i) => {\n\t\t\td.values.splice(index, 0, datasetValues[i]);\n\t\t});\n\t\tthis.update(this.data);\n\t}\n\n\tremoveDataPoint(index = this.state.datasetLength-1) {\n\t\tif (this.data.labels.length <= 1) {\n\t\t\treturn;\n\t\t}\n\t\tsuper.removeDataPoint(index);\n\t\tthis.data.labels.splice(index, 1);\n\t\tthis.data.datasets.map(d => {\n\t\t\td.values.splice(index, 1);\n\t\t});\n\t\tthis.update(this.data);\n\t}\n\n\tupdateDataset(datasetValues, index=0) {\n\t\tthis.data.datasets[index].values = datasetValues;\n\t\tthis.update(this.data);\n\t}\n\t// addDataset(dataset, index) {}\n\t// removeDataset(index = 0) {}\n\n\tupdateDatasets(datasets) {\n\t\tthis.data.datasets.map((d, i) => {\n\t\t\tif(datasets[i]) {\n\t\t\t\td.values = datasets[i];\n\t\t\t}\n\t\t});\n\t\tthis.update(this.data);\n\t}\n\n\t// updateDataPoint(dataPoint, index = 0) {}\n\t// addDataPoint(dataPoint, index = 0) {}\n\t// removeDataPoint(index = 0) {}\n}\n\nclass DonutChart extends AggregationChart {\n\tconstructor(parent, args) {\n\t\tsuper(parent, args);\n\t\tthis.type = 'donut';\n\t\tthis.initTimeout = 0;\n\t\tthis.init = 1;\n\n\t\tthis.setup();\n\t}\n\n\tconfigure(args) {\n\t\tsuper.configure(args);\n\t\tthis.mouseMove = this.mouseMove.bind(this);\n\t\tthis.mouseLeave = this.mouseLeave.bind(this);\n\n\t\tthis.hoverRadio = args.hoverRadio || 0.1;\n\t\tthis.config.startAngle = args.startAngle || 0;\n\n\t\tthis.clockWise = args.clockWise || false;\n\t\tthis.strokeWidth = args.strokeWidth || 30;\n\t}\n\n\tcalc() {\n\t\tsuper.calc();\n\t\tlet s = this.state;\n\t\tthis.radius =\n\t\t\tthis.height > this.width\n\t\t\t\t? this.center.x - this.strokeWidth / 2\n\t\t\t\t: this.center.y - this.strokeWidth / 2;\n\n\t\tconst { radius, clockWise } = this;\n\n\t\tconst prevSlicesProperties = s.slicesProperties || [];\n\t\ts.sliceStrings = [];\n\t\ts.slicesProperties = [];\n\t\tlet curAngle = 180 - this.config.startAngle;\n\n\t\ts.sliceTotals.map((total, i) => {\n\t\t\tconst startAngle = curAngle;\n\t\t\tconst originDiffAngle = (total / s.grandTotal) * FULL_ANGLE;\n\t\t\tconst largeArc = originDiffAngle > 180 ? 1: 0;\n\t\t\tconst diffAngle = clockWise ? -originDiffAngle : originDiffAngle;\n\t\t\tconst endAngle = curAngle = curAngle + diffAngle;\n\t\t\tconst startPosition = getPositionByAngle(startAngle, radius);\n\t\t\tconst endPosition = getPositionByAngle(endAngle, radius);\n\n\t\t\tconst prevProperty = this.init && prevSlicesProperties[i];\n\n\t\t\tlet curStart,curEnd;\n\t\t\tif(this.init) {\n\t\t\t\tcurStart = prevProperty ? prevProperty.startPosition : startPosition;\n\t\t\t\tcurEnd = prevProperty ? prevProperty.endPosition : startPosition;\n\t\t\t} else {\n\t\t\t\tcurStart = startPosition;\n\t\t\t\tcurEnd = endPosition;\n\t\t\t}\n\t\t\tconst curPath =\n\t\t\t\toriginDiffAngle === 360\n\t\t\t\t\t? makeStrokeCircleStr(curStart, curEnd, this.center, this.radius, this.clockWise, largeArc)\n\t\t\t\t\t: makeArcStrokePathStr(curStart, curEnd, this.center, this.radius, this.clockWise, largeArc);\n\n\t\t\ts.sliceStrings.push(curPath);\n\t\t\ts.slicesProperties.push({\n\t\t\t\tstartPosition,\n\t\t\t\tendPosition,\n\t\t\t\tvalue: total,\n\t\t\t\ttotal: s.grandTotal,\n\t\t\t\tstartAngle,\n\t\t\t\tendAngle,\n\t\t\t\tangle: diffAngle\n\t\t\t});\n\n\t\t});\n\t\tthis.init = 0;\n\t}\n\n\tsetupComponents() {\n\t\tlet s = this.state;\n\n\t\tlet componentConfigs = [\n\t\t\t[\n\t\t\t\t'donutSlices',\n\t\t\t\t{ },\n\t\t\t\tfunction() {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tsliceStrings: s.sliceStrings,\n\t\t\t\t\t\tcolors: this.colors,\n\t\t\t\t\t\tstrokeWidth: this.strokeWidth,\n\t\t\t\t\t};\n\t\t\t\t}.bind(this)\n\t\t\t]\n\t\t];\n\n\t\tthis.components = new Map(componentConfigs\n\t\t\t.map(args => {\n\t\t\t\tlet component = getComponent(...args);\n\t\t\t\treturn [args[0], component];\n\t\t\t}));\n\t}\n\n\tcalTranslateByAngle(property){\n\t\tconst{ radius, hoverRadio } = this;\n\t\tconst position = getPositionByAngle(property.startAngle+(property.angle / 2),radius);\n\t\treturn `translate3d(${(position.x) * hoverRadio}px,${(position.y) * hoverRadio}px,0)`;\n\t}\n\n\thoverSlice(path,i,flag,e){\n\t\tif(!path) return;\n\t\tconst color = this.colors[i];\n\t\tif(flag) {\n\t\t\ttransform(path, this.calTranslateByAngle(this.state.slicesProperties[i]));\n\t\t\tpath.style.stroke = lightenDarkenColor(color, 50);\n\t\t\tlet g_off = getOffset(this.svg);\n\t\t\tlet x = e.pageX - g_off.left + 10;\n\t\t\tlet y = e.pageY - g_off.top - 10;\n\t\t\tlet title = (this.formatted_labels && this.formatted_labels.length > 0\n\t\t\t\t? this.formatted_labels[i] : this.state.labels[i]) + ': ';\n\t\t\tlet percent = (this.state.sliceTotals[i] * 100 / this.state.grandTotal).toFixed(1);\n\t\t\tthis.tip.setValues(x, y, {name: title, value: percent + \"%\"});\n\t\t\tthis.tip.showTip();\n\t\t} else {\n\t\t\ttransform(path,'translate3d(0,0,0)');\n\t\t\tthis.tip.hideTip();\n\t\t\tpath.style.stroke = color;\n\t\t}\n\t}\n\n\tbindTooltip() {\n\t\tthis.container.addEventListener('mousemove', this.mouseMove);\n\t\tthis.container.addEventListener('mouseleave', this.mouseLeave);\n\t}\n\n\tmouseMove(e){\n\t\tconst target = e.target;\n\t\tlet slices = this.components.get('donutSlices').store;\n\t\tlet prevIndex = this.curActiveSliceIndex;\n\t\tlet prevAcitve = this.curActiveSlice;\n\t\tif(slices.includes(target)) {\n\t\t\tlet i = slices.indexOf(target);\n\t\t\tthis.hoverSlice(prevAcitve, prevIndex,false);\n\t\t\tthis.curActiveSlice = target;\n\t\t\tthis.curActiveSliceIndex = i;\n\t\t\tthis.hoverSlice(target, i, true, e);\n\t\t} else {\n\t\t\tthis.mouseLeave();\n\t\t}\n\t}\n\n\tmouseLeave(){\n\t\tthis.hoverSlice(this.curActiveSlice,this.curActiveSliceIndex,false);\n\t}\n}\n\n// import MultiAxisChart from './charts/MultiAxisChart';\nconst chartTypes = {\n\tbar: AxisChart,\n\tline: AxisChart,\n\t// multiaxis: MultiAxisChart,\n\tpercentage: PercentageChart,\n\theatmap: Heatmap,\n\tpie: PieChart,\n\tdonut: DonutChart,\n};\n\nfunction getChartByType(chartType = 'line', parent, options) {\n\tif (chartType === 'axis-mixed') {\n\t\toptions.type = 'line';\n\t\treturn new AxisChart(parent, options);\n\t}\n\n\tif (!chartTypes[chartType]) {\n\t\tconsole.error(\"Undefined chart type: \" + chartType);\n\t\treturn;\n\t}\n\n\treturn new chartTypes[chartType](parent, options);\n}\n\nclass Chart {\n\tconstructor(parent, options) {\n\t\treturn getChartByType(options.type, parent, options);\n\t}\n}\n\nexport { Chart, PercentageChart, PieChart, Heatmap, AxisChart };\n"]},"metadata":{},"sourceType":"module"}